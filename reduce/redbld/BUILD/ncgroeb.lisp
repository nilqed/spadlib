(cl:declaim (cl:optimize cl:debug cl:safety))
(cl:declaim (sb-ext:muffle-conditions sb-ext:compiler-note cl:style-warning))
(MODULE (LIST 'NCGROEB)) 
(SWITCH (LIST 'GSUGAR)) 
(PUT 'NC-GROEBEVAL 'NUMBER-OF-ARGS 1) 
(PUT 'NC-GROEBEVAL 'DEFINED-ON-LINE '34) 
(PUT 'NC-GROEBEVAL 'DEFINED-IN-FILE 'NCPOLY/NCGROEB.RED) 
(PUT 'NC-GROEBEVAL 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE NC-GROEBEVAL (U)
    (PROG (G)
      (NC-GSETUP)
      (SETQ U (CAR U))
      (SETQ G
              (PROG (P FORALL-RESULT FORALL-ENDPTR)
                (SETQ P (CDR (LISTEVAL U NIL)))
                (COND ((NULL P) (RETURN NIL)))
                (SETQ FORALL-RESULT
                        (SETQ FORALL-ENDPTR
                                (CONS
                                 ((LAMBDA (P) (A2NCVDP (REVAL1 P T))) (CAR P))
                                 NIL)))
               LOOPLABEL
                (SETQ P (CDR P))
                (COND ((NULL P) (RETURN FORALL-RESULT)))
                (RPLACD FORALL-ENDPTR
                        (CONS ((LAMBDA (P) (A2NCVDP (REVAL1 P T))) (CAR P))
                              NIL))
                (SETQ FORALL-ENDPTR (CDR FORALL-ENDPTR))
                (GO LOOPLABEL)))
      (SETQ G (NC-TRAVERSO G))
      (RETURN
       (CONS 'LIST
             (PROG (W FORALL-RESULT FORALL-ENDPTR)
               (SETQ W G)
               (COND ((NULL W) (RETURN NIL)))
               (SETQ FORALL-RESULT
                       (SETQ FORALL-ENDPTR
                               (CONS
                                ((LAMBDA (W) (DIP2A (CADR (CDDR W)))) (CAR W))
                                NIL)))
              LOOPLABEL
               (SETQ W (CDR W))
               (COND ((NULL W) (RETURN FORALL-RESULT)))
               (RPLACD FORALL-ENDPTR
                       (CONS ((LAMBDA (W) (DIP2A (CADR (CDDR W)))) (CAR W))
                             NIL))
               (SETQ FORALL-ENDPTR (CDR FORALL-ENDPTR))
               (GO LOOPLABEL)))))) 
(PUT 'NC_GROEBNER 'PSOPFN 'NC-GROEBEVAL) 
(PUT 'NC-PREDUCE 'NUMBER-OF-ARGS 1) 
(PUT 'NC-PREDUCE 'DEFINED-ON-LINE '44) 
(PUT 'NC-PREDUCE 'DEFINED-IN-FILE 'NCPOLY/NCGROEB.RED) 
(PUT 'NC-PREDUCE 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE NC-PREDUCE (U)
    (PROG (G P *GSUGAR)
      (NC-GSETUP)
      (SETQ G
              (PROG (P FORALL-RESULT FORALL-ENDPTR)
                (SETQ P (CDR (LISTEVAL (CADR U) NIL)))
                (COND ((NULL P) (RETURN NIL)))
                (SETQ FORALL-RESULT
                        (SETQ FORALL-ENDPTR
                                (CONS
                                 ((LAMBDA (P) (A2NCVDP (REVAL1 P T))) (CAR P))
                                 NIL)))
               LOOPLABEL
                (SETQ P (CDR P))
                (COND ((NULL P) (RETURN FORALL-RESULT)))
                (RPLACD FORALL-ENDPTR
                        (CONS ((LAMBDA (P) (A2NCVDP (REVAL1 P T))) (CAR P))
                              NIL))
                (SETQ FORALL-ENDPTR (CDR FORALL-ENDPTR))
                (GO LOOPLABEL)))
      (SETQ P (A2NCVDP (REVAL1 (CAR U) T)))
      (SETQ P (NC-NORMALFORM P G NIL NIL))
      (RETURN (DIP2A (CADR (CDDR P)))))) 
(PUT 'NC_PREDUCE 'PSOPFN 'NC-PREDUCE) 
(PUT 'NC-DIV 'NUMBER-OF-ARGS 1) 
(PUT 'NC-DIV 'DEFINED-ON-LINE '54) 
(PUT 'NC-DIV 'DEFINED-IN-FILE 'NCPOLY/NCGROEB.RED) 
(PUT 'NC-DIV 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE NC-DIV (U)
    (PROG (G P *GSUGAR)
      (NC-GSETUP)
      (SETQ G (A2NCVDP (REVAL1 (CADR U) T)))
      (SETQ P (A2NCVDP (REVAL1 (CAR U) T)))
      (SETQ P (NC-QREMF P G))
      (RETURN
       (LIST 'LIST (DIP2A (CADR (CDDR (CAR P))))
             (DIP2A (CADR (CDDR (CDR P)))))))) 
(PUT 'NC_DIVIDE 'PSOPFN 'NC-DIV) 
(PUT 'NC-GSETUP 'NUMBER-OF-ARGS 0) 
(PUT 'NC-GSETUP 'DEFINED-ON-LINE '64) 
(PUT 'NC-GSETUP 'DEFINED-IN-FILE 'NCPOLY/NCGROEB.RED) 
(PUT 'NC-GSETUP 'PROCEDURE_TYPE '(ARROW UNIT GENERAL)) 
(DE NC-GSETUP NIL
    (PROGN
     (SETQ FACTORTIME* 0)
     (SETQ GROETIME* (TIME))
     (VDPINIT2 NCDIPVARS*)
     (VDPONEPOL)
     (SETQ HCOUNT* (SETQ MCOUNT* (SETQ FCOUNT* (SETQ PCOUNT* 0))))
     (SETQ BCOUNT* (SETQ B4COUNT* (SETQ HZEROCOUNT* 0)))
     (SETQ BASECOUNT* 0)
     (SETQ *GCD T)
     (SETQ GLTERMS (PROGN (SETQ ALGLIST* (CONS NIL NIL)) (LIST 'LIST)))
     (SETQ GROECONTCOUNT* 10)
     (SETQ *NC-TRAVERSO-SLOPPY (SETQ *VDPINTEGER T))
     (COND
      ((NULL NCDIPBASE*)
       (REDERR "non-commutative ideal initialization missing"))))) 
(SETQ *GSUGAR T) 
(PUT 'NC-TRAVERSO 'NUMBER-OF-ARGS 1) 
(PUT 'NC-TRAVERSO 'DEFINED-ON-LINE '79) 
(PUT 'NC-TRAVERSO 'DEFINED-IN-FILE 'NCPOLY/NCGROEB.RED) 
(PUT 'NC-TRAVERSO 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE NC-TRAVERSO (G0)
    (PROG (G D S H P)
      (SETQ G0
              (PROG (FJ FORALL-RESULT FORALL-ENDPTR)
                (SETQ FJ G0)
                (COND ((NULL FJ) (RETURN NIL)))
                (SETQ FORALL-RESULT
                        (SETQ FORALL-ENDPTR
                                (CONS
                                 ((LAMBDA (FJ)
                                    (GSETSUGAR (VDPENUMERATE (VDPSIMPCONT FJ))
                                               NIL))
                                  (CAR FJ))
                                 NIL)))
               LOOPLABEL
                (SETQ FJ (CDR FJ))
                (COND ((NULL FJ) (RETURN FORALL-RESULT)))
                (RPLACD FORALL-ENDPTR
                        (CONS
                         ((LAMBDA (FJ)
                            (GSETSUGAR (VDPENUMERATE (VDPSIMPCONT FJ)) NIL))
                          (CAR FJ))
                         NIL))
                (SETQ FORALL-ENDPTR (CDR FORALL-ENDPTR))
                (GO LOOPLABEL)))
     MAIN_LOOP
      (COND ((AND (NULL G0) (NULL D)) (RETURN (NC-TRAVERSO-FINAL G))))
      (COND
       (G0
        (PROGN (SETQ H (CAR G0)) (SETQ G0 (CDR G0)) (SETQ P (LIST NIL H H))))
       (T
        (PROGN
         (SETQ P (CAR D))
         (SETQ D (CDR D))
         (SETQ S (NC-SPOLY (CADR P) (CADDR P)))
         (AND *TRGROEB (GROEBMESS3 P S))
         (SETQ H (GROEBSIMPCONTNORMALFORM (NC-NORMALFORM S G 'LIST T)))
         (COND
          ((OR (NULL H) (NULL (CADR (CDDR H))))
           (PROGN (AND *TRGROEB (GROEBMESS4 P D)) (GO MAIN_LOOP))))
         (COND
          ((OR (NULL (CADR H))
               (AND (EQUAL (CAR (CADR H)) 0) (VEVZERO?1 (CDR (CADR H)))))
           (PROGN
            (AND *TRGROEB (GROEBMESS5 P H))
            (SETQ D (SETQ G (SETQ G0 NIL)))))))))
      (SETQ H (GROEBENUMERATE H))
      (AND *TRGROEB (GROEBMESS5 P H))
      (SETQ D (NC-TRAVERSO-PAIRLIST H G D))
      (SETQ G (NCONC G (LIST H)))
      (GO MAIN_LOOP))) 
(PUT 'NC-TRAVERSO-PAIRLIST 'NUMBER-OF-ARGS 3) 
(PUT 'NC-TRAVERSO-PAIRLIST 'DEFINED-ON-LINE '102) 
(PUT 'NC-TRAVERSO-PAIRLIST 'DEFINED-IN-FILE 'NCPOLY/NCGROEB.RED) 
(PUT 'NC-TRAVERSO-PAIRLIST 'PROCEDURE_TYPE
     '(ARROW (TIMES GENERAL GENERAL GENERAL) GENERAL)) 
(DE NC-TRAVERSO-PAIRLIST (GK G D)
    (PROG (EV R N NN Q)
      (SETQ D (NC-TRAVERSO-PAIRS-DISCARD1 GK D))
      (SETQ EV (CADR GK))
      (PROG (P)
        (SETQ P G)
       LAB
        (COND ((NULL P) (RETURN NIL)))
        ((LAMBDA (P) (SETQ N (CONS (GROEBMAKEPAIR P GK) N))) (CAR P))
        (SETQ P (CDR P))
        (GO LAB))
      ((LAMBDA (*GSUGAR)
         (PROGN
          (COND (*NC-TRAVERSO-SLOPPY (SETQ *GSUGAR NIL)))
          (SETQ N (GROEBCPLISTSORT N))))
       *GSUGAR)
      (SETQ NN N)
      (SETQ N NIL)
      (PROG (P)
        (SETQ P NN)
       LAB
        (COND ((NULL P) (RETURN NIL)))
        ((LAMBDA (P)
           (PROGN
            (SETQ Q NIL)
            (PROG (R)
              (SETQ R N)
             LAB
              (COND ((NULL R) (RETURN NIL)))
              ((LAMBDA (R) (SETQ Q (OR Q (VEVMTEST? (CAR P) (CAR R)))))
               (CAR R))
              (SETQ R (CDR R))
              (GO LAB))
            (COND ((NOT Q) (SETQ N (GROEBCPLISTSORTIN P N))))))
         (CAR P))
        (SETQ P (CDR P))
        (GO LAB))
      (RETURN (GROEBCPLISTMERGE D (REVERSIP N))))) 
(PUT 'NC-TRAVERSO-PAIRS-DISCARD1 'NUMBER-OF-ARGS 2) 
(PUT 'NC-TRAVERSO-PAIRS-DISCARD1 'DEFINED-ON-LINE '123) 
(PUT 'NC-TRAVERSO-PAIRS-DISCARD1 'DEFINED-IN-FILE 'NCPOLY/NCGROEB.RED) 
(PUT 'NC-TRAVERSO-PAIRS-DISCARD1 'PROCEDURE_TYPE
     '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE NC-TRAVERSO-PAIRS-DISCARD1 (GK D)
    (PROG (GI GJ TIJ EVK)
      (SETQ EVK (CADR GK))
      (PROG (PIJ)
        (SETQ PIJ D)
       LAB
        (COND ((NULL PIJ) (RETURN NIL)))
        ((LAMBDA (PIJ)
           (PROGN
            (SETQ TIJ (CAR PIJ))
            (SETQ GI (CADR PIJ))
            (SETQ GJ (CADDR PIJ))
            (COND
             ((AND (VEVSTRICTLYDIVIDES? (VEVLCM (CADR GI) (CADR GK)) TIJ)
                   (VEVSTRICTLYDIVIDES? (VEVLCM (CADR GJ) (CADR GK)) TIJ))
              (SETQ D (DELETE PIJ D))))))
         (CAR PIJ))
        (SETQ PIJ (CDR PIJ))
        (GO LAB))
      (RETURN D))) 
(PUT 'VEVSTRICTLYDIVIDES? 'NUMBER-OF-ARGS 2) 
(PUT 'VEVSTRICTLYDIVIDES? 'DEFINED-ON-LINE '134) 
(PUT 'VEVSTRICTLYDIVIDES? 'DEFINED-IN-FILE 'NCPOLY/NCGROEB.RED) 
(PUT 'VEVSTRICTLYDIVIDES? 'PROCEDURE_TYPE
     '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE VEVSTRICTLYDIVIDES? (EV1 EV2)
    (AND (NOT (EQUAL EV1 EV2)) (VEVMTEST? EV2 EV1))) 
(PUT 'NC-TRAVERSO-FINAL 'NUMBER-OF-ARGS 1) 
(PUT 'NC-TRAVERSO-FINAL 'DEFINED-ON-LINE '137) 
(PUT 'NC-TRAVERSO-FINAL 'DEFINED-IN-FILE 'NCPOLY/NCGROEB.RED) 
(PUT 'NC-TRAVERSO-FINAL 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE NC-TRAVERSO-FINAL (G)
    (PROG (R P *GSUGAR)
      (SETQ G (VDPLSORT G))
      (PROG ()
       WHILELABEL
        (COND ((NOT G) (RETURN NIL)))
        (PROGN
         (SETQ P (CAR G))
         (SETQ G (CDR G))
         (COND
          ((NOT (GROEBSEARCHINLIST (CADR P) G))
           (SETQ R
                   (CONS (GROEBSIMPCONTNORMALFORM (NC-NORMALFORM P G 'LIST T))
                         R)))))
        (GO WHILELABEL))
      (RETURN (REVERSIP R)))) 
(PUT 'NC-FULLPRINT 'NUMBER-OF-ARGS 8) 
(PUT 'NC-FULLPRINT 'DEFINED-ON-LINE '147) 
(PUT 'NC-FULLPRINT 'DEFINED-IN-FILE 'NCPOLY/NCGROEB.RED) 
(PUT 'NC-FULLPRINT 'PROCEDURE_TYPE
     '(ARROW
       (TIMES GENERAL GENERAL GENERAL GENERAL GENERAL GENERAL GENERAL GENERAL)
       GENERAL)) 
(DE NC-FULLPRINT (COMM CU U TU CV V TV R)
    (PROGN
     (TERPRI)
     (PRIN2 "COMPUTE ")
     (PRIN2T COMM)
     (VDPPRIN2 CU)
     (PRIN2 " * P(")
     (PRIN2 (VDPGETPROP U 'NUMBER))
     (PRIN2 ")=> ")
     (VDPPRINT TU)
     (VDPPRIN2 CV)
     (PRIN2 " * P(")
     (PRIN2 (VDPGETPROP V 'NUMBER))
     (PRIN2 ")=> ")
     (VDPPRINT TV)
     (PRIN2T "               ====>")
     (VDPPRINT R)
     (PRIN2T " - - - - - - -"))) 
(PUT 'NC-SPOLY 'NUMBER-OF-ARGS 2) 
(PUT 'NC-SPOLY 'DEFINED-ON-LINE '157) 
(PUT 'NC-SPOLY 'DEFINED-IN-FILE 'NCPOLY/NCGROEB.RED) 
(PUT 'NC-SPOLY 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE NC-SPOLY (U V)
    (PROG (CU CV TU TV BL L R)
      (SETQ L (VEV-COFAC (CADR U) (CADR V)))
      (SETQ BL (VBC-COFAC (CADDR U) (CADDR V)))
      (SETQ CU (VDPFMON (CAR BL) (CAR L)))
      (SETQ CV (VDPFMON (CDR BL) (CDR L)))
      (COND
       (*NCG-RIGHT
        (PROGN (SETQ TU (VDP-NC-PROD U CU)) (SETQ TV (VDP-NC-PROD V CV))))
       (T (PROGN (SETQ TU (VDP-NC-PROD CU U)) (SETQ TV (VDP-NC-PROD CV V)))))
      (SETQ NCCOF* (CONS CU CV))
      (SETQ R (VDPDIF TU TV))
      (COND (*TRGROEBFULL (NC-FULLPRINT "S polynomial:" CU U TU CV V TV R)))
      (RETURN R))) 
(PUT 'NC-QREMF 'NUMBER-OF-ARGS 2) 
(PUT 'NC-QREMF 'DEFINED-ON-LINE '171) 
(PUT 'NC-QREMF 'DEFINED-IN-FILE 'NCPOLY/NCGROEB.RED) 
(PUT 'NC-QREMF 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE NC-QREMF (U V)
    (PROG (EV CV Q)
      (SETQ Q (A2VDP 0))
      (COND ((OR (NULL U) (NULL (CADR (CDDR U)))) (RETURN (CONS Q Q))))
      (SETQ EV (CADR V))
      (SETQ CV (CADDR V))
      (PROG ()
       WHILELABEL
        (COND
         ((NOT
           (AND (NOT (OR (NULL U) (NULL (CADR (CDDR U)))))
                (VEVMTEST? (CADR U) EV)))
          (RETURN NIL)))
        (PROGN
         (SETQ U (NC-REDUCE1 U (CADDR U) (CADR U) V))
         (SETQ Q
                 (COND (*NCG-RIGHT (VDP-NC-PROD Q (CAR NCCOF*)))
                       (T (VDP-NC-PROD (CAR NCCOF*) Q))))
         (SETQ Q (VDPSUM Q (CDR NCCOF*))))
        (GO WHILELABEL))
      (RETURN (CONS Q U)))) 
(PUT 'NC-REDUCE1 'NUMBER-OF-ARGS 4) 
(PUT 'NC-REDUCE1 'DEFINED-ON-LINE '184) 
(PUT 'NC-REDUCE1 'DEFINED-IN-FILE 'NCPOLY/NCGROEB.RED) 
(PUT 'NC-REDUCE1 'PROCEDURE_TYPE
     '(ARROW (TIMES GENERAL GENERAL GENERAL GENERAL) GENERAL)) 
(DE NC-REDUCE1 (U BU EU V)
    (PROG (CU CV TU TV BL L R)
      (SETQ L (VEV-COFAC EU (CADR V)))
      (SETQ BL (VBC-COFAC BU (CADDR V)))
      (SETQ CU (VDPFMON (CAR BL) (CAR L)))
      (SETQ CV (VDPFMON (CDR BL) (CDR L)))
      (COND
       (*NCG-RIGHT
        (PROGN (SETQ TU (VDP-NC-PROD U CU)) (SETQ TV (VDP-NC-PROD V CV))))
       (T (PROGN (SETQ TU (VDP-NC-PROD CU U)) (SETQ TV (VDP-NC-PROD CV V)))))
      (SETQ NCCOF* (CONS CU CV))
      (SETQ R (VDPDIF TU TV))
      (COND (*TRGROEBFULL (NC-FULLPRINT "Reduction step:" CU U TU CV V TV R)))
      (RETURN R))) 
(PUT 'NC-NORMALFORM 'NUMBER-OF-ARGS 4) 
(PUT 'NC-NORMALFORM 'DEFINED-ON-LINE '201) 
(PUT 'NC-NORMALFORM 'DEFINED-IN-FILE 'NCPOLY/NCGROEB.RED) 
(PUT 'NC-NORMALFORM 'PROCEDURE_TYPE
     '(ARROW (TIMES GENERAL GENERAL GENERAL GENERAL) GENERAL)) 
(DE NC-NORMALFORM (S G MODE CMODE)
    (PROGN (SETQ MODE NIL) (NC-NORMALFORM2 S G CMODE))) 
(PUT 'NC-NORMALFORM2 'NUMBER-OF-ARGS 3) 
(PUT 'NC-NORMALFORM2 'DEFINED-ON-LINE '204) 
(PUT 'NC-NORMALFORM2 'DEFINED-IN-FILE 'NCPOLY/NCGROEB.RED) 
(PUT 'NC-NORMALFORM2 'PROCEDURE_TYPE
     '(ARROW (TIMES GENERAL GENERAL GENERAL) GENERAL)) 
(DE NC-NORMALFORM2 (S G CMODE)
    (PROG (G0 EV F S1 B)
     LOOP
      (SETQ S1 S)
      (COND
       (EV
        (PROG ()
         WHILELABEL
          (COND ((NOT (GREATERP (EVCOMP (CADR S1) EV) 0)) (RETURN NIL)))
          (SETQ S1 (VDPRED S1))
          (GO WHILELABEL))))
     LOOP2
      (COND ((OR (NULL S1) (NULL (CADR (CDDR S1)))) (RETURN S)))
      (SETQ EV (CADR S1))
      (SETQ B (CADDR S1))
      (SETQ G0 G)
      (SETQ F NIL)
      (PROG ()
       WHILELABEL
        (COND ((NOT (AND (NULL F) G0)) (RETURN NIL)))
        (COND ((VEVMTEST? EV (CADR (CAR G0))) (SETQ F (CAR G0)))
              (T (SETQ G0 (CDR G0))))
        (GO WHILELABEL))
      (COND ((NULL F) (PROGN (SETQ S1 (VDPRED S1)) (GO LOOP2))))
      (SETQ S (NC-REDUCE1 S B EV F))
      (COND (*TRGROEBS (PROGN (PRIN2 "//") (PRIN2 (VDPGETPROP F 'NUMBER)))))
      (COND (CMODE (SETQ S (GROEBSIMPCONTNORMALFORM S))))
      (GO LOOP))) 
(ENDMODULE) 