(cl:declaim (cl:optimize cl:debug cl:safety))
(cl:declaim (sb-ext:muffle-conditions sb-ext:compiler-note cl:style-warning))
(MODULE (LIST 'QQETRANS)) 
(REVISION 'QQETRANS
          "$Id: qqetrans.red 5962 2021-08-22 15:41:06Z thomas-sturm $") 
(COPYRIGHT 'QQETRANS "Copyright (c) 2005-2009 A. Dolzmann and T. Sturm") 
(EXPORTS (LIST 'QQE_LA2LTH)) 
(PUT 'QQE_LA2LTH 'NUMBER-OF-ARGS 1) 
(PUT 'QQE_LA2LTH 'DEFINED-ON-LINE '35) 
(PUT 'QQE_LA2LTH 'DEFINED-IN-FILE 'REDLOG/QQE/QQETRANS.RED) 
(PUT 'QQE_LA2LTH 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE QQE_LA2LTH (U)
    (PROG (F)
      (COND (QQE_DEBUG* (PRIN2T ":::entering qqe_la2lth")))
      (COND ((ATOM U) (RETURN U)))
      (SETQ F (RL_SIMPLBASIC U NIL (MINUS 1)))
      (COND ((ATOM F) (RETURN F)))
      (COND (QQE_DEBUG* (PRIN2T (LIST "simplificated formula is" F))))
      (COND
       ((OR (OR (EQ (CAR F) 'TRUE) (EQ (CAR F) 'FALSE))
            (OR (OR (OR (EQ (CAR F) 'OR) (EQ (CAR F) 'AND)) (EQ (CAR F) 'NOT))
                (OR (EQ (CAR F) 'IMPL) (EQ (CAR F) 'REPL) (EQ (CAR F) 'EQUIV)))
            (OR (EQ (CAR F) 'EX) (EQ (CAR F) 'ALL))
            (OR (EQ (CAR F) 'BEX) (EQ (CAR F) 'BALL)))
        (RETURN (QQE_LA2LTH1 F)))
       (T (RETURN (QQE_LA2LTH-AT F)))))) 
(PUT 'QQE_LA2LTH1 'NUMBER-OF-ARGS 1) 
(PUT 'QQE_LA2LTH1 'DEFINED-ON-LINE '53) 
(PUT 'QQE_LA2LTH1 'DEFINED-IN-FILE 'REDLOG/QQE/QQETRANS.RED) 
(PUT 'QQE_LA2LTH1 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE QQE_LA2LTH1 (U)
    (CONS (CAR U)
          (PROG (X FORALL-RESULT FORALL-ENDPTR)
            (SETQ X (CDR U))
            (COND ((NULL X) (RETURN NIL)))
            (SETQ FORALL-RESULT
                    (SETQ FORALL-ENDPTR
                            (CONS
                             ((LAMBDA (X)
                                (COND ((QQE_QADD-INSIDEF X) (QQE_LA2LTH X))
                                      (T X)))
                              (CAR X))
                             NIL)))
           LOOPLABEL
            (SETQ X (CDR X))
            (COND ((NULL X) (RETURN FORALL-RESULT)))
            (RPLACD FORALL-ENDPTR
                    (CONS
                     ((LAMBDA (X)
                        (COND ((QQE_QADD-INSIDEF X) (QQE_LA2LTH X)) (T X)))
                      (CAR X))
                     NIL))
            (SETQ FORALL-ENDPTR (CDR FORALL-ENDPTR))
            (GO LOOPLABEL)))) 
(PUT 'QQE_LA2LTH-AT 'NUMBER-OF-ARGS 1) 
(PUT 'QQE_LA2LTH-AT 'DEFINED-ON-LINE '63) 
(PUT 'QQE_LA2LTH-AT 'DEFINED-IN-FILE 'REDLOG/QQE/QQETRANS.RED) 
(PUT 'QQE_LA2LTH-AT 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE QQE_LA2LTH-AT (U)
    (PROG (LHS RHS OP X PREPU)
      (SETQ PREPU (RL_PREPAT U))
      (SETQ LHS (CADR PREPU))
      (SETQ RHS (CADDR PREPU))
      (SETQ OP (CAR PREPU))
      (SETQ X NIL)
      (COND
       ((QQE_QADD-INSIDE LHS)
        (PROGN (SETQ U (QQE_LA2LTH-AT1 PREPU)) (SETQ X T) NIL))
       ((QQE_QADD-INSIDE RHS)
        (PROGN (SETQ U (QQE_LA2LTH-AT1 (LIST OP RHS LHS))) (SETQ X T) NIL)))
      (COND (X (SETQ U (QQE_LA2LTH U))))
      (RETURN U))) 
(PUT 'QQE_LA2LTH-AT1 'NUMBER-OF-ARGS 1) 
(PUT 'QQE_LA2LTH-AT1 'DEFINED-ON-LINE '92) 
(PUT 'QQE_LA2LTH-AT1 'DEFINED-IN-FILE 'REDLOG/QQE/QQETRANS.RED) 
(PUT 'QQE_LA2LTH-AT1 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE QQE_LA2LTH-AT1 (U)
    (COND ((COND ((MEMQ (CAADR U) '(LADD RADD)) T)) (QQE_LA2LTH-ADDOUT U))
          (T (QQE_LA2LTH-ADDIN U)))) 
(PUT 'QQE_LA2LTH-ADDOUT 'NUMBER-OF-ARGS 1) 
(PUT 'QQE_LA2LTH-ADDOUT 'DEFINED-ON-LINE '99) 
(PUT 'QQE_LA2LTH-ADDOUT 'DEFINED-IN-FILE 'REDLOG/QQE/QQETRANS.RED) 
(PUT 'QQE_LA2LTH-ADDOUT 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE QQE_LA2LTH-ADDOUT (U)
    (PROG (OP LHS RHS RHSADD LHSADD OPADD)
      (SETQ OP (CAR U))
      (SETQ LHS (CADR U))
      (SETQ RHS (CADDR U))
      (SETQ LHSADD (CADR LHS))
      (SETQ RHSADD (CADDR LHS))
      (SETQ OPADD (CAR LHS))
      (COND
       ((EQUAL OPADD 'LADD)
        (PROGN
         (COND
          ((EQ OP 'QEQUAL)
           (RETURN
            (LIST 'AND (LIST 'QNEQ RHS 'QEPSILON)
                  (RL_SIMPAT (LIST 'EQUAL (LIST 'LHEAD (COPY RHS)) LHSADD))
                  (LIST 'QEQUAL (LIST 'RTAIL RHS) RHSADD))))
          (T
           (RETURN
            (LIST 'OR (LIST 'QEQUAL RHS 'QEPSILON)
                  (LIST 'AND
                        (RL_SIMPAT (LIST 'NEQ (LIST 'LHEAD (COPY RHS)) LHSADD))
                        (LIST 'QNEQ (COPY RHS) 'QEPSILON))
                  (LIST 'QNEQ (LIST 'RTAIL (COPY RHS)) RHSADD)))))
         NIL))
       ((EQUAL OPADD 'RADD)
        (PROGN
         (COND
          ((EQ OP 'QEQUAL)
           (RETURN
            (LIST 'AND (LIST 'QNEQ RHS 'QEPSILON)
                  (RL_SIMPAT (LIST 'EQUAL (LIST 'RHEAD RHS) LHSADD))
                  (LIST 'QEQUAL (LIST 'LTAIL (COPY RHS)) RHSADD))))
          (T
           (RETURN
            (LIST 'OR (LIST 'QEQUAL RHS 'QEPSILON)
                  (LIST 'AND
                        (RL_SIMPAT (LIST 'NEQ (LIST 'RHEAD (COPY RHS)) LHSADD))
                        (LIST 'QNEQ RHS 'QEPSILON))
                  (LIST 'QNEQ (LIST 'LTAIL (COPY RHS)) RHSADD)))))
         NIL))))) 
(PUT 'QQE_LA2LTH-ADDIN 'NUMBER-OF-ARGS 1) 
(PUT 'QQE_LA2LTH-ADDIN 'DEFINED-ON-LINE '138) 
(PUT 'QQE_LA2LTH-ADDIN 'DEFINED-IN-FILE 'REDLOG/QQE/QQETRANS.RED) 
(PUT 'QQE_LA2LTH-ADDIN 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE QQE_LA2LTH-ADDIN (U)
    (PROG (LHS PREADD PREADDOP OPADD AT_TYPE)
      (SETQ AT_TYPE (CAR U))
      (SETQ LHS (CADR U))
      (QQE_RESET-QADD-LOCATION)
      (QQE_QADD-INSIDE LHS)
      (SETQ PREADD (QQE_QADD-INSIDE-RELOCATE LHS))
      (SETQ PREADDOP (CAR PREADD))
      (COND
       (QQE_DEBUG*
        (PRIN2T
         (LIST "preadd=" PREADD "preaddop=" PREADDOP "at_type = " AT_TYPE))))
      (SETQ OPADD (CAR (CADR PREADD)))
      (COND
       ((EQUAL OPADD 'LADD)
        (PROGN
         (COND
          ((EQUAL PREADDOP 'LHEAD) (SETQ U (QQE_LA2LTH-ADDIN-LADDLHEAD U)))
          ((EQUAL PREADDOP 'LTAIL)
           (SETQ U (QQE_LA2LTH-ADDIN-LADDLTAIL U AT_TYPE)))
          ((EQUAL PREADDOP 'RHEAD)
           (SETQ U (QQE_LA2LTH-ADDIN-LADDRHEAD U AT_TYPE)))
          ((EQUAL PREADDOP 'RTAIL)
           (SETQ U (QQE_LA2LTH-ADDIN-LADDRTAIL U AT_TYPE))))
         NIL))
       ((EQUAL OPADD 'RADD)
        (PROGN
         (COND
          ((EQUAL PREADDOP 'LHEAD)
           (SETQ U (QQE_LA2LTH-ADDIN-RADDLHEAD U AT_TYPE)))
          ((EQUAL PREADDOP 'LTAIL)
           (SETQ U (QQE_LA2LTH-ADDIN-RADDLTAIL U AT_TYPE)))
          ((EQUAL PREADDOP 'RHEAD) (SETQ U (QQE_LA2LTH-ADDIN-RADDRHEAD U)))
          ((EQUAL PREADDOP 'RTAIL)
           (SETQ U (QQE_LA2LTH-ADDIN-RADDRTAIL U AT_TYPE))))
         NIL)))
      (RETURN U))) 
(PUT 'QQE_LA2LTH-ADDIN-LADDLHEAD 'NUMBER-OF-ARGS 1) 
(PUT 'QQE_LA2LTH-ADDIN-LADDLHEAD 'DEFINED-ON-LINE '198) 
(PUT 'QQE_LA2LTH-ADDIN-LADDLHEAD 'DEFINED-IN-FILE 'REDLOG/QQE/QQETRANS.RED) 
(PUT 'QQE_LA2LTH-ADDIN-LADDLHEAD 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE QQE_LA2LTH-ADDIN-LADDLHEAD (U)
    (PROG (LHS LHSADD PREPREADD)
      (SETQ LHS (CADR U))
      (SETQ LHSADD (CADR (CADR (QQE_QADD-INSIDE-RELOCATE LHS))))
      (SETQ PREPREADD (QQE_QADD-INSIDE-RELOCATE-2UP LHS))
      (SETCAR (CDR PREPREADD) LHSADD)
      (RETURN (RL_SIMPAT U)))) 
(PUT 'QQE_LA2LTH-ADDIN-LADDRHEAD 'NUMBER-OF-ARGS 2) 
(PUT 'QQE_LA2LTH-ADDIN-LADDRHEAD 'DEFINED-ON-LINE '216) 
(PUT 'QQE_LA2LTH-ADDIN-LADDRHEAD 'DEFINED-IN-FILE 'REDLOG/QQE/QQETRANS.RED) 
(PUT 'QQE_LA2LTH-ADDIN-LADDRHEAD 'PROCEDURE_TYPE
     '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE QQE_LA2LTH-ADDIN-LADDRHEAD (U OP)
    (PROG (LIST CU PREPREADD PREADD PREADD_CU LHSADD RHSADD)
      (SETQ PREADD (QQE_QADD-INSIDE-RELOCATE (CADR U)))
      (SETQ CU (COPY U))
      (SETQ LHSADD (CADR (CADR PREADD)))
      (COND ((ATOM (CDDR (CADR PREADD))) (SETQ RHSADD (CDDR (CADR PREADD))))
            (T (SETQ RHSADD (CADDR (CADR PREADD)))))
      (COND
       ((NEQ (CADR U) PREADD)
        (PROGN
         (SETQ PREPREADD (QQE_QADD-INSIDE-RELOCATE-2UP (CADR U)))
         (SETQ PREADD_CU (QQE_QADD-INSIDE-RELOCATE (CADR CU)))
         (SETCAR (CDR PREADD_CU) (COPY RHSADD))
         (SETCAR (CDR PREPREADD) LHSADD)
         NIL))
       (T
        (PROGN
         (SETCAR (CDR U) LHSADD)
         (SETCAR (CDR CU) (LIST 'RHEAD (COPY RHSADD)))
         NIL)))
      (COND
       ((NEQ OP 'NEQ)
        (SETQ U
                (LIST 'OR
                      (LIST 'AND (RL_SIMPAT CU)
                            (LIST 'QNEQ (COPY RHSADD) 'QEPSILON))
                      (LIST 'AND (RL_SIMPAT U)
                            (LIST 'QEQUAL (COPY RHSADD) 'QEPSILON)))))
       (T
        (SETQ U
                (LIST 'AND
                      (LIST 'OR (RL_SIMPAT CU)
                            (LIST 'QEQUAL (COPY RHSADD) 'QEPSILON))
                      (LIST 'OR (RL_SIMPAT U)
                            (LIST 'QNEQ (COPY RHSADD) 'QEPSILON))))))
      (RETURN U))) 
(PUT 'QQE_LA2LTH-ADDIN-LADDLTAIL 'NUMBER-OF-ARGS 2) 
(PUT 'QQE_LA2LTH-ADDIN-LADDLTAIL 'DEFINED-ON-LINE '255) 
(PUT 'QQE_LA2LTH-ADDIN-LADDLTAIL 'DEFINED-IN-FILE 'REDLOG/QQE/QQETRANS.RED) 
(PUT 'QQE_LA2LTH-ADDIN-LADDLTAIL 'PROCEDURE_TYPE
     '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE QQE_LA2LTH-ADDIN-LADDLTAIL (U OP)
    (PROG (CU LHSADD RHSADD PREPREADD PREADD PREADD_CU)
      (SETQ PREADD (QQE_QADD-INSIDE-RELOCATE (CADR U)))
      (SETQ LHSADD (CADR (CADR PREADD)))
      (COND ((ATOM (CDDR (CADR PREADD))) (SETQ RHSADD (CDDR (CADR PREADD))))
            (T (SETQ RHSADD (CADDR (CADR PREADD)))))
      (SETQ CU (COPY U))
      (COND
       ((NEQ (CADR U) PREADD)
        (PROGN
         (SETQ PREADD_CU (QQE_QADD-INSIDE-RELOCATE (CADR CU)))
         (SETQ PREPREADD (QQE_QADD-INSIDE-RELOCATE-2UP (CADR U)))
         (SETCAR PREADD_CU 'LADD)
         (SETCDR PREADD_CU
                 (CONS (COPY LHSADD) (LIST (LIST 'LTAIL (COPY RHSADD)))))
         (SETCAR (CDR PREPREADD) 'QEPSILON)
         NIL))
       (T
        (PROGN
         (SETCAR (CDR U) 'QEPSILON)
         (SETCAR (CDR CU)
                 (LIST 'LADD (COPY LHSADD) (LIST 'LTAIL (COPY RHSADD))))
         NIL)))
      (COND
       ((EQ OP 'QEQUAL)
        (SETQ U
                (LIST 'OR
                      (LIST 'AND (RL_SIMPAT CU)
                            (LIST 'QNEQ (COPY RHSADD) 'QEPSILON))
                      (LIST 'AND (RL_SIMPAT U)
                            (LIST 'QEQUAL (COPY RHSADD) 'QEPSILON)))))
       (T
        (SETQ U
                (LIST 'AND
                      (LIST 'OR (RL_SIMPAT CU)
                            (LIST 'QEQUAL (COPY RHSADD) 'QEPSILON))
                      (LIST 'OR (RL_SIMPAT U)
                            (LIST 'QNEQ (COPY RHSADD) 'QEPSILON))))))
      (RETURN U))) 
(PUT 'QQE_LA2LTH-ADDIN-LADDRTAIL 'NUMBER-OF-ARGS 2) 
(PUT 'QQE_LA2LTH-ADDIN-LADDRTAIL 'DEFINED-ON-LINE '298) 
(PUT 'QQE_LA2LTH-ADDIN-LADDRTAIL 'DEFINED-IN-FILE 'REDLOG/QQE/QQETRANS.RED) 
(PUT 'QQE_LA2LTH-ADDIN-LADDRTAIL 'PROCEDURE_TYPE
     '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE QQE_LA2LTH-ADDIN-LADDRTAIL (U OP)
    (PROG (LIST CU PREADD PREPREADD PREADD_CU PREPREADD_CU LHSADD RHSADD)
      (SETQ PREADD (QQE_QADD-INSIDE-RELOCATE (CADR U)))
      (SETQ LHSADD (CADR (CADR PREADD)))
      (COND ((ATOM (CDDR (CADR PREADD))) (SETQ RHSADD (CDDR (CADR PREADD))))
            (T (SETQ RHSADD (CADDR (CADR PREADD)))))
      (SETQ CU (COPY U))
      (COND
       ((NEQ (CADR U) PREADD)
        (PROGN
         (SETQ PREADD_CU (QQE_QADD-INSIDE-RELOCATE (CADR CU)))
         (SETQ PREPREADD (QQE_QADD-INSIDE-RELOCATE-2UP (CADR U)))
         (SETQ PREPREADD_CU (QQE_QADD-INSIDE-RELOCATE-2UP (CADR CU)))
         (SETCAR (CDR PREPREADD_CU) (COPY RHSADD))
         (SETCAR (CDR PREPREADD) 'QEPSILON)
         NIL))
       (T
        (PROGN
         (SETCAR (CDR U) 'QEPSILON)
         (SETCAR (CDR CU) (COPY RHSADD))
         NIL)))
      (COND
       ((EQ OP 'QEQUAL)
        (SETQ U
                (LIST 'OR
                      (LIST 'AND (RL_SIMPAT CU)
                            (LIST 'QNEQ (COPY RHSADD) 'QEPSILON))
                      (LIST 'AND (RL_SIMPAT U)
                            (LIST 'QEQUAL (COPY RHSADD) 'QEPSILON)))))
       (T
        (SETQ U
                (LIST 'AND
                      (LIST 'OR (RL_SIMPAT CU)
                            (LIST 'QEQUAL (COPY RHSADD) 'QEPSILON))
                      (LIST 'OR (RL_SIMPAT U)
                            (LIST 'QNEQ (COPY RHSADD) 'QEPSILON))))))
      (RETURN U))) 
(PUT 'QQE_LA2LTH-ADDIN-RADDLHEAD 'NUMBER-OF-ARGS 2) 
(PUT 'QQE_LA2LTH-ADDIN-RADDLHEAD 'DEFINED-ON-LINE '339) 
(PUT 'QQE_LA2LTH-ADDIN-RADDLHEAD 'DEFINED-IN-FILE 'REDLOG/QQE/QQETRANS.RED) 
(PUT 'QQE_LA2LTH-ADDIN-RADDLHEAD 'PROCEDURE_TYPE
     '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE QQE_LA2LTH-ADDIN-RADDLHEAD (U OP)
    (PROG (LIST CU PREADD PREPREADD PREADD_CU LHSADD RHSADD)
      (SETQ PREADD (QQE_QADD-INSIDE-RELOCATE (CADR U)))
      (SETQ LHSADD (CADR (CADR PREADD)))
      (COND ((ATOM (CDDR (CADR PREADD))) (SETQ RHSADD (CDDR (CADR PREADD))))
            (T (SETQ RHSADD (CADDR (CADR PREADD)))))
      (SETQ CU (COPY U))
      (COND
       ((NEQ (CADR U) PREADD)
        (PROGN
         (SETQ PREADD_CU (QQE_QADD-INSIDE-RELOCATE (CADR CU)))
         (SETQ PREPREADD (QQE_QADD-INSIDE-RELOCATE-2UP (CADR U)))
         (SETCAR (CDR PREADD_CU) (COPY RHSADD))
         (SETCAR (CDR PREPREADD) LHSADD)
         NIL))
       (T
        (PROGN
         (SETCAR (CDR U) LHSADD)
         (SETCAR (CDR CU) (LIST 'LHEAD (COPY RHSADD)))
         NIL)))
      (COND
       ((NEQ OP 'NEQ)
        (SETQ U
                (LIST 'OR
                      (LIST 'AND (RL_SIMPAT CU)
                            (LIST 'QNEQ (COPY RHSADD) 'QEPSILON))
                      (LIST 'AND (RL_SIMPAT U)
                            (LIST 'QEQUAL (COPY RHSADD) 'QEPSILON)))))
       (T
        (SETQ U
                (LIST 'AND
                      (LIST 'OR (RL_SIMPAT CU)
                            (LIST 'QEQUAL (COPY RHSADD) 'QEPSILON))
                      (LIST 'OR (RL_SIMPAT U)
                            (LIST 'QNEQ (COPY RHSADD) 'QEPSILON))))))
      (RETURN U))) 
(PUT 'QQE_LA2LTH-ADDIN-RADDRHEAD 'NUMBER-OF-ARGS 1) 
(PUT 'QQE_LA2LTH-ADDIN-RADDRHEAD 'DEFINED-ON-LINE '378) 
(PUT 'QQE_LA2LTH-ADDIN-RADDRHEAD 'DEFINED-IN-FILE 'REDLOG/QQE/QQETRANS.RED) 
(PUT 'QQE_LA2LTH-ADDIN-RADDRHEAD 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE QQE_LA2LTH-ADDIN-RADDRHEAD (U) (QQE_LA2LTH-ADDIN-LADDLHEAD U)) 
(PUT 'QQE_LA2LTH-ADDIN-RADDLTAIL 'NUMBER-OF-ARGS 2) 
(PUT 'QQE_LA2LTH-ADDIN-RADDLTAIL 'DEFINED-ON-LINE '386) 
(PUT 'QQE_LA2LTH-ADDIN-RADDLTAIL 'DEFINED-IN-FILE 'REDLOG/QQE/QQETRANS.RED) 
(PUT 'QQE_LA2LTH-ADDIN-RADDLTAIL 'PROCEDURE_TYPE
     '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE QQE_LA2LTH-ADDIN-RADDLTAIL (U OP) (QQE_LA2LTH-ADDIN-LADDRTAIL U OP)) 
(PUT 'QQE_LA2LTH-ADDIN-RADDRTAIL 'NUMBER-OF-ARGS 2) 
(PUT 'QQE_LA2LTH-ADDIN-RADDRTAIL 'DEFINED-ON-LINE '394) 
(PUT 'QQE_LA2LTH-ADDIN-RADDRTAIL 'DEFINED-IN-FILE 'REDLOG/QQE/QQETRANS.RED) 
(PUT 'QQE_LA2LTH-ADDIN-RADDRTAIL 'PROCEDURE_TYPE
     '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE QQE_LA2LTH-ADDIN-RADDRTAIL (U OP)
    (PROG (LIST CU PREADD_CU PREADD PREPREADD LHSADD RHSADD)
      (SETQ PREADD (QQE_QADD-INSIDE-RELOCATE (CADR U)))
      (SETQ LHSADD (CADR (CADR PREADD)))
      (COND ((ATOM (CDDR (CADR PREADD))) (SETQ RHSADD (CDDR (CADR PREADD))))
            (T (SETQ RHSADD (CADDR (CADR PREADD)))))
      (SETQ CU (COPY U))
      (COND
       ((NEQ (CADR U) PREADD)
        (PROGN
         (SETQ PREADD_CU (QQE_QADD-INSIDE-RELOCATE (CADR CU)))
         (SETQ PREPREADD (QQE_QADD-INSIDE-RELOCATE-2UP (CADR U)))
         (SETCAR PREADD_CU 'RADD)
         (SETCDR PREADD_CU
                 (CONS (COPY LHSADD) (LIST (LIST 'RTAIL (COPY RHSADD)))))
         (SETCAR (CDR PREPREADD) 'QEPSILON)
         NIL))
       (T
        (PROGN
         (SETCAR (CDR U) 'QEPSILON)
         (SETCAR (CDR CU)
                 (LIST 'RADD (COPY LHSADD) (LIST 'RTAIL (COPY RHSADD))))
         NIL)))
      (COND
       ((EQ OP 'QEQUAL)
        (SETQ U
                (LIST 'OR
                      (LIST 'AND (RL_SIMPAT CU)
                            (LIST 'QNEQ (COPY RHSADD) 'QEPSILON))
                      (LIST 'AND (RL_SIMPAT U)
                            (LIST 'QEQUAL (COPY RHSADD) 'QEPSILON)))))
       (T
        (SETQ U
                (LIST 'AND
                      (LIST 'OR (RL_SIMPAT CU)
                            (LIST 'QEQUAL (COPY RHSADD) 'QEPSILON))
                      (LIST 'OR (RL_SIMPAT U)
                            (LIST 'QNEQ (COPY RHSADD) 'QEPSILON))))))
      (RETURN U))) 
(PUT 'QQE_RESET-QADD-LOCATION 'NUMBER-OF-ARGS 0) 
(PUT 'QQE_RESET-QADD-LOCATION 'DEFINED-ON-LINE '439) 
(PUT 'QQE_RESET-QADD-LOCATION 'DEFINED-IN-FILE 'REDLOG/QQE/QQETRANS.RED) 
(PUT 'QQE_RESET-QADD-LOCATION 'PROCEDURE_TYPE '(ARROW UNIT GENERAL)) 
(DE QQE_RESET-QADD-LOCATION NIL (SETQ QQE_QADD-LOCATION* NIL)) 
(PUT 'QQE_QADD-INSIDE-AT 'NUMBER-OF-ARGS 1) 
(PUT 'QQE_QADD-INSIDE-AT 'DEFINED-ON-LINE '442) 
(PUT 'QQE_QADD-INSIDE-AT 'DEFINED-IN-FILE 'REDLOG/QQE/QQETRANS.RED) 
(PUT 'QQE_QADD-INSIDE-AT 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE QQE_QADD-INSIDE-AT (U)
    (PROG (LHS RHS PREPU)
      (SETQ PREPU (RL_PREPAT U))
      (SETQ LHS (CADR PREPU))
      (SETQ RHS (CADDR PREPU))
      (COND ((OR (QQE_QADD-INSIDE LHS) (QQE_QADD-INSIDE RHS)) (RETURN T))
            (T (RETURN NIL))))) 
(PUT 'QQE_QADD-INSIDEF 'NUMBER-OF-ARGS 1) 
(PUT 'QQE_QADD-INSIDEF 'DEFINED-ON-LINE '458) 
(PUT 'QQE_QADD-INSIDEF 'DEFINED-IN-FILE 'REDLOG/QQE/QQETRANS.RED) 
(PUT 'QQE_QADD-INSIDEF 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE QQE_QADD-INSIDEF (F)
    (PROG (P X)
      (COND
       ((OR (OR (EQ (CAR F) 'TRUE) (EQ (CAR F) 'FALSE))
            (OR (OR (OR (EQ (CAR F) 'OR) (EQ (CAR F) 'AND)) (EQ (CAR F) 'NOT))
                (OR (EQ (CAR F) 'IMPL) (EQ (CAR F) 'REPL) (EQ (CAR F) 'EQUIV)))
            (OR (EQ (CAR F) 'EX) (EQ (CAR F) 'ALL))
            (OR (EQ (CAR F) 'BEX) (EQ (CAR F) 'BALL)))
        (PROGN
         (SETQ X (CDR F))
         (PROG ()
          WHILELABEL
           (COND ((NOT (AND X (NULL P))) (RETURN NIL)))
           (PROGN
            (SETQ P (OR (QQE_QADD-INSIDEF (CAR X)) P))
            (SETQ X (CDR X))
            NIL)
           (GO WHILELABEL))
         (RETURN P)
         NIL))
       (T (RETURN (QQE_QADD-INSIDE-AT F)))))) 
(PUT 'QQE_QADD-INSIDE 'NUMBER-OF-ARGS 1) 
(PUT 'QQE_QADD-INSIDE 'DEFINED-ON-LINE '478) 
(PUT 'QQE_QADD-INSIDE 'DEFINED-IN-FILE 'REDLOG/QQE/QQETRANS.RED) 
(PUT 'QQE_QADD-INSIDE 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE QQE_QADD-INSIDE (U)
    (PROG (OP NOTYET X PREOP QADD_LOCATION_BEFORE)
      (COND ((OR (NULL U) (ATOM U)) (RETURN NIL)))
      (SETQ OP (CAR U))
      (SETQ QQE_QADD-LOCATION* (CONS 'A QQE_QADD-LOCATION*))
      (COND
       ((AND (PAIRP U) (NOT (COND ((MEMQ OP '(LADD RADD)) T))))
        (PROGN
         (SETQ NOTYET T)
         (SETQ PREOP OP)
         (SETQ X (CDR U))
         (SETQ QADD_LOCATION_BEFORE QQE_QADD-LOCATION*)
         (PROG ()
          WHILELABEL
           (COND ((NOT (AND X NOTYET)) (RETURN NIL)))
           (PROGN
            (SETQ QQE_QADD-LOCATION* (CONS 'D QADD_LOCATION_BEFORE))
            (SETQ QADD_LOCATION_BEFORE QQE_QADD-LOCATION*)
            (COND
             ((AND (NOT (ATOM X)) (PAIRP (CAR X)) (QQE_QADD-INSIDE (CAR X)))
              (SETQ NOTYET NIL)))
            (SETQ PREOP X)
            (SETQ X (CDR X))
            NIL)
           (GO WHILELABEL))
         (COND ((NOT NOTYET) (RETURN PREOP)) (T (RETURN NIL)))
         NIL))
       ((AND (PAIRP U) (COND ((MEMQ OP '(LADD RADD)) T))) (RETURN T))
       (T (RETURN NIL))))) 
(PUT 'QQE_QADD-INSIDE-RELOCATE 'NUMBER-OF-ARGS 1) 
(PUT 'QQE_QADD-INSIDE-RELOCATE 'DEFINED-ON-LINE '516) 
(PUT 'QQE_QADD-INSIDE-RELOCATE 'DEFINED-IN-FILE 'REDLOG/QQE/QQETRANS.RED) 
(PUT 'QQE_QADD-INSIDE-RELOCATE 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE QQE_QADD-INSIDE-RELOCATE (U)
    (PROG (POS RQ LIST)
      (SETQ LIST (REVERSE QQE_QADD-LOCATION*))
      (SETQ POS (CDR LIST))
      (SETQ RQ U)
      (PROG ()
       WHILELABEL
        (COND ((NOT (CDDR POS)) (RETURN NIL)))
        (PROGN
         (COND ((EQUAL (CAR POS) 'A) (SETQ RQ (CAR RQ)))
               (T (SETQ RQ (CDR RQ))))
         (SETQ POS (CDR POS))
         NIL)
        (GO WHILELABEL))
      (RETURN (COND ((ATOM (CAR RQ)) RQ) (T (CAR RQ)))))) 
(PUT 'QQE_QADD-INSIDE-RELOCATE-2UP 'NUMBER-OF-ARGS 1) 
(PUT 'QQE_QADD-INSIDE-RELOCATE-2UP 'DEFINED-ON-LINE '543) 
(PUT 'QQE_QADD-INSIDE-RELOCATE-2UP 'DEFINED-IN-FILE 'REDLOG/QQE/QQETRANS.RED) 
(PUT 'QQE_QADD-INSIDE-RELOCATE-2UP 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE QQE_QADD-INSIDE-RELOCATE-2UP (U)
    (PROG (POS_LOC POS_U)
      (COND ((LESSP (LENGTH QQE_QADD-LOCATION*) 5) (RETURN U)))
      (SETQ POS_LOC (CDR (REVERSE (CDDDDR QQE_QADD-LOCATION*))))
      (SETQ POS_U U)
      (PROG (X)
        (SETQ X POS_LOC)
       LAB
        (COND ((NULL X) (RETURN NIL)))
        ((LAMBDA (X)
           (PROGN
            (COND ((EQ X 'A) (SETQ POS_U (CAR POS_U)))
                  (T (SETQ POS_U (CDR POS_U))))
            NIL))
         (CAR X))
        (SETQ X (CDR X))
        (GO LAB))
      (RETURN POS_U))) 
(ENDMODULE) 