(cl:declaim (cl:optimize cl:debug cl:safety))
(cl:declaim (sb-ext:muffle-conditions sb-ext:compiler-note cl:style-warning))
(MODULE (LIST 'IOTO)) 
(REVISION 'IOTO "$Id: ioto.red 6043 2021-09-20 07:58:36Z thomas-sturm $") 
(COPYRIGHT 'IOTO "(c) 1995-2009 A. Dolzmann, T. Sturm, 2009-2017 T. Sturm") 
(FLUID '(IOTO_REALTIME* DATEBUFFER)) 
(SETQ IOTO_REALTIME* 0) 
(PUT 'IOTO_PRIN2 'NUMBER-OF-ARGS 1) 
(PUT 'IOTO_PRIN2 'DEFINED-ON-LINE '36) 
(PUT 'IOTO_PRIN2 'DEFINED-IN-FILE 'REDLOG/RLTOOLS/IOTO.RED) 
(PUT 'IOTO_PRIN2 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE IOTO_PRIN2 (L) (IOTO_PRIN21 L NIL NIL NIL)) 
(PUT 'IOTO_TPRIN2 'NUMBER-OF-ARGS 1) 
(PUT 'IOTO_TPRIN2 'DEFINED-ON-LINE '43) 
(PUT 'IOTO_TPRIN2 'DEFINED-IN-FILE 'REDLOG/RLTOOLS/IOTO.RED) 
(PUT 'IOTO_TPRIN2 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE IOTO_TPRIN2 (L) (IOTO_PRIN21 L T NIL NIL)) 
(PUT 'IOTO_PRIN2T 'NUMBER-OF-ARGS 1) 
(PUT 'IOTO_PRIN2T 'DEFINED-ON-LINE '48) 
(PUT 'IOTO_PRIN2T 'DEFINED-IN-FILE 'REDLOG/RLTOOLS/IOTO.RED) 
(PUT 'IOTO_PRIN2T 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE IOTO_PRIN2T (L) (IOTO_PRIN21 L NIL T NIL)) 
(PUT 'IOTO_TPRIN2T 'NUMBER-OF-ARGS 1) 
(PUT 'IOTO_TPRIN2T 'DEFINED-ON-LINE '53) 
(PUT 'IOTO_TPRIN2T 'DEFINED-IN-FILE 'REDLOG/RLTOOLS/IOTO.RED) 
(PUT 'IOTO_TPRIN2T 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE IOTO_TPRIN2T (L) (IOTO_PRIN21 L T T NIL)) 
(PUT 'IOTO_PRTMSG 'NUMBER-OF-ARGS 1) 
(PUT 'IOTO_PRTMSG 'DEFINED-ON-LINE '59) 
(PUT 'IOTO_PRTMSG 'DEFINED-IN-FILE 'REDLOG/RLTOOLS/IOTO.RED) 
(PUT 'IOTO_PRTMSG 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE IOTO_PRTMSG (L) (IOTO_PRIN21 L T T T)) 
(PUT 'IOTO_PRIN21 'NUMBER-OF-ARGS 4) 
(PUT 'IOTO_PRIN21 'DEFINED-ON-LINE '67) 
(PUT 'IOTO_PRIN21 'DEFINED-IN-FILE 'REDLOG/RLTOOLS/IOTO.RED) 
(PUT 'IOTO_PRIN21 'PROCEDURE_TYPE
     '(ARROW (TIMES GENERAL GENERAL GENERAL GENERAL) GENERAL)) 
(DE IOTO_PRIN21 (L FLG1 FLG2 SPC)
    (PROGN
     (COND ((AND L (ATOM L)) (SETQ L (LIST L))))
     (COND (FLG1 (IOTO_CTERPRI)))
     (PROG (X)
       (SETQ X L)
      LAB
       (COND ((NULL X) (RETURN NIL)))
       ((LAMBDA (X) (PROGN (PRIN2 X) (COND (SPC (PRIN2 " "))))) (CAR X))
       (SETQ X (CDR X))
       (GO LAB))
     (IOTO_FLUSH)
     (COND (FLG2 (IOTO_CTERPRI))))) 
(PUT 'IOTO_PRINTLISTTOSTRING 'NUMBER-OF-ARGS 1) 
(DE IOTO_PRINTLISTTOSTRING (L)
    (LTO_SCONCAT
     (PROG (X FORALL-RESULT FORALL-ENDPTR)
       (SETQ X L)
       (COND ((NULL X) (RETURN NIL)))
       (SETQ FORALL-RESULT
               (SETQ FORALL-ENDPTR
                       (CONS
                        ((LAMBDA (X)
                           (COND ((STRINGP X) X) (T (IOTO_SPRIN2 X))))
                         (CAR X))
                        NIL)))
      LOOPLABEL
       (SETQ X (CDR X))
       (COND ((NULL X) (RETURN FORALL-RESULT)))
       (RPLACD FORALL-ENDPTR
               (CONS
                ((LAMBDA (X) (COND ((STRINGP X) X) (T (IOTO_SPRIN2 X))))
                 (CAR X))
                NIL))
       (SETQ FORALL-ENDPTR (CDR FORALL-ENDPTR))
       (GO LOOPLABEL)))) 
(PUT 'IOTO_CTERPRI 'NUMBER-OF-ARGS 0) 
(PUT 'IOTO_CTERPRI 'DEFINED-ON-LINE '87) 
(PUT 'IOTO_CTERPRI 'DEFINED-IN-FILE 'REDLOG/RLTOOLS/IOTO.RED) 
(PUT 'IOTO_CTERPRI 'PROCEDURE_TYPE '(ARROW UNIT GENERAL)) 
(DE IOTO_CTERPRI NIL (COND ((GREATERP (POSN) 0) (TERPRI)))) 
(PUT 'IOTO_NTERPRI 'NUMBER-OF-ARGS 1) 
(PUT 'IOTO_NTERPRI 'DEFINED-ON-LINE '93) 
(PUT 'IOTO_NTERPRI 'DEFINED-IN-FILE 'REDLOG/RLTOOLS/IOTO.RED) 
(PUT 'IOTO_NTERPRI 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE IOTO_NTERPRI (N)
    (COND ((GREATERP (PLUS (POSN) N) (LINELENGTH NIL)) (TERPRI)))) 
(FLUID '(FANCY-SWITCH-ON* FANCY-SWITCH-OFF*)) 
(PUT 'IOTO_CPLU 'NUMBER-OF-ARGS 2) 
(PUT 'IOTO_CPLU 'DEFINED-ON-LINE '99) 
(PUT 'IOTO_CPLU 'DEFINED-IN-FILE 'REDLOG/RLTOOLS/IOTO.RED) 
(PUT 'IOTO_CPLU 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE IOTO_CPLU (S C)
    (COND
     (C
      (COMPRESS (REVERSIP (CONS '|"| (CONS 'S (CDR (REVERSIP (EXPLODE S))))))))
     (T S))) 
(PUT 'IOTO_REALTIME 'NUMBER-OF-ARGS 0) 
(PUT 'IOTO_REALTIME 'DEFINED-ON-LINE '105) 
(PUT 'IOTO_REALTIME 'DEFINED-IN-FILE 'REDLOG/RLTOOLS/IOTO.RED) 
(PUT 'IOTO_REALTIME 'PROCEDURE_TYPE '(ARROW UNIT GENERAL)) 
(DE IOTO_REALTIME NIL
    (PROG (AA RES)
      (SETQ AA (IOTO_DATESTAMP))
      (SETQ RES (DIFFERENCE AA IOTO_REALTIME*))
      (SETQ IOTO_REALTIME* AA)
      (RETURN RES))) 
(PUT 'IOTO_FLUSH 'NUMBER-OF-ARGS 0) 
(PUT 'IOTO_FLUSH 'DEFINED-ON-LINE '115) 
(PUT 'IOTO_FLUSH 'DEFINED-IN-FILE 'REDLOG/RLTOOLS/IOTO.RED) 
(PUT 'IOTO_FLUSH 'PROCEDURE_TYPE '(ARROW UNIT GENERAL)) 
(DE IOTO_FLUSH NIL (FLUSH)) 
(PUT 'IOTO_DATESTAMP 'NUMBER-OF-ARGS 0) 
(PUT 'IOTO_DATESTAMP 'DEFINED-ON-LINE '127) 
(PUT 'IOTO_DATESTAMP 'DEFINED-IN-FILE 'REDLOG/RLTOOLS/IOTO.RED) 
(PUT 'IOTO_DATESTAMP 'PROCEDURE_TYPE '(ARROW UNIT GENERAL)) 
(DE IOTO_DATESTAMP NIL (DATESTAMP)) 
(PUT 'IOTO_FORM2STR 'NUMBER-OF-ARGS 1) 
(PUT 'IOTO_FORM2STR 'DEFINED-ON-LINE '139) 
(PUT 'IOTO_FORM2STR 'DEFINED-IN-FILE 'REDLOG/RLTOOLS/IOTO.RED) 
(PUT 'IOTO_FORM2STR 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE IOTO_FORM2STR (U)
    (PROG (BUF)
      (SETQ BUF (IOTO_PRTB BUF '|"|))
      (SETQ BUF (IOTO_FORM2STR1 BUF U 0))
      (SETQ BUF (IOTO_PRTB BUF '|"|))
      (RETURN (COMPRESS (REVERSIP BUF))))) 
(PUT 'IOTO_PRTB 'NUMBER-OF-ARGS 2) 
(PUT 'IOTO_PRTB 'DEFINED-ON-LINE '147) 
(PUT 'IOTO_PRTB 'DEFINED-IN-FILE 'REDLOG/RLTOOLS/IOTO.RED) 
(PUT 'IOTO_PRTB 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE IOTO_PRTB (BUF U)
    (PROGN
     (PROG (X)
       (SETQ X (EXPLODE2 U))
      LAB
       (COND ((NULL X) (RETURN NIL)))
       ((LAMBDA (X) (PROGN (SETQ BUF (CONS X BUF)) X)) (CAR X))
       (SETQ X (CDR X))
       (GO LAB))
     BUF)) 
(PUT 'IOTO_FORM2STR1 'NUMBER-OF-ARGS 3) 
(PUT 'IOTO_FORM2STR1 'DEFINED-ON-LINE '154) 
(PUT 'IOTO_FORM2STR1 'DEFINED-IN-FILE 'REDLOG/RLTOOLS/IOTO.RED) 
(PUT 'IOTO_FORM2STR1 'PROCEDURE_TYPE
     '(ARROW (TIMES GENERAL GENERAL GENERAL) GENERAL)) 
(DE IOTO_FORM2STR1 (B U P)
    (PROG (OP INFX)
      (COND ((ATOM U) (PROGN (SETQ B (IOTO_PRTB B U)) (RETURN B))))
      (SETQ OP (PROG1 (CAR U) (SETQ U (CDR U))))
      (SETQ INFX (GET OP 'INFIX))
      (COND
       ((EQ OP 'MINUS)
        (PROGN
         (SETQ B (IOTO_PRTBPAR B '|(| P INFX))
         (SETQ B (IOTO_PRTBOP B OP))
         (SETQ B (IOTO_FORM2STR1 B (PROG1 (CAR U) (SETQ U (CDR U))) INFX))
         (SETQ B (IOTO_PRTBPAR B '|)| P INFX))
         (RETURN B))))
      (COND
       (INFX
        (PROGN
         (SETQ B (IOTO_PRTBPAR B '|(| P INFX))
         (SETQ B (IOTO_FORM2STR1 B (CAR U) INFX))
         (PROG (ARG)
           (SETQ ARG (CDR U))
          LAB
           (COND ((NULL ARG) (RETURN NIL)))
           ((LAMBDA (ARG)
              (PROGN
               (COND
                ((OR (NEQ OP 'PLUS) (NOT (EQCAR ARG 'MINUS)))
                 (SETQ B (IOTO_PRTBOP B OP))))
               (SETQ B (IOTO_FORM2STR1 B ARG INFX))))
            (CAR ARG))
           (SETQ ARG (CDR ARG))
           (GO LAB))
         (SETQ B (IOTO_PRTBPAR B '|)| P INFX))
         (RETURN B))))
      (SETQ B (IOTO_PRTBOP B OP))
      (SETQ B (IOTO_PRTB B '|(|))
      (PROG (RARGL)
        (SETQ RARGL U)
       LAB
        (COND ((NULL RARGL) (RETURN NIL)))
        (PROGN
         (SETQ B (IOTO_FORM2STR1 B (CAR RARGL) 0))
         (SETQ B (IOTO_PRTB B (COND ((CDR RARGL) '|,|) (T '|)|)))))
        (SETQ RARGL (CDR RARGL))
        (GO LAB))
      (RETURN B))) 
(PUT 'IOTO_PRTBPAR 'NUMBER-OF-ARGS 4) 
(PUT 'IOTO_PRTBPAR 'DEFINED-ON-LINE '189) 
(PUT 'IOTO_PRTBPAR 'DEFINED-IN-FILE 'REDLOG/RLTOOLS/IOTO.RED) 
(PUT 'IOTO_PRTBPAR 'PROCEDURE_TYPE
     '(ARROW (TIMES GENERAL GENERAL GENERAL GENERAL) GENERAL)) 
(DE IOTO_PRTBPAR (B U P INFX) (COND ((LEQ INFX P) (IOTO_PRTB B U)) (T B))) 
(PUT 'IOTO_PRTBOP 'NUMBER-OF-ARGS 2) 
(PUT 'IOTO_PRTBOP 'DEFINED-ON-LINE '192) 
(PUT 'IOTO_PRTBOP 'DEFINED-IN-FILE 'REDLOG/RLTOOLS/IOTO.RED) 
(PUT 'IOTO_PRTBOP 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE IOTO_PRTBOP (B OP)
    (PROGN
     (COND ((FLAGP OP 'SPACED) (SETQ B (IOTO_PRTB B '| |))))
     (SETQ B
             (COND ((EQ OP 'EXPT) (IOTO_PRTB B '^))
                   (T (IOTO_PRTB B (OR (GET OP 'PRTCH) OP)))))
     (COND ((FLAGP OP 'SPACED) (SETQ B (IOTO_PRTB B '| |))))
     B)) 
(PUT 'IOTO_SXREAD 'NUMBER-OF-ARGS 1) 
(DE IOTO_SXREAD (S)
    (PROG (PEEKCHAR*)
      (SETQ PEEKCHAR* (NCONC (EXPLODE2 S) (LIST '|;|)))
      (RETURN (XREAD T)))) 
(PUT 'IOTO_SPRIN2 'NUMBER-OF-ARGS 1) 
(DE IOTO_SPRIN2 (S)
    (PROG (OUTPUTHANDLER* RLSMAPRINBUF* *UTF8 LL STR)
      (SETQ OUTPUTHANDLER* 'IOTO_SMAPRINOH)
      (SETQ LL (LINELENGTH (DIFFERENCE (EXPT 2 (DIFFERENCE 32 5)) 1)))
      (COND (*NAT (TERPRI* NIL)))
      (PRIN2* S)
      (COND (*NAT (TERPRI* NIL)))
      (COND (*NAT (SETQ RLSMAPRINBUF* (CDDR RLSMAPRINBUF*))))
      (SETQ STR (ID2STRING (COMPRESS (REVERSIP RLSMAPRINBUF*))))
      (LINELENGTH LL)
      (RETURN STR))) 
(PUT 'IOTO_SMAPRIN 'NUMBER-OF-ARGS 1) 
(DE IOTO_SMAPRIN (U)
    (PROG (OUTPUTHANDLER* RLSMAPRINBUF* *UTF8)
      (SETQ OUTPUTHANDLER* 'IOTO_SMAPRINOH)
      (COND (*NAT (TERPRI* NIL)))
      (MAPRIN U)
      (COND (*NAT (TERPRI* NIL)))
      (COND (*NAT (SETQ RLSMAPRINBUF* (CDDR RLSMAPRINBUF*))))
      (RETURN (ID2STRING (COMPRESS (REVERSIP RLSMAPRINBUF*)))))) 
(PUT 'IOTO_SMAPRINOH 'NUMBER-OF-ARGS 2) 
(DE IOTO_SMAPRINOH (M L)
    (COND ((EQ M 'MAPRIN) (MAPRINT L 0))
          ((EQ M 'PRIN2*)
           (COND (*NAT ((LAMBDA (OUTPUTHANDLER*) (PRIN2* L)) NIL))
                 (T
                  (PROG (C)
                    (SETQ C (EXPLODE2 L))
                   LAB
                    (COND ((NULL C) (RETURN NIL)))
                    ((LAMBDA (C) (IOTO_SMAPRINBUF C)) (CAR C))
                    (SETQ C (CDR C))
                    (GO LAB)))))
          ((EQ M 'TERPRI) (IOTO_TERPRI* L))
          (T (REDERR (LIST "unknown method " M " in redfront_oh"))))) 
(PUT 'IOTO_TERPRI* 'NUMBER-OF-ARGS 1) 
(DE IOTO_TERPRI* (U)
    (PROG (N)
      (SETQ N 0)
      (COND (TESTING-WIDTH* (RETURN (SETQ OVERFLOWED* T))))
      (COND (*FORT (REDERR "ioto_smaprin: Fortran output not supported")))
      (COND
       ((AND *NAT PLINE*)
        (PROGN
         (SETQ PLINE* (REVERSE PLINE*))
         (PROG (N)
           (SETQ N YMAX*)
          LAB
           (COND
            ((MINUSP (TIMES (MINUS 1) (DIFFERENCE YMIN* N))) (RETURN NIL)))
           (PROGN (IOTO_SCPRINT PLINE* N) (IOTO_SMAPRINBUF $EOL$))
           (SETQ N (PLUS2 N (MINUS 1)))
           (GO LAB))
         (SETQ PLINE* NIL))))
      (COND (U (IOTO_SMAPRINBUF $EOL$)))
      (SETQ POSN* ORIG*)
      (SETQ YCOORD* (SETQ YMAX* (SETQ YMIN* 0))))) 
(PUT 'IOTO_SCPRINT 'NUMBER-OF-ARGS 2) 
(DE IOTO_SCPRINT (U N)
    (PROG (M)
      (SETQ POSN* 0)
      (PROG (V)
        (SETQ V U)
       LAB
        (COND ((NULL V) (RETURN NIL)))
        ((LAMBDA (V)
           (PROGN
            (COND
             ((EQUAL (CDAR V) N)
              (PROGN
               (SETQ M (DIFFERENCE (CAAAR V) POSN*))
               (COND
                ((GEQ M 0)
                 (PROG (I)
                   (SETQ I 1)
                  LAB
                   (COND ((MINUSP (DIFFERENCE M I)) (RETURN NIL)))
                   (IOTO_SMAPRINBUF '| |)
                   (SETQ I (PLUS2 I 1))
                   (GO LAB))))
               (PROG (C)
                 (SETQ C (EXPLODE2 (CDR V)))
                LAB
                 (COND ((NULL C) (RETURN NIL)))
                 ((LAMBDA (C) (IOTO_SMAPRINBUF C)) (CAR C))
                 (SETQ C (CDR C))
                 (GO LAB))
               (SETQ POSN* (CDAAR V)))))))
         (CAR V))
        (SETQ V (CDR V))
        (GO LAB)))) 
(PUT 'IOTO_SMAPRINBUF 'NUMBER-OF-ARGS 1) 
(DE IOTO_SMAPRINBUF (C)
    (PROGN
     (PROGN (SETQ RLSMAPRINBUF* (CONS '! RLSMAPRINBUF*)) '!)
     (PROGN (SETQ RLSMAPRINBUF* (CONS C RLSMAPRINBUF*)) C)
     RLSMAPRINBUF*)) 
(PUT 'IOTO_IN 'NUMBER-OF-ARGS 3) 
(DE IOTO_IN (FILE MSG OUTPUT)
    (PROG (*MSG *OUTPUT) (SETQ *MSG MSG) (SETQ *OUTPUT OUTPUT) (INFILE FILE))) 
(ENDMODULE) 