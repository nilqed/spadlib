(cl:declaim (cl:optimize cl:debug cl:safety))
(cl:declaim (sb-ext:muffle-conditions sb-ext:compiler-note cl:style-warning))
(MODULE (LIST 'QQESIAT)) 
(REVISION 'QQESIAT "$Id: qqesiat.red 5986 2021-08-28 13:35:27Z thomas-sturm $") 
(COPYRIGHT 'QQESIAT "(c) 2005-2009 A. Dolzmann, T. Sturm, 2016 T. Sturm") 
(PUT 'QQE_SIMPLAT1 'NUMBER-OF-ARGS 2) 
(PUT 'QQE_SIMPLAT1 'DEFINED-ON-LINE '32) 
(PUT 'QQE_SIMPLAT1 'DEFINED-IN-FILE 'REDLOG/QQE/QQESIAT.RED) 
(PUT 'QQE_SIMPLAT1 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE QQE_SIMPLAT1 (F SOP)
    ((LAMBDA (REL)
       (PROGN
        (COND ((NOT (MEMQ REL '(QEQUAL QNEQ))) (QQE_SIMPLBTAT F SOP))
              ((EQ REL 'QEQUAL) (QQE_SIMPLQEQUAL F SOP))
              (T (QQE_SIMPLQNEQ F SOP)))))
     (CAR F))) 
(PUT 'QQE_SIMPLBTAT 'NUMBER-OF-ARGS 2) 
(PUT 'QQE_SIMPLBTAT 'DEFINED-ON-LINE '43) 
(PUT 'QQE_SIMPLBTAT 'DEFINED-IN-FILE 'REDLOG/QQE/QQESIAT.RED) 
(PUT 'QQE_SIMPLBTAT 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE QQE_SIMPLBTAT (F SOP)
    (PROG (PREPF ETA_LHS ETA_RHS OP)
      (SETQ PREPF (RL_PREPAT F))
      (SETQ OP (CAR F))
      (SETQ ETA_LHS (QQE_ETA-IN-TERM (CADR PREPF)))
      (SETQ ETA_RHS (QQE_ETA-IN-TERM (CADDR PREPF)))
      (COND
       ((AND ETA_LHS (NULL ETA_RHS))
        (PROGN (COND ((NEQ OP 'NEQ) (RETURN 'FALSE)) (T (RETURN 'TRUE))) NIL))
       ((AND ETA_RHS (NULL ETA_LHS))
        (PROGN (COND ((NEQ OP 'NEQ) (RETURN 'FALSE)) (T (RETURN 'TRUE))) NIL))
       ((AND ETA_LHS ETA_RHS)
        (PROGN
         (COND ((EQ (CAR F) 'EQUAL) (RETURN 'TRUE)) (T (RETURN 'FALSE)))
         NIL))
       (T (RETURN (RL_SIMPAT PREPF)))))) 
(PUT 'QQE_ETA-IN-TERM 'NUMBER-OF-ARGS 1) 
(PUT 'QQE_ETA-IN-TERM 'DEFINED-ON-LINE '70) 
(PUT 'QQE_ETA-IN-TERM 'DEFINED-IN-FILE 'REDLOG/QQE/QQESIAT.RED) 
(PUT 'QQE_ETA-IN-TERM 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE QQE_ETA-IN-TERM (TERM)
    (PROG (ETA_IN X)
      (SETQ ETA_IN NIL)
      (COND ((ATOM TERM) (RETURN NIL))
            ((MEMQ (CAR TERM) '(LHEAD RHEAD)) (RETURN (QQE_ETA-IN-TERM1 TERM)))
            (T
             (PROGN
              (SETQ X (CDR TERM))
              (PROG ()
               WHILELABEL
                (COND ((NOT (AND X (NULL ETA_IN))) (RETURN NIL)))
                (PROGN
                 (COND
                  ((NOT (ATOM (CAR X)))
                   (PROGN
                    (COND
                     ((MEMQ (CAR (CAR X)) '(LHEAD RHEAD))
                      (SETQ ETA_IN (QQE_ETA-IN-TERM1 (CAR X))))
                     (T (SETQ ETA_IN (QQE_ETA-IN-TERM (CAR X)))))
                    NIL)))
                 (SETQ X (CDR X))
                 NIL)
                (GO WHILELABEL))
              (RETURN ETA_IN)
              NIL))))) 
(PUT 'QQE_ETA-IN-TERM1 'NUMBER-OF-ARGS 1) 
(PUT 'QQE_ETA-IN-TERM1 'DEFINED-ON-LINE '99) 
(PUT 'QQE_ETA-IN-TERM1 'DEFINED-IN-FILE 'REDLOG/QQE/QQESIAT.RED) 
(PUT 'QQE_ETA-IN-TERM1 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE QQE_ETA-IN-TERM1 (TERM)
    (PROG (ARG)
      (SETQ ARG (QQE_SIMPLTERM (CADR TERM)))
      (SETQ TERM (CONS (CAR TERM) ARG))
      (COND ((EQ ARG 'QEPSILON) (RETURN T)) (T (RETURN NIL))))) 
(PUT 'QQE_SIMPLQEQUAL 'NUMBER-OF-ARGS 2) 
(PUT 'QQE_SIMPLQEQUAL 'DEFINED-ON-LINE '107) 
(PUT 'QQE_SIMPLQEQUAL 'DEFINED-IN-FILE 'REDLOG/QQE/QQESIAT.RED) 
(PUT 'QQE_SIMPLQEQUAL 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE QQE_SIMPLQEQUAL (F SOP)
    (PROG (LHS RHS VARLHS VARRHS NOAL NOAR NOTL NOTR RHSNEW LHSNEW)
      (SETQ RHS (CADDR F))
      (SETQ LHS (CADR F))
      (COND ((EQUAL RHS LHS) (RETURN 'TRUE)))
      (SETQ VARLHS (QQE_QPREFIX-VAR LHS))
      (SETQ VARRHS (QQE_QPREFIX-VAR RHS))
      (COND
       ((OR (EQ VARLHS VARRHS) (EQ VARLHS 'QEPSILON) (EQ VARRHS 'QEPSILON))
        (PROGN
         (SETQ NOAR (QQE_NUMBER-OF-ADDS-IN-QTERM RHS))
         (SETQ NOAL (QQE_NUMBER-OF-ADDS-IN-QTERM LHS))
         (SETQ NOTR (QQE_NUMBER-OF-TAILS-IN-QTERM RHS))
         (SETQ NOTL (QQE_NUMBER-OF-TAILS-IN-QTERM LHS))
         (COND
          ((AND (EQ VARLHS VARRHS) (OR (GEQ NOAR NOTR) (GEQ NOAL NOTL))
                (NOT (EQUAL (DIFFERENCE NOAR NOTR) (DIFFERENCE NOAL NOTL))))
           (PROGN (RETURN 'FALSE) NIL))
          ((AND (EQ RHS 'QEPSILON) (GREATERP NOAL NOTL)) (RETURN 'FALSE))
          ((AND (EQ LHS 'QEPSILON) (GREATERP NOAR NOTR)) (RETURN 'FALSE))
          ((AND (EQ RHS 'QEPSILON) (EQUAL NOAR 0) (EQUAL NOAL 0))
           (PROGN
            (COND ((EQ VARLHS 'QEPSILON) (RETURN 'TRUE))
                  (T (SETQ LHSNEW (QQE_SIMPLTERM LHS))))
            (RETURN (LIST 'QEQUAL LHSNEW RHS))
            NIL))
          ((AND (EQ LHS 'QEPSILON) (EQUAL NOAR 0) (EQUAL NOAL 0))
           (PROGN
            (COND ((EQ VARRHS 'QEPSILON) (RETURN 'TRUE))
                  (T (SETQ RHSNEW (QQE_SIMPLTERM RHS))))
            (RETURN (LIST 'QEQUAL LHS RHSNEW))
            NIL))))))
      (SETQ RHSNEW (QQE_SIMPLTERM RHS))
      (SETQ LHSNEW (QQE_SIMPLTERM LHS))
      (COND
       ((AND (EQUAL RHS RHSNEW) (EQUAL LHS LHSNEW))
        (RETURN (LIST 'QEQUAL LHSNEW RHSNEW)))
       (T (RETURN (QQE_SIMPLQEQUAL (LIST 'QEQUAL LHSNEW RHSNEW) NIL)))))) 
(PUT 'QQE_SIMPLTERM 'NUMBER-OF-ARGS 1) 
(PUT 'QQE_SIMPLTERM 'DEFINED-ON-LINE '162) 
(PUT 'QQE_SIMPLTERM 'DEFINED-IN-FILE 'REDLOG/QQE/QQESIAT.RED) 
(PUT 'QQE_SIMPLTERM 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE QQE_SIMPLTERM (TERM)
    (PROG (OP)
      (COND ((ATOM TERM) (RETURN TERM)))
      (SETQ OP (CAR TERM))
      (COND ((MEMQ OP '(LTAIL RTAIL)) (RETURN (QQE_SIMPLTERM-TAIL TERM)))
            ((MEMQ OP '(LHEAD RHEAD)) (RETURN (QQE_SIMPLTERM-HEAD TERM)))
            ((MEMQ OP '(LADD RADD)) (RETURN (QQE_SIMPLTERM-ADD TERM)))
            (T (RETURN TERM))))) 
(PUT 'QQE_SIMPLTERM-ADD 'NUMBER-OF-ARGS 1) 
(PUT 'QQE_SIMPLTERM-ADD 'DEFINED-ON-LINE '177) 
(PUT 'QQE_SIMPLTERM-ADD 'DEFINED-IN-FILE 'REDLOG/QQE/QQESIAT.RED) 
(PUT 'QQE_SIMPLTERM-ADD 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE QQE_SIMPLTERM-ADD (TERM)
    (PROG (ARG ARGNEW)
      (SETQ ARG (CADDR TERM))
      (COND ((ATOM ARG) (RETURN TERM)))
      (SETQ ARGNEW (QQE_SIMPLTERM ARG))
      (COND ((EQUAL ARG ARGNEW) (RETURN TERM)))
      (RETURN (QQE_SIMPLTERM (LIST (CAR TERM) (CADR TERM) ARGNEW))))) 
(PUT 'QQE_SIMPLTERM-TAIL 'NUMBER-OF-ARGS 1) 
(PUT 'QQE_SIMPLTERM-TAIL 'DEFINED-ON-LINE '190) 
(PUT 'QQE_SIMPLTERM-TAIL 'DEFINED-IN-FILE 'REDLOG/QQE/QQESIAT.RED) 
(PUT 'QQE_SIMPLTERM-TAIL 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE QQE_SIMPLTERM-TAIL (TERM)
    (PROG (ARG OP OPARG ARG2RARG ARGNEW)
      (SETQ ARG (CADR TERM))
      (COND ((EQ ARG 'QEPSILON) (RETURN 'QEPSILON)))
      (COND ((ATOM ARG) (RETURN TERM)))
      (SETQ OP (CAR TERM))
      (SETQ OPARG (CAR ARG))
      (COND
       ((MEMQ OPARG '(LADD RADD))
        (PROGN
         (SETQ ARG2RARG (CADDR ARG))
         (COND ((EQ ARG2RARG 'QEPSILON) (RETURN 'QEPSILON)))
         (COND
          ((OR (AND (EQ OP 'LTAIL) (EQ OPARG 'RADD))
               (AND (EQ OP 'RTAIL) (EQ OPARG 'LADD)))
           (RETURN ARG2RARG))))))
      (SETQ ARGNEW (QQE_SIMPLTERM ARG))
      (COND ((EQUAL ARGNEW ARG) (RETURN TERM)))
      (RETURN (QQE_SIMPLTERM (LIST OP ARGNEW))))) 
(PUT 'QQE_SIMPLTERM-HEAD 'NUMBER-OF-ARGS 1) 
(PUT 'QQE_SIMPLTERM-HEAD 'DEFINED-ON-LINE '215) 
(PUT 'QQE_SIMPLTERM-HEAD 'DEFINED-IN-FILE 'REDLOG/QQE/QQESIAT.RED) 
(PUT 'QQE_SIMPLTERM-HEAD 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE QQE_SIMPLTERM-HEAD (TERM)
    (PROG (ARG ARGNEW)
      (SETQ ARG (CADR TERM))
      (COND ((ATOM ARG) (RETURN TERM)))
      (COND
       ((AND (MEMQ (CAR ARG) '(LADD RADD)) (EQ (CADDR ARG) 'QEPSILON))
        (RETURN (CADR ARG))))
      (SETQ ARGNEW (QQE_SIMPLTERM ARG))
      (COND ((EQUAL ARGNEW ARG) (RETURN TERM)))
      (RETURN (QQE_SIMPLTERM (LIST (CAR TERM) ARGNEW))))) 
(PUT 'QQE_NUMBER-OF-ADDS-IN-QTERM 'NUMBER-OF-ARGS 1) 
(PUT 'QQE_NUMBER-OF-ADDS-IN-QTERM 'DEFINED-ON-LINE '230) 
(PUT 'QQE_NUMBER-OF-ADDS-IN-QTERM 'DEFINED-IN-FILE 'REDLOG/QQE/QQESIAT.RED) 
(PUT 'QQE_NUMBER-OF-ADDS-IN-QTERM 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE QQE_NUMBER-OF-ADDS-IN-QTERM (TERM)
    (COND ((ATOM TERM) 0)
          ((MEMQ (CAR TERM) '(LADD RADD))
           (PLUS 1 (QQE_NUMBER-OF-ADDS-IN-QTERM (CADDR TERM))))
          (T (QQE_NUMBER-OF-ADDS-IN-QTERM (CADR TERM))))) 
(PUT 'QQE_NUMBER-OF-TAILS-IN-QTERM 'NUMBER-OF-ARGS 1) 
(PUT 'QQE_NUMBER-OF-TAILS-IN-QTERM 'DEFINED-ON-LINE '238) 
(PUT 'QQE_NUMBER-OF-TAILS-IN-QTERM 'DEFINED-IN-FILE 'REDLOG/QQE/QQESIAT.RED) 
(PUT 'QQE_NUMBER-OF-TAILS-IN-QTERM 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE QQE_NUMBER-OF-TAILS-IN-QTERM (TERM)
    (COND ((ATOM TERM) 0)
          ((MEMQ (CAR TERM) '(LADD RADD))
           (QQE_NUMBER-OF-TAILS-IN-QTERM (CADDR TERM)))
          (T (PLUS 1 (QQE_NUMBER-OF-TAILS-IN-QTERM (CADR TERM)))))) 
(PUT 'QQE_SIMPLQNEQ 'NUMBER-OF-ARGS 2) 
(PUT 'QQE_SIMPLQNEQ 'DEFINED-ON-LINE '246) 
(PUT 'QQE_SIMPLQNEQ 'DEFINED-IN-FILE 'REDLOG/QQE/QQESIAT.RED) 
(PUT 'QQE_SIMPLQNEQ 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE QQE_SIMPLQNEQ (F SOP)
    (PROG (OP LHS RHS NEGU)
      (SETQ OP (CAR F))
      (SETQ LHS (CADR F))
      (SETQ RHS (CADDR F))
      (SETQ NEGU (QQE_SIMPLQEQUAL (LIST 'QEQUAL LHS RHS) NIL))
      (COND ((EQ NEGU 'TRUE) (SETQ F 'FALSE)) ((EQ NEGU 'FALSE) (SETQ F 'TRUE))
            (T (SETQ F (LIST 'QNEQ (CADR NEGU) (CADDR NEGU)))))
      (RETURN F))) 
(PUT 'QQE_SIMPL_STANDARDIZEQTERM 'NUMBER-OF-ARGS 1) 
(PUT 'QQE_SIMPL_STANDARDIZEQTERM 'DEFINED-ON-LINE '261) 
(PUT 'QQE_SIMPL_STANDARDIZEQTERM 'DEFINED-IN-FILE 'REDLOG/QQE/QQESIAT.RED) 
(PUT 'QQE_SIMPL_STANDARDIZEQTERM 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE QQE_SIMPL_STANDARDIZEQTERM (TERM)
    (PROG (X)
      (SETQ X TERM)
      (PROG ()
       WHILELABEL
        (COND ((NOT (NOT (ATOM X))) (RETURN NIL)))
        (PROGN (SETCAR X 'LTAIL) (SETQ X (CAR (CDR X))) NIL)
        (GO WHILELABEL))
      (RETURN TERM))) 
(ENDMODULE) 