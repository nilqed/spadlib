(cl:declaim (cl:optimize cl:debug cl:safety))
(cl:declaim (sb-ext:muffle-conditions sb-ext:compiler-note cl:style-warning))
(MODULE (LIST 'PRETTY)) 
(CREATE-PACKAGE '(PRETTY) '(UTIL)) 
(FLUID
 '(BN BUFFERI BUFFERO INDBLANKS INDENTLEVEL INITIALBLANKS LMAR PENDINGRPARS
   RMAR RPARCOUNT STACK)) 
(GLOBAL '(*QUOTES *PRETTY-SYMMETRIC THIN*)) 
(SETQ *PRETTY-SYMMETRIC T) 
(SETQ *QUOTES T) 
(SETQ THIN* 5) 
(SETQ RMAR 80) 
(PUT 'PRETTYPRINT 'NUMBER-OF-ARGS 1) 
(PUT 'PRETTYPRINT 'DEFINED-ON-LINE '86) 
(PUT 'PRETTYPRINT 'DEFINED-IN-FILE 'RTOOLS/PRETTY.RED) 
(PUT 'PRETTYPRINT 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE PRETTYPRINT (X) (PROGN (SUPERPRINM X (POSN)) (TERPRI) NIL)) 
(PUT 'TPRETTYPRINT 'NUMBER-OF-ARGS 1) 
(PUT 'TPRETTYPRINT 'DEFINED-ON-LINE '100) 
(PUT 'TPRETTYPRINT 'DEFINED-IN-FILE 'RTOOLS/PRETTY.RED) 
(PUT 'TPRETTYPRINT 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE TPRETTYPRINT (X)
    (PROGN (COND ((GREATERP (POSN) 6) (TERPRI))) (PRETTYPRINT X))) 
(PUT 'SUPERPRINTM 'NUMBER-OF-ARGS 2) 
(PUT 'SUPERPRINTM 'DEFINED-ON-LINE '104) 
(PUT 'SUPERPRINTM 'DEFINED-IN-FILE 'RTOOLS/PRETTY.RED) 
(PUT 'SUPERPRINTM 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE SUPERPRINTM (X LMAR) (PROGN (SUPERPRINM X LMAR) (TERPRI) X)) 
(PUT 'SPACES 'NUMBER-OF-ARGS 1) 
(PUT 'SPACES 'DEFINED-ON-LINE '116) 
(PUT 'SPACES 'DEFINED-IN-FILE 'RTOOLS/PRETTY.RED) 
(PUT 'SPACES 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE SPACES (N)
    (PROG (I)
      (SETQ I 1)
     LAB
      (COND ((MINUSP (DIFFERENCE N I)) (RETURN NIL)))
      (PRIN2 BLANK)
      (SETQ I (PLUS2 I 1))
      (GO LAB))) 
(PUT 'SUPERPRINM 'NUMBER-OF-ARGS 2) 
(PUT 'SUPERPRINM 'DEFINED-ON-LINE '122) 
(PUT 'SUPERPRINM 'DEFINED-IN-FILE 'RTOOLS/PRETTY.RED) 
(PUT 'SUPERPRINM 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE SUPERPRINM (X LMAR)
    (PROG (STACK BUFFERI BUFFERO BN INITIALBLANKS RMAR PENDINGRPARS INDENTLEVEL
           INDBLANKS RPARCOUNT W)
      (SETQ BUFFERI (SETQ BUFFERO (LIST NIL)))
      (SETQ INITIALBLANKS 0)
      (SETQ RPARCOUNT 0)
      (SETQ INDBLANKS 0)
      (SETQ RMAR (DIFFERENCE (LINELENGTH NIL) 3))
      (COND
       ((LESSP RMAR 25)
        (ERROR 0
               (LIST (PLUS RMAR 3) "Linelength too short for superprinting"))))
      (SETQ BN 0)
      (SETQ INDENTLEVEL 0)
      (COND ((GEQ (PLUS LMAR 20) RMAR) (SETQ LMAR (DIFFERENCE RMAR 21))))
      (SETQ W (POSN))
      (COND ((GREATERP W LMAR) (PROGN (TERPRI) (SETQ W 0))))
      (COND ((LESSP W LMAR) (SETQ INITIALBLANKS (DIFFERENCE LMAR W))))
      (PRINDENT X (PLUS LMAR 2))
      (OVERFLOW 'NONE)
      (RETURN X))) 
(DE TOP NIL (CAR STACK)) 
(PUT 'TOP 'NUMBER-OF-ARGS 0) 
(PUT 'TOP 'DEFINED-ON-LINE '149) 
(PUT 'TOP 'DEFINED-IN-FILE 'RTOOLS/PRETTY.RED) 
(PUT 'TOP 'PROCEDURE_TYPE '(ARROW UNIT GENERAL)) 
(PUTC 'TOP 'INLINE '(LAMBDA () (CAR STACK))) 
(DE DEPTH (FRM) (CAR FRM)) 
(PUT 'DEPTH 'NUMBER-OF-ARGS 1) 
(PUT 'DEPTH 'DEFINED-ON-LINE '150) 
(PUT 'DEPTH 'DEFINED-IN-FILE 'RTOOLS/PRETTY.RED) 
(PUT 'DEPTH 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(PUTC 'DEPTH 'INLINE '(LAMBDA (FRM) (CAR FRM))) 
(DE INDENTING (FRM) (CADR FRM)) 
(PUT 'INDENTING 'NUMBER-OF-ARGS 1) 
(PUT 'INDENTING 'DEFINED-ON-LINE '151) 
(PUT 'INDENTING 'DEFINED-IN-FILE 'RTOOLS/PRETTY.RED) 
(PUT 'INDENTING 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(PUTC 'INDENTING 'INLINE '(LAMBDA (FRM) (CADR FRM))) 
(DE BLANKCOUNT (FRM) (CADDR FRM)) 
(PUT 'BLANKCOUNT 'NUMBER-OF-ARGS 1) 
(PUT 'BLANKCOUNT 'DEFINED-ON-LINE '152) 
(PUT 'BLANKCOUNT 'DEFINED-IN-FILE 'RTOOLS/PRETTY.RED) 
(PUT 'BLANKCOUNT 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(PUTC 'BLANKCOUNT 'INLINE '(LAMBDA (FRM) (CADDR FRM))) 
(DE BLANKLIST (FRM) (CDDDR FRM)) 
(PUT 'BLANKLIST 'NUMBER-OF-ARGS 1) 
(PUT 'BLANKLIST 'DEFINED-ON-LINE '153) 
(PUT 'BLANKLIST 'DEFINED-IN-FILE 'RTOOLS/PRETTY.RED) 
(PUT 'BLANKLIST 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(PUTC 'BLANKLIST 'INLINE '(LAMBDA (FRM) (CDDDR FRM))) 
(DE SETINDENTING (FRM VAL) (RPLACA (CDR FRM) VAL)) 
(PUT 'SETINDENTING 'NUMBER-OF-ARGS 2) 
(PUT 'SETINDENTING 'DEFINED-ON-LINE '154) 
(PUT 'SETINDENTING 'DEFINED-IN-FILE 'RTOOLS/PRETTY.RED) 
(PUT 'SETINDENTING 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(PUTC 'SETINDENTING 'INLINE '(LAMBDA (FRM VAL) (RPLACA (CDR FRM) VAL))) 
(DE SETBLANKCOUNT (FRM VAL) (RPLACA (CDDR FRM) VAL)) 
(PUT 'SETBLANKCOUNT 'NUMBER-OF-ARGS 2) 
(PUT 'SETBLANKCOUNT 'DEFINED-ON-LINE '155) 
(PUT 'SETBLANKCOUNT 'DEFINED-IN-FILE 'RTOOLS/PRETTY.RED) 
(PUT 'SETBLANKCOUNT 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(PUTC 'SETBLANKCOUNT 'INLINE '(LAMBDA (FRM VAL) (RPLACA (CDDR FRM) VAL))) 
(DE SETBLANKLIST (FRM VAL) (RPLACD (CDDR FRM) VAL)) 
(PUT 'SETBLANKLIST 'NUMBER-OF-ARGS 2) 
(PUT 'SETBLANKLIST 'DEFINED-ON-LINE '156) 
(PUT 'SETBLANKLIST 'DEFINED-IN-FILE 'RTOOLS/PRETTY.RED) 
(PUT 'SETBLANKLIST 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(PUTC 'SETBLANKLIST 'INLINE '(LAMBDA (FRM VAL) (RPLACD (CDDR FRM) VAL))) 
(DE NEWFRAME (N) (LIST N NIL 0)) 
(PUT 'NEWFRAME 'NUMBER-OF-ARGS 1) 
(PUT 'NEWFRAME 'DEFINED-ON-LINE '157) 
(PUT 'NEWFRAME 'DEFINED-IN-FILE 'RTOOLS/PRETTY.RED) 
(PUT 'NEWFRAME 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(PUTC 'NEWFRAME 'INLINE '(LAMBDA (N) (LIST N NIL 0))) 
(DE BLANKP (CHAR) (NUMBERP (CAR CHAR))) 
(PUT 'BLANKP 'NUMBER-OF-ARGS 1) 
(PUT 'BLANKP 'DEFINED-ON-LINE '158) 
(PUT 'BLANKP 'DEFINED-IN-FILE 'RTOOLS/PRETTY.RED) 
(PUT 'BLANKP 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(PUTC 'BLANKP 'INLINE '(LAMBDA (CHAR) (NUMBERP (CAR CHAR)))) 
(FLUID '(PPCONTEXT*)) 
(PUT 'PRID 'NUMBER-OF-ARGS 2) 
(PUT 'PRID 'DEFINED-ON-LINE '164) 
(PUT 'PRID 'DEFINED-IN-FILE 'RTOOLS/PRETTY.RED) 
(PUT 'PRID 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE PRID (X N)
    (PROG (PPCONTEXT*)
      (SETQ PPCONTEXT* 'SYMBOL)
      (SETQ RMAR (DIFFERENCE RMAR 1))
      (PROG (C)
        (SETQ C (EXPLODE X))
       LAB
        (COND ((NULL C) (RETURN NIL)))
        ((LAMBDA (C) (PUTCH C)) (CAR C))
        (SETQ C (CDR C))
        (GO LAB))
      (SETQ RMAR (PLUS RMAR 1)))) 
(PUT 'PRIDC 'NUMBER-OF-ARGS 2) 
(PUT 'PRIDC 'DEFINED-ON-LINE '172) 
(PUT 'PRIDC 'DEFINED-IN-FILE 'RTOOLS/PRETTY.RED) 
(PUT 'PRIDC 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE PRIDC (X N)
    (PROG (C)
      (SETQ C (EXPLODE2 X))
     LAB
      (COND ((NULL C) (RETURN NIL)))
      ((LAMBDA (C) (PUTCH C)) (CAR C))
      (SETQ C (CDR C))
      (GO LAB))) 
(PUT 'PRSTRING 'NUMBER-OF-ARGS 2) 
(PUT 'PRSTRING 'DEFINED-ON-LINE '175) 
(PUT 'PRSTRING 'DEFINED-IN-FILE 'RTOOLS/PRETTY.RED) 
(PUT 'PRSTRING 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE PRSTRING (X N)
    (PROG (PPCONTEXT*)
      (SETQ PPCONTEXT* 'STRING)
      (SETQ RMAR (DIFFERENCE RMAR 1))
      (PROG (C)
        (SETQ C (EXPLODE X))
       LAB
        (COND ((NULL C) (RETURN NIL)))
        ((LAMBDA (C) (PUTCH C)) (CAR C))
        (SETQ C (CDR C))
        (GO LAB))
      (SETQ RMAR (PLUS RMAR 1)))) 
(PUT 'PRSTRINGC 'NUMBER-OF-ARGS 2) 
(PUT 'PRSTRINGC 'DEFINED-ON-LINE '183) 
(PUT 'PRSTRINGC 'DEFINED-IN-FILE 'RTOOLS/PRETTY.RED) 
(PUT 'PRSTRINGC 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE PRSTRINGC (X N)
    (PROG (C)
      (SETQ C (EXPLODE2 X))
     LAB
      (COND ((NULL C) (RETURN NIL)))
      ((LAMBDA (C) (PUTCH C)) (CAR C))
      (SETQ C (CDR C))
      (GO LAB))) 
(PUT 'PRINDENT 'NUMBER-OF-ARGS 2) 
(PUT 'PRINDENT 'DEFINED-ON-LINE '187) 
(PUT 'PRINDENT 'DEFINED-IN-FILE 'RTOOLS/PRETTY.RED) 
(PUT 'PRINDENT 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE PRINDENT (X N)
    (COND
     ((ATOM X)
      (COND ((VECTORP X) (PRVECTOR X N))
            ((STRINGP X)
             (COND (*PRETTY-SYMMETRIC (PRSTRING X N)) (T (PRSTRINGC X N))))
            (*PRETTY-SYMMETRIC (PRID X N)) (T (PRIDC X N))))
     ((QUOTEP X) (PROGN (PUTCH '|'|) (PRINDENT (CADR X) (PLUS N 1))))
     (T
      (PROG (CX)
        (COND
         ((GREATERP (TIMES 4 N) (TIMES 3 RMAR))
          (PROGN
           (OVERFLOW 'ALL)
           (SETQ N (QUOTIENT N 8))
           (COND
            ((GREATERP INITIALBLANKS N)
             (PROGN
              (SETQ LMAR (PLUS (DIFFERENCE LMAR INITIALBLANKS) N))
              (SETQ INITIALBLANKS N)))))))
        (SETQ STACK (CONS (LIST N NIL 0) STACK))
        (PUTCH (CONS 'LPAR (CAR STACK)))
        (SETQ CX (CAR X))
        (PRINDENT CX (PLUS N 1))
        (COND
         ((AND (IDP CX) (NOT (ATOM (CDR X)))) (SETQ CX (GET CX 'PPFORMAT)))
         (T (SETQ CX NIL)))
        (COND ((AND (EQUAL CX 2) (ATOM (CDDR X))) (SETQ CX NIL)))
        (COND
         ((EQUAL CX 'PROG)
          (PROGN (PUTCH BLANK) (PRINDENT (CAR (SETQ X (CDR X))) (PLUS N 2)))))
        (SETQ X (CDR X))
       SCAN
        (COND ((ATOM X) (GO OUTT)))
        (FINISHPENDING)
        (COND
         ((EQUAL CX 'PROG)
          (PROGN
           (PUTBLANK)
           (OVERFLOW BUFFERI)
           (COND
            ((ATOM (CAR X))
             (PROGN
              (SETQ LMAR (SETQ INITIALBLANKS (MAX (DIFFERENCE LMAR 6) 0)))
              (PRINDENT (CAR X) (DIFFERENCE N 2))
              (SETQ X (CDR X))
              (COND ((AND (NOT (ATOM X)) (ATOM (CAR X))) (GO SCAN)))
              (COND ((GREATERP (PLUS LMAR BN) N) (PUTBLANK))
                    (T
                     (PROG (I)
                       (SETQ I (PLUS LMAR BN))
                      LAB
                       (COND
                        ((MINUSP (DIFFERENCE (DIFFERENCE N 1) I))
                         (RETURN NIL)))
                       (PUTCH BLANK)
                       (SETQ I (PLUS2 I 1))
                       (GO LAB))))
              (COND ((ATOM X) (GO OUTT))))))))
         ((NUMBERP CX)
          (PROGN
           (SETQ CX (DIFFERENCE CX 1))
           (COND ((EQUAL CX 0) (SETQ CX NIL)))
           (PUTCH BLANK)))
         (T (PUTBLANK)))
        (PRINDENT (CAR X) (PLUS N 2))
        (SETQ X (CDR X))
        (GO SCAN)
       OUTT
        (COND
         ((NOT (NULL X))
          (PROGN
           (FINISHPENDING)
           (PUTBLANK)
           (PUTCH '|.|)
           (PUTCH BLANK)
           (PRINDENT X (PLUS N 5)))))
        (PUTCH (CONS 'RPAR (DIFFERENCE N 3)))
        (COND
         ((AND (EQUAL (CADR (CAR STACK)) 'INDENT)
               (NOT (NULL (CDDDR (CAR STACK)))))
          (OVERFLOW (CAR (CDDDR (CAR STACK)))))
         (T (ENDLIST (CAR STACK))))
        (SETQ STACK (CDR STACK)))))) 
(PUT 'EXPLODES 'NUMBER-OF-ARGS 1) 
(PUT 'EXPLODES 'DEFINED-ON-LINE '257) 
(PUT 'EXPLODES 'DEFINED-IN-FILE 'RTOOLS/PRETTY.RED) 
(PUT 'EXPLODES 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE EXPLODES (X) (EXPLODE X)) 
(PUT 'PRVECTOR 'NUMBER-OF-ARGS 2) 
(PUT 'PRVECTOR 'DEFINED-ON-LINE '261) 
(PUT 'PRVECTOR 'DEFINED-IN-FILE 'RTOOLS/PRETTY.RED) 
(PUT 'PRVECTOR 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE PRVECTOR (X N)
    (PROG (BOUND)
      (SETQ BOUND (UPBV X))
      (SETQ STACK (CONS (LIST N NIL 0) STACK))
      (PUTCH (CONS 'LSQUARE (CAR STACK)))
      (PRINDENT (GETV X 0) (PLUS N 3))
      (PROG (I)
        (SETQ I 1)
       LAB
        (COND ((MINUSP (DIFFERENCE BOUND I)) (RETURN NIL)))
        (PROGN (PUTCH '|,|) (PUTBLANK) (PRINDENT (GETV X I) (PLUS N 3)))
        (SETQ I (PLUS2 I 1))
        (GO LAB))
      (PUTCH (CONS 'RSQUARE (DIFFERENCE N 3)))
      (ENDLIST (CAR STACK))
      (SETQ STACK (CDR STACK)))) 
(PUT 'PUTBLANK 'NUMBER-OF-ARGS 0) 
(PUT 'PUTBLANK 'DEFINED-ON-LINE '277) 
(PUT 'PUTBLANK 'DEFINED-IN-FILE 'RTOOLS/PRETTY.RED) 
(PUT 'PUTBLANK 'PROCEDURE_TYPE '(ARROW UNIT GENERAL)) 
(DE PUTBLANK NIL
    (PROG ()
      (PUTCH (CAR STACK))
      (RPLACA (CDDR (CAR STACK)) (PLUS (CADDR (CAR STACK)) 1))
      (RPLACD (CDDR (CAR STACK)) (CONS BUFFERI (CDDDR (CAR STACK))))
      (SETQ INDBLANKS (PLUS INDBLANKS 1)))) 
(PUT 'ENDLIST 'NUMBER-OF-ARGS 1) 
(PUT 'ENDLIST 'DEFINED-ON-LINE '289) 
(PUT 'ENDLIST 'DEFINED-IN-FILE 'RTOOLS/PRETTY.RED) 
(PUT 'ENDLIST 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE ENDLIST (L) (SETQ PENDINGRPARS (CONS L PENDINGRPARS))) 
(PUT 'FINISHPENDING 'NUMBER-OF-ARGS 0) 
(PUT 'FINISHPENDING 'DEFINED-ON-LINE '304) 
(PUT 'FINISHPENDING 'DEFINED-IN-FILE 'RTOOLS/PRETTY.RED) 
(PUT 'FINISHPENDING 'PROCEDURE_TYPE '(ARROW UNIT GENERAL)) 
(DE FINISHPENDING NIL
    (PROGN
     (PROG (STACKFRAME)
       (SETQ STACKFRAME PENDINGRPARS)
      LAB
       (COND ((NULL STACKFRAME) (RETURN NIL)))
       ((LAMBDA (STACKFRAME)
          (PROGN
           (COND
            ((NEQ (CADR STACKFRAME) 'INDENT)
             (PROG (B)
               (SETQ B (CDDDR STACKFRAME))
              LAB
               (COND ((NULL B) (RETURN NIL)))
               ((LAMBDA (B)
                  (PROGN
                   (RPLACA B BLANK)
                   (SETQ INDBLANKS (DIFFERENCE INDBLANKS 1))))
                (CAR B))
               (SETQ B (CDR B))
               (GO LAB))))
           (RPLACD (CDDR STACKFRAME) T)))
        (CAR STACKFRAME))
       (SETQ STACKFRAME (CDR STACKFRAME))
       (GO LAB))
     (SETQ PENDINGRPARS NIL))) 
(PUT 'QUOTEP 'NUMBER-OF-ARGS 1) 
(PUT 'QUOTEP 'DEFINED-ON-LINE '316) 
(PUT 'QUOTEP 'DEFINED-IN-FILE 'RTOOLS/PRETTY.RED) 
(PUT 'QUOTEP 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE QUOTEP (X)
    (AND *QUOTES (NOT (ATOM X)) (EQUAL (CAR X) 'QUOTE) (NOT (ATOM (CDR X)))
         (NULL (CDDR X)))) 
(PUT 'PROG 'PPFORMAT 'PROG) 
(PUT 'LAMBDA 'PPFORMAT 1) 
(PUT 'LAMBDAQ 'PPFORMAT 1) 
(PUT 'SETQ 'PPFORMAT 1) 
(PUT 'SET 'PPFORMAT 1) 
(PUT 'WHILE 'PPFORMAT 1) 
(PUT 'T 'PPFORMAT 1) 
(PUT 'DE 'PPFORMAT 2) 
(PUT 'DF 'PPFORMAT 2) 
(PUT 'DM 'PPFORMAT 2) 
(PUT 'FOREACH 'PPFORMAT 4) 
(PUT 'PUTCH 'NUMBER-OF-ARGS 1) 
(PUT 'PUTCH 'DEFINED-ON-LINE '353) 
(PUT 'PUTCH 'DEFINED-IN-FILE 'RTOOLS/PRETTY.RED) 
(PUT 'PUTCH 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE PUTCH (C)
    (PROG ()
      (COND ((ATOM C) (SETQ RPARCOUNT 0))
            ((NUMBERP (CAR C)) (PROGN (SETQ RPARCOUNT 0) (GO NOCHECK)))
            ((EQUAL (CAR C) 'RPAR)
             (PROGN
              (SETQ RPARCOUNT (PLUS RPARCOUNT 1))
              (COND
               ((GREATERP RPARCOUNT 4)
                (PROGN (PUTCH BLANK) (SETQ RPARCOUNT 2))))))
            (T (SETQ RPARCOUNT 0)))
      (PROG ()
       WHILELABEL
        (COND ((NOT (GEQ (PLUS LMAR BN) RMAR)) (RETURN NIL)))
        (OVERFLOW 'MORE)
        (GO WHILELABEL))
     NOCHECK
      (SETQ BUFFERI (CDR (RPLACD BUFFERI (LIST C))))
      (SETQ BN (PLUS BN 1)))) 
(PUT 'OVERFLOW 'NUMBER-OF-ARGS 1) 
(PUT 'OVERFLOW 'DEFINED-ON-LINE '369) 
(PUT 'OVERFLOW 'DEFINED-IN-FILE 'RTOOLS/PRETTY.RED) 
(PUT 'OVERFLOW 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE OVERFLOW (FLG)
    (PROG (C BLANKSTOSKIP)
      (COND
       ((AND (EQUAL INDBLANKS 0) (GREATERP INITIALBLANKS 3) (EQUAL FLG 'MORE))
        (PROGN
         (SETQ INITIALBLANKS (DIFFERENCE INITIALBLANKS 3))
         (SETQ LMAR (DIFFERENCE LMAR 3))
         (RETURN 'MOVED-LEFT))))
     FBLANK
      (COND
       ((EQUAL BN 0)
        (PROGN
         (COND ((NOT (EQUAL FLG 'MORE)) (RETURN 'EMPTY)))
         (COND
          ((ATOM (CAR BUFFERO))
           (PROGN
            (COND
             ((EQUAL PPCONTEXT* 'STRING)
              (PROGN
               (PRIN2 "\"_")
               (TERPRI)
               (PRIN2 "   \"")
               (SETQ LMAR 0)
               (RETURN 'CONTINUED)))
             ((EQUAL PPCONTEXT* 'SYMBOL)
              (PROGN
               (PRIN2 "__")
               (TERPRI)
               (PRIN2 "   ")
               (SETQ LMAR 0)
               (RETURN 'CONTINUED)))
             (T (PRIN2 "\\"))))))
         (TERPRI)
         (SETQ LMAR 0)
         (RETURN 'CONTINUED)))
       (T (PROGN (SPACES INITIALBLANKS) (SETQ INITIALBLANKS 0))))
      (SETQ BUFFERO (CDR BUFFERO))
      (SETQ BN (DIFFERENCE BN 1))
      (SETQ LMAR (PLUS LMAR 1))
      (SETQ C (CAR BUFFERO))
      (COND ((ATOM C) (PROGN (PRIN2 C) (GO FBLANK)))
            ((NUMBERP (CAR C))
             (COND
              ((NOT (ATOM BLANKSTOSKIP))
               (PROGN
                (PRIN2 BLANK)
                (SETQ INDBLANKS (DIFFERENCE INDBLANKS 1))
                (COND
                 ((EQ C (CAR BLANKSTOSKIP))
                  (PROGN
                   (RPLACD BLANKSTOSKIP (DIFFERENCE (CDR BLANKSTOSKIP) 1))
                   (COND
                    ((EQUAL (CDR BLANKSTOSKIP) 0) (SETQ BLANKSTOSKIP T))))))
                (GO FBLANK)))
              (T (GO BLANKFOUND))))
            ((OR (EQUAL (CAR C) 'LPAR) (EQUAL (CAR C) 'LSQUARE))
             (PROGN
              (PRIN2 (GET (CAR C) 'PPCHAR))
              (COND ((EQUAL FLG 'NONE) (GO FBLANK)))
              (SETQ C (CDR C))
              (COND ((NOT (NULL (CDDDR C))) (GO FBLANK)))
              (COND
               ((GREATERP (CAR C) INDENTLEVEL)
                (PROGN (SETQ INDENTLEVEL (CAR C)) (RPLACA (CDR C) 'INDENT))))
              (GO FBLANK)))
            ((OR (EQUAL (CAR C) 'RPAR) (EQUAL (CAR C) 'RSQUARE))
             (PROGN
              (COND ((LESSP (CDR C) INDENTLEVEL) (SETQ INDENTLEVEL (CDR C))))
              (PRIN2 (GET (CAR C) 'PPCHAR))
              (GO FBLANK)))
            (T (ERROR 0 (LIST C "UNKNOWN TAG IN OVERFLOW"))))
     BLANKFOUND
      (COND ((EQCAR (CDDDR C) BUFFERO) (RPLACD (CDDR C) NIL)))
      (SETQ INDBLANKS (DIFFERENCE INDBLANKS 1))
      (COND
       ((GREATERP (CAR C) INDENTLEVEL)
        (PROGN
         (COND ((EQUAL FLG 'NONE) (PROGN (PRIN2 BLANK) (GO FBLANK))))
         (COND (BLANKSTOSKIP (SETQ BLANKSTOSKIP NIL))
               (T
                (PROGN
                 (SETQ INDENTLEVEL (CAR C))
                 (RPLACA (CDR C) 'INDENT)))))))
      (COND
       ((GREATERP (CADDR C) (DIFFERENCE THIN* 1))
        (PROGN
         (SETQ BLANKSTOSKIP (CONS C (DIFFERENCE (CADDR C) 2)))
         (RPLACA (CDR C) 'THIN)
         (RPLACA (CDDR C) 1)
         (SETQ INDENTLEVEL (DIFFERENCE (CAR C) 1))
         (PRIN2 BLANK)
         (GO FBLANK))))
      (RPLACA (CDDR C) (DIFFERENCE (CADDR C) 1))
      (TERPRI)
      (SETQ LMAR (SETQ INITIALBLANKS (CAR C)))
      (COND ((EQ BUFFERO FLG) (RETURN 'TO-FLG)))
      (COND ((OR BLANKSTOSKIP (NOT (EQUAL FLG 'MORE))) (GO FBLANK)))
      (RETURN 'MORE))) 
(PUT 'LPAR 'PPCHAR '|(|) 
(PUT 'LSQUARE 'PPCHAR '[) 
(PUT 'RPAR 'PPCHAR '|)|) 
(PUT 'RSQUARE 'PPCHAR ']) 
(ENDMODULE) 