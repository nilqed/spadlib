(cl:declaim (cl:optimize cl:debug cl:safety))
(cl:declaim (sb-ext:muffle-conditions sb-ext:compiler-note cl:style-warning))
(MODULE (LIST 'TENSORIO)) 
(DE TIO_TNAME (TH) (CAR TH)) 
(PUT 'TIO_TNAME 'NUMBER-OF-ARGS 1) 
(PUT 'TIO_TNAME 'DEFINED-ON-LINE '49) 
(PUT 'TIO_TNAME 'DEFINED-IN-FILE 'ATENSOR/TENSORIO.RED) 
(PUT 'TIO_TNAME 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(PUTC 'TIO_TNAME 'INLINE '(LAMBDA (TH) (CAR TH))) 
(DE TIO_ILIST (TH) (CADR TH)) 
(PUT 'TIO_ILIST 'NUMBER-OF-ARGS 1) 
(PUT 'TIO_ILIST 'DEFINED-ON-LINE '50) 
(PUT 'TIO_ILIST 'DEFINED-IN-FILE 'ATENSOR/TENSORIO.RED) 
(PUT 'TIO_ILIST 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(PUTC 'TIO_ILIST 'INLINE '(LAMBDA (TH) (CADR TH))) 
(DE TIO_DLIST (TH) (CDDR TH)) 
(PUT 'TIO_DLIST 'NUMBER-OF-ARGS 1) 
(PUT 'TIO_DLIST 'DEFINED-ON-LINE '51) 
(PUT 'TIO_DLIST 'DEFINED-IN-FILE 'ATENSOR/TENSORIO.RED) 
(PUT 'TIO_DLIST 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(PUTC 'TIO_DLIST 'INLINE '(LAMBDA (TH) (CDDR TH))) 
(DE TIO_THEAD (TEN) (CAR TEN)) 
(PUT 'TIO_THEAD 'NUMBER-OF-ARGS 1) 
(PUT 'TIO_THEAD 'DEFINED-ON-LINE '58) 
(PUT 'TIO_THEAD 'DEFINED-IN-FILE 'ATENSOR/TENSORIO.RED) 
(PUT 'TIO_THEAD 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(PUTC 'TIO_THEAD 'INLINE '(LAMBDA (TEN) (CAR TEN))) 
(DE TIO_PVECT (TEN) (CDR TEN)) 
(PUT 'TIO_PVECT 'NUMBER-OF-ARGS 1) 
(PUT 'TIO_PVECT 'DEFINED-ON-LINE '59) 
(PUT 'TIO_PVECT 'DEFINED-IN-FILE 'ATENSOR/TENSORIO.RED) 
(PUT 'TIO_PVECT 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(PUTC 'TIO_PVECT 'INLINE '(LAMBDA (TEN) (CDR TEN))) 
(DE TIO_MKTEN0 (TH PV) (CONS TH PV)) 
(PUT 'TIO_MKTEN0 'NUMBER-OF-ARGS 2) 
(PUT 'TIO_MKTEN0 'DEFINED-ON-LINE '60) 
(PUT 'TIO_MKTEN0 'DEFINED-IN-FILE 'ATENSOR/TENSORIO.RED) 
(PUT 'TIO_MKTEN0 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(PUTC 'TIO_MKTEN0 'INLINE '(LAMBDA (TH PV) (CONS TH PV))) 
(DE TIO_MKTEN (TH PV) (CONS '|:TENSOR| (LIST (CONS TH PV)))) 
(PUT 'TIO_MKTEN 'NUMBER-OF-ARGS 2) 
(PUT 'TIO_MKTEN 'DEFINED-ON-LINE '61) 
(PUT 'TIO_MKTEN 'DEFINED-IN-FILE 'ATENSOR/TENSORIO.RED) 
(PUT 'TIO_MKTEN 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(PUTC 'TIO_MKTEN 'INLINE
      '(LAMBDA (TH PV) (CONS '|:TENSOR| (LIST (CONS TH PV))))) 
(PUT 'BASSOC 'NUMBER-OF-ARGS 2) 
(PUT 'BASSOC 'DEFINED-ON-LINE '63) 
(PUT 'BASSOC 'DEFINED-IN-FILE 'ATENSOR/TENSORIO.RED) 
(PUT 'BASSOC 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE BASSOC (TH BL)
    (COND ((NULL BL) NIL) ((TH_MATCH TH (CAAR BL)) BL)
          (T (BASSOC TH (CDR BL))))) 
(GLOBAL '(*BASIS TENSORS*)) 
(REMPROP 'TENSOR 'STAT) 
(REMPROP 'TSYM 'STAT) 
(REMPROP 'TCLEAR 'STAT) 
(PUT 'TENSOR 'NUMBER-OF-ARGS 1) 
(PUT 'TENSOR 'DEFINED-ON-LINE '74) 
(PUT 'TENSOR 'DEFINED-IN-FILE 'ATENSOR/TENSORIO.RED) 
(PUT 'TENSOR 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE TENSOR (U)
    (PROG (X)
      (SETQ X U)
     LAB
      (COND ((NULL X) (RETURN NIL)))
      ((LAMBDA (X)
         (COND
          ((NULL (MEMQ X TENSORS*))
           (PROGN
            (PUT X '|:TENSOR| 99)
            (PUT X 'SIMPFN 'T_SIMP)
            (FLAG (LIST X) 'FULL)
            (SETQ TENSORS* (CONS X TENSORS*))
            NIL))
          (T
           (PROGN
            (PRIN2 "+++ ")
            (PRIN2 X)
            (PRIN2 " is already declared as tensor.")
            NIL))))
       (CAR X))
      (SETQ X (CDR X))
      (GO LAB))) 
(PUT 'TCLEAR 'NUMBER-OF-ARGS 1) 
(PUT 'TCLEAR 'DEFINED-ON-LINE '84) 
(PUT 'TCLEAR 'DEFINED-IN-FILE 'ATENSOR/TENSORIO.RED) 
(PUT 'TCLEAR 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE TCLEAR (U) (TCLEAR0 (COND ((EQ (CAR U) 'ALL) TENSORS*) (T U)))) 
(PUT 'TCLEAR0 'NUMBER-OF-ARGS 1) 
(PUT 'TCLEAR0 'DEFINED-ON-LINE '87) 
(PUT 'TCLEAR0 'DEFINED-IN-FILE 'ATENSOR/TENSORIO.RED) 
(PUT 'TCLEAR0 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE TCLEAR0 (U)
    (PROG (X)
      (SETQ X U)
     LAB
      (COND ((NULL X) (RETURN NIL)))
      ((LAMBDA (X)
         (COND
          ((MEMQ X TENSORS*)
           (PROG (BS BS1)
             (SETQ TENSORS* (DELETE X TENSORS*))
             (REMPROP X '|:TENSOR|)
             (REMFLAG X 'FULL)
             (SETQ BS *BASIS)
             (PROG ()
              WHILELABEL
               (COND ((NOT BS) (RETURN NIL)))
               (PROGN
                (COND
                 ((NULL (MEMQ X (CAAAR BS))) (SETQ BS1 (CONS (CAR BS) BS1))))
                (SETQ BS (CDR BS))
                NIL)
               (GO WHILELABEL))
             (SETQ *BASIS (REVERSIP BS1))))
          (T
           (PROGN
            (PROGN (PRIN2 "+++ ") (PRIN2 X) (PRIN2 " is not a tensor.") NIL)
            (TERPRI)))))
       (CAR X))
      (SETQ X (CDR X))
      (GO LAB))) 
(PUT 'TSYM 'NUMBER-OF-ARGS 1) 
(PUT 'TSYM 'DEFINED-ON-LINE '103) 
(PUT 'TSYM 'DEFINED-IN-FILE 'ATENSOR/TENSORIO.RED) 
(PUT 'TSYM 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE TSYM (U)
    (PROG (B) (SETQ B *BASIS) (SETQ *BASIS NIL) (SETQ *BASIS (TSYM1 U B)))) 
(PUT 'TSYM1 'NUMBER-OF-ARGS 2) 
(PUT 'TSYM1 'DEFINED-ON-LINE '113) 
(PUT 'TSYM1 'DEFINED-IN-FILE 'ATENSOR/TENSORIO.RED) 
(PUT 'TSYM1 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE TSYM1 (U B)
    (COND ((NULL U) B)
          (T (TSYM1 (CDR U) (TSYM2 (CDR (CAR (SIMP* (CAR U)))) B NIL))))) 
(PUT 'TSYM2 'NUMBER-OF-ARGS 3) 
(PUT 'TSYM2 'DEFINED-ON-LINE '120) 
(PUT 'TSYM2 'DEFINED-IN-FILE 'ATENSOR/TENSORIO.RED) 
(PUT 'TSYM2 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL GENERAL) GENERAL)) 
(DE TSYM2 (TT B B1)
    (COND ((CDR TT) (REDERR (LIST 'TSYM2 "*** Invalid identity:" TT)))
          ((NULL B)
           (CONS
            (CONS (CAAR TT) (TSYM4 (GPERM (LENGTH (CADAAR TT))) (CAR TT) NIL))
            (REVERSIP B1)))
          ((TH_MATCH0 (CAAR TT) (CAAR B))
           (CONS
            (CONS (CAAR B)
                  (TSYM4 (GPERM (LENGTH (CADAAR TT))) (CAR TT) (CDAR B)))
            (APPEND (CDR B) B1)))
          (T (TSYM2 TT (CDR B) (CONS (CAR B) B1))))) 
(PUT 'TSYM4 'NUMBER-OF-ARGS 3) 
(PUT 'TSYM4 'DEFINED-ON-LINE '133) 
(PUT 'TSYM4 'DEFINED-IN-FILE 'ATENSOR/TENSORIO.RED) 
(PUT 'TSYM4 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL GENERAL) GENERAL)) 
(DE TSYM4 (PS X B0)
    (COND ((NULL PS) B0)
          (T
           (TSYM4 (CDR PS) X
            (INSERT_PV (PV_RENORM (SIEVE_PV (PV_APPLP (CDR X) (CAR PS)) B0))
             B0))))) 
(PUT 'TENSOR 'STAT 'RLIS) 
(PUT 'TSYM 'STAT 'RLIS) 
(PUT 'TCLEAR 'STAT 'RLIS) 
(PUT 'KBASIS 'NUMBER-OF-ARGS 1) 
(PUT 'KBASIS 'DEFINED-ON-LINE '143) 
(PUT 'KBASIS 'DEFINED-IN-FILE 'ATENSOR/TENSORIO.RED) 
(PUT 'KBASIS 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE KBASIS (X)
    (PROG (Z)
      (SETQ Z X)
     LAB
      (COND ((NULL Z) (RETURN NIL)))
      ((LAMBDA (Z) (BASIS1 Z)) (CAR Z))
      (SETQ Z (CDR Z))
      (GO LAB))) 
(GLOBAL '(*DUMMYPRI)) 
(SWITCH (LIST 'DUMMYPRI)) 
(PUT 'BASIS1 'NUMBER-OF-ARGS 1) 
(PUT 'BASIS1 'DEFINED-ON-LINE '149) 
(PUT 'BASIS1 'DEFINED-IN-FILE 'ATENSOR/TENSORIO.RED) 
(PUT 'BASIS1 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE BASIS1 (X)
    (PROG (B)
      (COND ((IDP X) (SETQ X (LIST X))))
      (COND
       ((OR (ATOM X) (NULL (GET (CAR X) '|:TENSOR|)))
        (REDERR (LIST 'BASIS1 "*** Invalid as tensor:" X))))
      (SETQ B *BASIS)
      (PROG ()
       WHILELABEL
        (COND ((NOT B) (RETURN NIL)))
        (PROGN
         (COND
          ((TNEQUAL X (CAAAR B))
           (PROGN
            (PROG (Z)
              (SETQ Z (CDAR B))
             LAB
              (COND ((NULL Z) (RETURN NIL)))
              ((LAMBDA (Z)
                 (T_PRI1 (CONS '|:TENSOR| (LIST (CONS (CAAR B) Z))) T))
               (CAR Z))
              (SETQ Z (CDR Z))
              (GO LAB))
            (PROGN (PRIN2 (LENGTH (CDAR B))) NIL)
            (TERPRI)
            NIL)))
         (SETQ B (CDR B))
         NIL)
        (GO WHILELABEL)))) 
(PUT 'TNEQUAL 'NUMBER-OF-ARGS 2) 
(PUT 'TNEQUAL 'DEFINED-ON-LINE '165) 
(PUT 'TNEQUAL 'DEFINED-IN-FILE 'ATENSOR/TENSORIO.RED) 
(PUT 'TNEQUAL 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE TNEQUAL (TN1 TN2)
    (COND ((ATOM TN1) (EQ TN1 TN2))
          (T
           ((LAMBDA (X) (COND ((NEQ X TN2) (TNEQUAL (CDR TN1) X)) (T NIL)))
            (DELETE (CAR TN1) TN2))))) 
(PUT 'KBASIS 'STAT 'RLIS) 
(ENDMODULE) 