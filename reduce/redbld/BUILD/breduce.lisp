(cl:declaim (cl:optimize cl:debug cl:safety))
(cl:declaim (sb-ext:muffle-conditions sb-ext:compiler-note cl:style-warning))
(MODULE (LIST 'BREDUCE)) 
(REVISION 'BREDUCE "$Id: breduce.red 4088 2017-06-21 21:41:58Z arthurcnorman $") 
(COPYRIGHT 'BREDUCE "(c) 2008, 2011, 2017 T. Sturm") 
(LOAD-PACKAGE 'REDLOG) 
(LOAD-PACKAGE 'TRI) 
(FLUID '(OUT*)) 
(FLAG
 '(BREDUCE_UNSET BREDUCE_INSTANCE BREDUCE_EVERY BREDUCE_INSTANCE_ABS
   BREDUCE_EVERY_ABS)
 'RESERVED) 
(FLAG '(BREDUCE_OUTPUT) 'OPFN) 
(PUT 'BREDUCE_OUTPUT 'NUMBER-OF-ARGS 2) 
(PUT 'BREDUCE_OUTPUT 'DEFINED-ON-LINE '43) 
(PUT 'BREDUCE_OUTPUT 'DEFINED-IN-FILE 'BREDUCE/BREDUCE.RED) 
(PUT 'BREDUCE_OUTPUT 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE BREDUCE_OUTPUT (ITEM TAB_)
    (PROGN
     (SETQ ITEM
             (COND ((EQ ITEM 'BREDUCE_UNSET) "\\textsc{sigint}")
                   ((EQCAR ITEM 'LIST) (CDR ITEM)) (T (LIST ITEM))))
     (BREDUCE_TPRIN2T "<output>")
     (BREDUCE_PRIN2 ITEM)
     (COND ((EQN TAB_ 1) (BREDUCE_PRIN2 " & ")))
     (COND ((EQN TAB_ 2) (BREDUCE_PRIN2 "\\\\")))
     (BREDUCE_TPRIN2T "</output>"))) 
(FLAG '(BREDUCE_SETSWITCHES) 'OPFN) 
(PUT 'BREDUCE_SETSWITCHES 'NUMBER-OF-ARGS 2) 
(PUT 'BREDUCE_SETSWITCHES 'DEFINED-ON-LINE '60) 
(PUT 'BREDUCE_SETSWITCHES 'DEFINED-IN-FILE 'BREDUCE/BREDUCE.RED) 
(PUT 'BREDUCE_SETSWITCHES 'PROCEDURE_TYPE
     '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE BREDUCE_SETSWITCHES (SL II)
    (PROG (SWVAL SWVALS L)
      (SETQ L 0)
      (SETQ SL (CDR SL))
      (COND ((NULL SL) (RETURN NIL)))
      (SETQ L (LENGTH SL))
      (SETQ SWVALS (BREDUCE_NUMBER2SWSETTING L II))
      (PROG (SW)
        (SETQ SW SL)
       LAB
        (COND ((NULL SW) (RETURN NIL)))
        ((LAMBDA (SW)
           (PROGN
            (SETQ SWVAL (CAR SWVALS))
            (SETQ SWVALS (CDR SWVALS))
            (BREDUCE_SETSWITCH SW SWVAL)))
         (CAR SW))
        (SETQ SW (CDR SW))
        (GO LAB)))) 
(PUT 'BREDUCE_NUMBER2SWSETTING 'NUMBER-OF-ARGS 2) 
(PUT 'BREDUCE_NUMBER2SWSETTING 'DEFINED-ON-LINE '73) 
(PUT 'BREDUCE_NUMBER2SWSETTING 'DEFINED-IN-FILE 'BREDUCE/BREDUCE.RED) 
(PUT 'BREDUCE_NUMBER2SWSETTING 'PROCEDURE_TYPE
     '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE BREDUCE_NUMBER2SWSETTING (L N)
    (PROG (SL)
      (PROG ()
       REPEATLABEL
        (PROGN
         (COND ((EQUAL (REMAINDER N 2) 0) (SETQ SL (CONS 0 SL)))
               (T (SETQ SL (CONS 1 SL))))
         (SETQ N (QUOTIENT N 2)))
        (COND ((NOT (EQUAL N 0)) (GO REPEATLABEL))))
      (PROG (K)
        (SETQ K (PLUS (LENGTH SL) 1))
       LAB
        (COND ((MINUSP (DIFFERENCE L K)) (RETURN NIL)))
        (SETQ SL (CONS 0 SL))
        (SETQ K (PLUS2 K 1))
        (GO LAB))
      (RETURN SL))) 
(PUT 'BREDUCE_SETSWITCH 'NUMBER-OF-ARGS 2) 
(PUT 'BREDUCE_SETSWITCH 'DEFINED-ON-LINE '87) 
(PUT 'BREDUCE_SETSWITCH 'DEFINED-IN-FILE 'BREDUCE/BREDUCE.RED) 
(PUT 'BREDUCE_SETSWITCH 'PROCEDURE_TYPE
     '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE BREDUCE_SETSWITCH (SW ONOFF)
    (COND ((EQUAL ONOFF 1) (ON1 SW)) (T (OFF1 SW)))) 
(FLAG '(BREDUCE_OUTPUTSWITCHES) 'OPFN) 
(PUT 'BREDUCE_OUTPUTSWITCHES 'NUMBER-OF-ARGS 2) 
(PUT 'BREDUCE_OUTPUTSWITCHES 'DEFINED-ON-LINE '92) 
(PUT 'BREDUCE_OUTPUTSWITCHES 'DEFINED-IN-FILE 'BREDUCE/BREDUCE.RED) 
(PUT 'BREDUCE_OUTPUTSWITCHES 'PROCEDURE_TYPE
     '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE BREDUCE_OUTPUTSWITCHES (SL II)
    (PROG (SWVALS)
      (SETQ SL (CDR SL))
      (COND ((NULL SL) (RETURN NIL)))
      (SETQ SWVALS (BREDUCE_NUMBER2SWSETTING (LENGTH SL) II))
      (BREDUCE_TPRIN2T "<output>")
      (PROG (SWVAL)
        (SETQ SWVAL SWVALS)
       LAB
        (COND ((NULL SWVAL) (RETURN NIL)))
        ((LAMBDA (SWVAL)
           (BREDUCE_PRIN2 (LIST (BREDUCE_SWITCH2LTX SWVAL) " & ")))
         (CAR SWVAL))
        (SETQ SWVAL (CDR SWVAL))
        (GO LAB))
      (BREDUCE_TPRIN2T "</output>"))) 
(PUT 'BREDUCE_SWITCH2LTX 'NUMBER-OF-ARGS 1) 
(PUT 'BREDUCE_SWITCH2LTX 'DEFINED-ON-LINE '103) 
(PUT 'BREDUCE_SWITCH2LTX 'DEFINED-IN-FILE 'BREDUCE/BREDUCE.RED) 
(PUT 'BREDUCE_SWITCH2LTX 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE BREDUCE_SWITCH2LTX (SW) (COND ((EQUAL SW 1) "$\\bullet$") (T " $\\circ$ "))) 
(FLAG '(BREDUCE_PROCESSFORMULA) 'OPFN) 
(PUT 'BREDUCE_PROCESSFORMULA 'NUMBER-OF-ARGS 1) 
(PUT 'BREDUCE_PROCESSFORMULA 'DEFINED-ON-LINE '108) 
(PUT 'BREDUCE_PROCESSFORMULA 'DEFINED-IN-FILE 'BREDUCE/BREDUCE.RED) 
(PUT 'BREDUCE_PROCESSFORMULA 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE BREDUCE_PROCESSFORMULA (SOL)
    (PROG (SUCCESS W)
      (SETQ W 0)
      (COND ((NULL SOL) (RETURN "\\texttt{nil} (error)")))
      (SETQ SOL (RL_SIMP SOL))
      (COND ((OR (EQ SOL 'TRUE) (EQ SOL 'FALSE)) (RETURN (LIST 'LIST SOL))))
      (SETQ W (RL_QNUM SOL))
      (SETQ SUCCESS (COND ((EQN W 0) "$\\top$") (T "$\\bot$")))
      (RETURN (LIST 'LIST SUCCESS " (" W "q/" (RL_ATNUM SOL) "at)")))) 
(FLAG '(BREDUCE_TEX) 'OPFN) 
(PUT 'BREDUCE_TEX 'NUMBER-OF-ARGS 1) 
(PUT 'BREDUCE_TEX 'DEFINED-ON-LINE '122) 
(PUT 'BREDUCE_TEX 'DEFINED-IN-FILE 'BREDUCE/BREDUCE.RED) 
(PUT 'BREDUCE_TEX 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE BREDUCE_TEX (SOL)
    (CONS 'LIST
          (CONS '$
                (REVERSIP (CONS '$ (REVERSE (MKTAG (REVAL1 SOL T) 0 NIL))))))) 
(FLAG '(BREDUCE_VERBATIM) 'OPFN) 
(PUT 'BREDUCE_VERBATIM 'NUMBER-OF-ARGS 1) 
(PUT 'BREDUCE_VERBATIM 'DEFINED-ON-LINE '127) 
(PUT 'BREDUCE_VERBATIM 'DEFINED-IN-FILE 'BREDUCE/BREDUCE.RED) 
(PUT 'BREDUCE_VERBATIM 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE BREDUCE_VERBATIM (SOL) (LIST 'LIST "\\verb@" (REVAL1 SOL NIL) "@")) 
(PUT 'BREDUCE_FLUSH 'NUMBER-OF-ARGS 0) 
(PUT 'BREDUCE_FLUSH 'DEFINED-ON-LINE '130) 
(PUT 'BREDUCE_FLUSH 'DEFINED-IN-FILE 'BREDUCE/BREDUCE.RED) 
(PUT 'BREDUCE_FLUSH 'PROCEDURE_TYPE '(ARROW UNIT GENERAL)) 
(DE BREDUCE_FLUSH NIL (FLUSH)) 
(PUT 'BREDUCE_PRIN2 'NUMBER-OF-ARGS 1) 
(PUT 'BREDUCE_PRIN2 'DEFINED-ON-LINE '140) 
(PUT 'BREDUCE_PRIN2 'DEFINED-IN-FILE 'BREDUCE/BREDUCE.RED) 
(PUT 'BREDUCE_PRIN2 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE BREDUCE_PRIN2 (L) (BREDUCE_PRIN21 L NIL NIL NIL)) 
(PUT 'BREDUCE_TPRIN2 'NUMBER-OF-ARGS 1) 
(PUT 'BREDUCE_TPRIN2 'DEFINED-ON-LINE '143) 
(PUT 'BREDUCE_TPRIN2 'DEFINED-IN-FILE 'BREDUCE/BREDUCE.RED) 
(PUT 'BREDUCE_TPRIN2 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE BREDUCE_TPRIN2 (L) (BREDUCE_PRIN21 L T NIL NIL)) 
(PUT 'BREDUCE_PRIN2T 'NUMBER-OF-ARGS 1) 
(PUT 'BREDUCE_PRIN2T 'DEFINED-ON-LINE '146) 
(PUT 'BREDUCE_PRIN2T 'DEFINED-IN-FILE 'BREDUCE/BREDUCE.RED) 
(PUT 'BREDUCE_PRIN2T 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE BREDUCE_PRIN2T (L) (BREDUCE_PRIN21 L NIL T NIL)) 
(PUT 'BREDUCE_TPRIN2T 'NUMBER-OF-ARGS 1) 
(PUT 'BREDUCE_TPRIN2T 'DEFINED-ON-LINE '149) 
(PUT 'BREDUCE_TPRIN2T 'DEFINED-IN-FILE 'BREDUCE/BREDUCE.RED) 
(PUT 'BREDUCE_TPRIN2T 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE BREDUCE_TPRIN2T (L) (BREDUCE_PRIN21 L T T NIL)) 
(PUT 'BREDUCE_PRIN21 'NUMBER-OF-ARGS 4) 
(PUT 'BREDUCE_PRIN21 'DEFINED-ON-LINE '155) 
(PUT 'BREDUCE_PRIN21 'DEFINED-IN-FILE 'BREDUCE/BREDUCE.RED) 
(PUT 'BREDUCE_PRIN21 'PROCEDURE_TYPE
     '(ARROW (TIMES GENERAL GENERAL GENERAL GENERAL) GENERAL)) 
(DE BREDUCE_PRIN21 (L FLG1 FLG2 SPC)
    (PROGN
     (COND ((AND L (ATOM L)) (SETQ L (LIST L))))
     (COND (FLG1 (BREDUCE_CTERPRI)))
     (PROG (X)
       (SETQ X L)
      LAB
       (COND ((NULL X) (RETURN NIL)))
       ((LAMBDA (X) (PROGN (PRIN2 X) (COND (SPC (PRIN2 " "))))) (CAR X))
       (SETQ X (CDR X))
       (GO LAB))
     (BREDUCE_FLUSH)
     (COND (FLG2 (BREDUCE_CTERPRI))))) 
(PUT 'BREDUCE_CTERPRI 'NUMBER-OF-ARGS 0) 
(PUT 'BREDUCE_CTERPRI 'DEFINED-ON-LINE '167) 
(PUT 'BREDUCE_CTERPRI 'DEFINED-IN-FILE 'BREDUCE/BREDUCE.RED) 
(PUT 'BREDUCE_CTERPRI 'PROCEDURE_TYPE '(ARROW UNIT GENERAL)) 
(DE BREDUCE_CTERPRI NIL (COND ((GREATERP (POSN) 0) (TERPRI)))) 
(FLAG '(BREDUCE_RANDOMSEED) 'OPFN) 
(PUT 'BREDUCE_RANDOMSEED 'NUMBER-OF-ARGS 1) 
(PUT 'BREDUCE_RANDOMSEED 'DEFINED-ON-LINE '172) 
(PUT 'BREDUCE_RANDOMSEED 'DEFINED-IN-FILE 'BREDUCE/BREDUCE.RED) 
(PUT 'BREDUCE_RANDOMSEED 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE BREDUCE_RANDOMSEED (RND)
    (PROG (EPOCH N I)
      (SETQ EPOCH 0)
      (SETQ N 0)
      (SETQ I 0)
      (SETQ N (BREDUCE_STR2INT (GETENV "n")))
      (COND ((EQ RND 'BREDUCE_INSTANCE) (RETURN (RANDOM_NEW_SEED N))))
      (SETQ I (BREDUCE_STR2INT (GETENV "i")))
      (COND ((EQ RND 'BREDUCE_EVERY) (RETURN (RANDOM_NEW_SEED (PLUS N I)))))
      (SETQ EPOCH (BREDUCE_STR2INT (GETENV "epoch")))
      (COND
       ((EQ RND 'BREDUCE_INSTANCE_ABS)
        (RETURN (RANDOM_NEW_SEED (PLUS EPOCH N)))))
      (COND
       ((EQ RND 'BREDUCE_EVERY_ABS)
        (RETURN (RANDOM_NEW_SEED (PLUS EPOCH N I)))))
      (REDERR (LIST "unknown policy" RND)))) 
(PUT 'BREDUCE_STR2INT 'NUMBER-OF-ARGS 1) 
(PUT 'BREDUCE_STR2INT 'DEFINED-ON-LINE '188) 
(PUT 'BREDUCE_STR2INT 'DEFINED-IN-FILE 'BREDUCE/BREDUCE.RED) 
(PUT 'BREDUCE_STR2INT 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE BREDUCE_STR2INT (S)
    (COMPRESS (REVERSIP (CDR (REVERSIP (CDR (EXPLODE S))))))) 
(PUT 'BREDUCE_DATESTAMP 'NUMBER-OF-ARGS 0) 
(PUT 'BREDUCE_DATESTAMP 'DEFINED-ON-LINE '191) 
(PUT 'BREDUCE_DATESTAMP 'DEFINED-IN-FILE 'BREDUCE/BREDUCE.RED) 
(PUT 'BREDUCE_DATESTAMP 'PROCEDURE_TYPE '(ARROW UNIT GENERAL)) 
(DE BREDUCE_DATESTAMP NIL (SYSTO_DATESTAMP)) 
(ENDMODULE) 