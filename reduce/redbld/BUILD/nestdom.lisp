(cl:declaim (cl:optimize cl:debug cl:safety))
(cl:declaim (sb-ext:muffle-conditions sb-ext:compiler-note cl:style-warning))
(MODULE (LIST 'NESTDOM)) 
(PUT 'IDENT 'NUMBER-OF-ARGS 1) 
(PUT 'IDENT 'DEFINED-ON-LINE '40) 
(PUT 'IDENT 'DEFINED-IN-FILE 'MATRIX/NESTDOM.RED) 
(PUT 'IDENT 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE IDENT (X) X) 
(PUT '|:AR:| '|:NEST:| 'IDENT) 
(DE NESTLEVEL (U) (COND ((FIXP U) 0) (T (CADR U)))) 
(PUT 'NESTLEVEL 'NUMBER-OF-ARGS 1) 
(PUT 'NESTLEVEL 'DEFINED-ON-LINE '48) 
(PUT 'NESTLEVEL 'DEFINED-IN-FILE 'MATRIX/NESTDOM.RED) 
(PUT 'NESTLEVEL 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(PUTC 'NESTLEVEL 'INLINE '(LAMBDA (U) (COND ((FIXP U) 0) (T (CADR U))))) 
(DE NESTDMODE (U) (COND ((FIXP U) NIL) (T (CADDR U)))) 
(PUT 'NESTDMODE 'NUMBER-OF-ARGS 1) 
(PUT 'NESTDMODE 'DEFINED-ON-LINE '49) 
(PUT 'NESTDMODE 'DEFINED-IN-FILE 'MATRIX/NESTDOM.RED) 
(PUT 'NESTDMODE 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(PUTC 'NESTDMODE 'INLINE '(LAMBDA (U) (COND ((FIXP U) NIL) (T (CADDR U))))) 
(DE NESTSQ (U) (COND ((FIXP U) (SIMP U)) (T (CDDDR U)))) 
(PUT 'NESTSQ 'NUMBER-OF-ARGS 1) 
(PUT 'NESTSQ 'DEFINED-ON-LINE '50) 
(PUT 'NESTSQ 'DEFINED-IN-FILE 'MATRIX/NESTDOM.RED) 
(PUT 'NESTSQ 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(PUTC 'NESTSQ 'INLINE '(LAMBDA (U) (COND ((FIXP U) (SIMP U)) (T (CDDDR U))))) 
(GLOBAL '(DOMAINLIST*)) 
(FLUID '(ALGLIST* NESTLEVEL*)) 
(SETQ NESTLEVEL* 0) 
(SWITCH (LIST 'NESTED)) 
(SETQ DOMAINLIST* (UNION '(|:NEST:|) DOMAINLIST*)) 
(PUT 'NESTED 'TAG '|:NEST:|) 
(PUT '|:NEST:| 'DNAME 'NESTED) 
(FLAG '(|:NEST:|) 'FIELD) 
(FLAG '(|:NEST:|) 'CONVERT) 
(PUT '|:NEST:| 'I2D '*I2NEST) 
(PUT '|:NEST:| '|:BF:| (MKDMODERR '|:NEST:| '|:BF:|)) 
(PUT '|:NEST:| '|:FT:| (MKDMODERR '|:NEST:| '|:FT:|)) 
(PUT '|:NEST:| '|:RN:| (MKDMODERR '|:NEST:| '|:RN:|)) 
(PUT '|:NEST:| 'MINUSP '|NESTMINUSP:|) 
(PUT '|:NEST:| 'PLUS '|NESTPLUS:|) 
(PUT '|:NEST:| 'TIMES '|NESTTIMES:|) 
(PUT '|:NEST:| 'DIFFERENCE '|NESTDIFFERENCE:|) 
(PUT '|:NEST:| 'QUOTIENT '|NESTQUOTIENT:|) 
(PUT '|:NEST:| 'DIVIDE '|NESTDIVIDE:|) 
(PUT '|:NEST:| 'ZEROP '|NESTZEROP:|) 
(PUT '|:NEST:| 'ONEP '|NESTONEP:|) 
(PUT '|:NEST:| 'PREPFN '|NESTPREP:|) 
(PUT '|:NEST:| 'PRIFN 'PRIN2) 
(PUT '|:RN:| '|:NEST:| 'RN2NEST) 
(PUT '*I2NEST 'NUMBER-OF-ARGS 1) 
(PUT '*I2NEST 'DEFINED-ON-LINE '86) 
(PUT '*I2NEST 'DEFINED-IN-FILE 'MATRIX/NESTDOM.RED) 
(PUT '*I2NEST 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE *I2NEST (U)
    (COND ((OR (ATOM U) (ATOM (CAR U))) U)
          (T (CONS '|:NEST:| (CONS 0 (CONS DMODE* (CONS U 1))))))) 
(PUT 'RN2NEST 'NUMBER-OF-ARGS 1) 
(PUT 'RN2NEST 'DEFINED-ON-LINE '91) 
(PUT 'RN2NEST 'DEFINED-IN-FILE 'MATRIX/NESTDOM.RED) 
(PUT 'RN2NEST 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE RN2NEST (U)
    (COND ((OR (ATOM U) (ATOM (CAR U))) U)
          (T (CONS '|:NEST:| (CONS 0 (CONS DMODE* (CDR U))))))) 
(PUT 'NESTCNV 'NUMBER-OF-ARGS 1) 
(PUT 'NESTCNV 'DEFINED-ON-LINE '97) 
(PUT 'NESTCNV 'DEFINED-IN-FILE 'MATRIX/NESTDOM.RED) 
(PUT 'NESTCNV 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE NESTCNV (U)
    (REDERR
     (LIST "Conversion between `nested' and" (GET (CAR U) 'DNAME)
           "not defined"))) 
(PUT '|NESTMINUSP:| 'NUMBER-OF-ARGS 1) 
(PUT '|NESTMINUSP:| 'DEFINED-ON-LINE '101) 
(PUT '|NESTMINUSP:| 'DEFINED-IN-FILE 'MATRIX/NESTDOM.RED) 
(PUT '|NESTMINUSP:| 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE |NESTMINUSP:| (U)
    (AND (EQUAL (COND ((FIXP U) 0) (T (CADR U))) 0)
         (MINUSF (CAR (COND ((FIXP U) (SIMP U)) (T (CDDDR U))))))) 
(PUT 'SQ2NESTEDF 'NUMBER-OF-ARGS 1) 
(PUT 'SQ2NESTEDF 'DEFINED-ON-LINE '104) 
(PUT 'SQ2NESTEDF 'DEFINED-IN-FILE 'MATRIX/NESTDOM.RED) 
(PUT 'SQ2NESTEDF 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE SQ2NESTEDF (SQ) (CONS '|:NEST:| (CONS NESTLEVEL* (CONS DMODE* SQ)))) 
(PUT '|NEST2OP:| 'NUMBER-OF-ARGS 3) 
(PUT '|NEST2OP:| 'DEFINED-ON-LINE '107) 
(PUT '|NEST2OP:| 'DEFINED-IN-FILE 'MATRIX/NESTDOM.RED) 
(PUT '|NEST2OP:| 'PROCEDURE_TYPE
     '(ARROW (TIMES GENERAL GENERAL GENERAL) GENERAL)) 
(DE |NEST2OP:| (U V OP)
    ((LAMBDA (DMODE*)
       (PROG (R NLU NLV NLR DM NESTLEVEL*)
         (SETQ NLU
                 (COND ((NOT (EQCAR U '|:NEST:|)) 0)
                       (T (COND ((FIXP U) 0) (T (CADR U))))))
         (SETQ NLV
                 (COND ((NOT (EQCAR V '|:NEST:|)) 0)
                       (T (COND ((FIXP V) 0) (T (CADR V))))))
         (COND ((EQUAL NLU NLV) (GO CASE1)) ((IGREATERP NLU NLV) (GO CASE2))
               (T (GO CASE3)))
        CASE1
         (SETQ DM (COND ((FIXP U) NIL) (T (CADDR U))))
         (COND (DM (SETDMODE DM T)))
         (SETQ NLR NLU)
         (SETQ NESTLEVEL* (DIFFERENCE NLU 1))
         (SETQ R
                 (APPLY OP
                        (LIST (COND ((FIXP U) (SIMP U)) (T (CDDDR U)))
                              (COND ((FIXP V) (SIMP V)) (T (CDDDR V))))))
         (GO READY)
        CASE2
         (SETQ DM (COND ((FIXP U) NIL) (T (CADDR U))))
         (COND (DM (SETDMODE DM T)))
         (SETQ NLR NLU)
         (SETQ NESTLEVEL* NLV)
         (SETQ R
                 (APPLY OP
                        (LIST (COND ((FIXP U) (SIMP U)) (T (CDDDR U)))
                              (CONS V 1))))
         (GO READY)
        CASE3
         (SETQ DM (COND ((FIXP V) NIL) (T (CADDR V))))
         (COND (DM (SETDMODE DM T)))
         (SETQ NLR NLV)
         (SETQ NESTLEVEL* NLU)
         (SETQ R
                 (APPLY OP
                        (LIST (CONS U 1)
                              (COND ((FIXP V) (SIMP V)) (T (CDDDR V))))))
        READY
         (SETQ R
                 (COND ((NULL (CAR R)) NIL)
                       ((AND (OR (ATOM (CAR R)) (ATOM (CAR (CAR R))))
                             (EQUAL (CDR R) 1))
                        (CAR R))
                       (T (CONS '|:NEST:| (CONS NLR (CONS DM R))))))
         (COND (DM (SETDMODE DM NIL)))
         (RETURN R)))
     NIL)) 
(PUT '|NESTPLUS:| 'NUMBER-OF-ARGS 2) 
(PUT '|NESTPLUS:| 'DEFINED-ON-LINE '144) 
(PUT '|NESTPLUS:| 'DEFINED-IN-FILE 'MATRIX/NESTDOM.RED) 
(PUT '|NESTPLUS:| 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE |NESTPLUS:| (U V) (|NEST2OP:| U V 'ADDSQ)) 
(PUT '|NESTTIMES:| 'NUMBER-OF-ARGS 2) 
(PUT '|NESTTIMES:| 'DEFINED-ON-LINE '146) 
(PUT '|NESTTIMES:| 'DEFINED-IN-FILE 'MATRIX/NESTDOM.RED) 
(PUT '|NESTTIMES:| 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE |NESTTIMES:| (U V) (|NEST2OP:| U V 'MULTSQ)) 
(PUT '|NESTDIFFERENCE:| 'NUMBER-OF-ARGS 2) 
(PUT '|NESTDIFFERENCE:| 'DEFINED-ON-LINE '148) 
(PUT '|NESTDIFFERENCE:| 'DEFINED-IN-FILE 'MATRIX/NESTDOM.RED) 
(PUT '|NESTDIFFERENCE:| 'PROCEDURE_TYPE
     '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE |NESTDIFFERENCE:| (U V)
    (|NEST2OP:| U V (FUNCTION (LAMBDA (X Y) (ADDSQ X (NEGSQ Y)))))) 
(PUT '|NESTDIVIDE:| 'NUMBER-OF-ARGS 2) 
(PUT '|NESTDIVIDE:| 'DEFINED-ON-LINE '151) 
(PUT '|NESTDIVIDE:| 'DEFINED-IN-FILE 'MATRIX/NESTDOM.RED) 
(PUT '|NESTDIVIDE:| 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE |NESTDIVIDE:| (U V) (CONS (|NEST2OP:| U V 'QUOTSQ) 1)) 
(PUT '|NESTQUOTIENT:| 'NUMBER-OF-ARGS 2) 
(PUT '|NESTQUOTIENT:| 'DEFINED-ON-LINE '155) 
(PUT '|NESTQUOTIENT:| 'DEFINED-IN-FILE 'MATRIX/NESTDOM.RED) 
(PUT '|NESTQUOTIENT:| 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE |NESTQUOTIENT:| (U V) (|NEST2OP:| U V 'QUOTSQ)) 
(PUT '|NESTZEROP:| 'NUMBER-OF-ARGS 1) 
(PUT '|NESTZEROP:| 'DEFINED-ON-LINE '157) 
(PUT '|NESTZEROP:| 'DEFINED-IN-FILE 'MATRIX/NESTDOM.RED) 
(PUT '|NESTZEROP:| 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE |NESTZEROP:| (U) (NULL (CAR (COND ((FIXP U) (SIMP U)) (T (CDDDR U)))))) 
(PUT '|NESTONEP:| 'NUMBER-OF-ARGS 1) 
(PUT '|NESTONEP:| 'DEFINED-ON-LINE '159) 
(PUT '|NESTONEP:| 'DEFINED-IN-FILE 'MATRIX/NESTDOM.RED) 
(PUT '|NESTONEP:| 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE |NESTONEP:| (U)
    ((LAMBDA (V) (AND (EQUAL (CAR V) 1) (EQUAL (CDR V) 1)))
     (COND ((FIXP U) (SIMP U)) (T (CDDDR U))))) 
(INITDMODE 'NESTED) 
(PUT 'SETNEST 'NUMBER-OF-ARGS 1) 
(PUT 'SETNEST 'DEFINED-ON-LINE '168) 
(PUT 'SETNEST 'DEFINED-IN-FILE 'MATRIX/NESTDOM.RED) 
(PUT 'SETNEST 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE SETNEST (U)
    (PROG ()
      (SETQ U (REVAL1 U T))
      (COND ((NOT (FIXP U)) (TYPERR U "nestulus")))
      (SETQ NESTLEVEL* U))) 
(FLAG '(SETNEST) 'OPFN) 
(FLAG '(SETNEST) 'NOVAL) 
(AEVAL (OPERATOR (LIST 'CO))) 
(PUT 'SIMPCO 'NUMBER-OF-ARGS 1) 
(PUT 'SIMPCO 'DEFINED-ON-LINE '181) 
(PUT 'SIMPCO 'DEFINED-IN-FILE 'MATRIX/NESTDOM.RED) 
(PUT 'SIMPCO 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE SIMPCO (U)
    (PROG (SQ LEV)
      (COND
       ((NOT (AND (EQUAL (LENGTH U) 2) (FIXP (CAR U))))
        (TYPERR U "nested coefficient")))
      (SETQ SQ (SIMP (CADR U)))
      (SETQ LEV (CAR U))
      (RETURN
       (CONS
        (COND ((NULL (CAR SQ)) NIL)
              (T (CONS '|:NEST:| (CONS LEV (CONS DMODE* SQ)))))
        1)))) 
(PUT 'CO 'SIMPFN 'SIMPCO) 
(PUT '|NESTPREP:| 'NUMBER-OF-ARGS 1) 
(PUT '|NESTPREP:| 'DEFINED-ON-LINE '194) 
(PUT '|NESTPREP:| 'DEFINED-IN-FILE 'MATRIX/NESTDOM.RED) 
(PUT '|NESTPREP:| 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE |NESTPREP:| (U)
    (LIST 'CO (COND ((FIXP U) 0) (T (CADR U)))
          (PREPSQ (COND ((FIXP U) (SIMP U)) (T (CDDDR U)))))) 
(ENDMODULE) 