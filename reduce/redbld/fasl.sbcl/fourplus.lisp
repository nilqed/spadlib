(cl:declaim (cl:optimize cl:debug cl:safety))
(cl:declaim (sb-ext:muffle-conditions sb-ext:compiler-note cl:style-warning))
(MODULE (LIST 'FOURPLUS)) 
(PUT '|FS:PLUS:| 'NUMBER-OF-ARGS 2) 
(PUT '|FS:PLUS:| 'DEFINED-ON-LINE '32) 
(PUT '|FS:PLUS:| 'DEFINED-IN-FILE 'CAMAL/FOURPLUS.RED) 
(PUT '|FS:PLUS:| 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE |FS:PLUS:| (X Y)
    (COND ((|FS:ZEROP:| Y) X) ((|FS:ZEROP:| X) Y)
          (T
           (CONS (GET 'FOURIER 'TAG)
                 (|FS:PLUS| (COPY-TREE (CDR X)) (COPY-TREE (CDR Y))))))) 
(PUT 'COPY-TREE 'NUMBER-OF-ARGS 1) 
(PUT 'COPY-TREE 'DEFINED-ON-LINE '41) 
(PUT 'COPY-TREE 'DEFINED-IN-FILE 'CAMAL/FOURPLUS.RED) 
(PUT 'COPY-TREE 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE COPY-TREE (X)
    (COND ((NULL X) NIL)
          (T
           (PROG (ANS)
             (SETQ ANS (MKVECT 3))
             (PUTV ANS 0 (GETV X 0))
             (PUTV ANS 1 (GETV X 1))
             (PUTV ANS 2 (GETV X 2))
             (PUTV ANS 3 (COPY-TREE (GETV X 3)))
             (RETURN ANS))))) 
(PUT '|FS:PLUS| 'NUMBER-OF-ARGS 2) 
(PUT '|FS:PLUS| 'DEFINED-ON-LINE '52) 
(PUT '|FS:PLUS| 'DEFINED-IN-FILE 'CAMAL/FOURPLUS.RED) 
(PUT '|FS:PLUS| 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE |FS:PLUS| (X Y)
    (COND ((NULL Y) X) ((NULL X) Y)
          ((AND (EQUAL (GETV X 1) (GETV Y 1))
                (ANGLES-EQUAL (GETV X 2) (GETV Y 2)))
           (PROG (COEF)
             (SETQ COEF (ADDSQ (GETV X 0) (GETV Y 0)))
             (COND
              ((NULL (CAR COEF)) (RETURN (|FS:PLUS| (GETV X 3) (GETV Y 3)))))
             (PUTV X 0 COEF)
             (PUTV X 3 (|FS:PLUS| (GETV X 3) (GETV Y 3)))
             (RETURN X)))
          ((|FS:ANGLE-ORDER| X Y)
           (PROGN (PUTV X 3 (|FS:PLUS| (GETV X 3) Y)) X))
          (T (PROGN (PUTV Y 3 (|FS:PLUS| (GETV Y 3) X)) Y)))) 
(PUT 'ANGLES-EQUAL 'NUMBER-OF-ARGS 2) 
(PUT 'ANGLES-EQUAL 'DEFINED-ON-LINE '74) 
(PUT 'ANGLES-EQUAL 'DEFINED-IN-FILE 'CAMAL/FOURPLUS.RED) 
(PUT 'ANGLES-EQUAL 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE ANGLES-EQUAL (X Y)
    (PROG (I)
      (SETQ I 0)
     TOP
      (COND ((NOT (EQUAL (GETV X I) (GETV Y I))) (RETURN NIL)))
      (SETQ I (PLUS I 1))
      (COND ((LESSP I 8) (GO TOP)))
      (RETURN T))) 
(PUT '|FS:ANGLE-ORDER| 'NUMBER-OF-ARGS 2) 
(PUT '|FS:ANGLE-ORDER| 'DEFINED-ON-LINE '85) 
(PUT '|FS:ANGLE-ORDER| 'DEFINED-IN-FILE 'CAMAL/FOURPLUS.RED) 
(PUT '|FS:ANGLE-ORDER| 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE |FS:ANGLE-ORDER| (X Y)
    (PROG (ANS I XX YY)
      (SETQ I 0)
      (SETQ XX (GETV X 2))
      (SETQ YY (GETV Y 2))
     TOP
      (SETQ ANS (DIFFERENCE (GETV XX I) (GETV YY I)))
      (COND ((NOT (EQUAL ANS 0)) (RETURN (GREATERP ANS 0))))
      (SETQ I (PLUS I 1))
      (COND ((LESSP I 8) (GO TOP)))
      (RETURN
       (COND ((EQUAL (GETV X 1) (GETV Y 1)) NIL) ((EQUAL (GETV X 1) 'SIN) NIL)
             (T T))))) 
(ENDMODULE) 