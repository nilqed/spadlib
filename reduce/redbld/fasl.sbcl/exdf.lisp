(cl:declaim (cl:optimize cl:debug cl:safety))
(cl:declaim (sb-ext:muffle-conditions sb-ext:compiler-note cl:style-warning))
(MODULE (LIST 'EXDF)) 
(FLUID '(SUBFG*)) 
(GLOBAL '(NATURALFRAME2COFRAME DBASEFORM2BASE2FORM BASISFORML* DIMEX*)) 
(PUT 'D 'SIMPFN 'SIMPEXDF) 
(PUT 'D 'RTYPEFN 'GETRTYPECAR) 
(PUT 'D 'PARTITFN 'PARTITEXDF) 
(PUT 'PARTITEXDF 'NUMBER-OF-ARGS 1) 
(PUT 'PARTITEXDF 'DEFINED-ON-LINE '40) 
(PUT 'PARTITEXDF 'DEFINED-IN-FILE 'EXCALC/EXDF.RED) 
(PUT 'PARTITEXDF 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE PARTITEXDF (U) (EXDFPF (PARTITOP (CAR U)))) 
(PUT 'SIMPEXDF 'NUMBER-OF-ARGS 1) 
(PUT 'SIMPEXDF 'DEFINED-ON-LINE '43) 
(PUT 'SIMPEXDF 'DEFINED-IN-FILE 'EXCALC/EXDF.RED) 
(PUT 'SIMPEXDF 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE SIMPEXDF (U) (*PF2SQ (PARTITEXDF U))) 
(PUT 'MKEXDF 'NUMBER-OF-ARGS 1) 
(PUT 'MKEXDF 'DEFINED-ON-LINE '46) 
(PUT 'MKEXDF 'DEFINED-IN-FILE 'EXCALC/EXDF.RED) 
(PUT 'MKEXDF 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE MKEXDF (U)
    (PROG (X Y)
      (RETURN
       (COND ((SETQ X (OPMTCH (SETQ Y (LIST 'D U)))) (PARTITOP X))
             (T (MKUPF Y)))))) 
(PUT 'EXDFPF 'NUMBER-OF-ARGS 1) 
(PUT 'EXDFPF 'DEFINED-ON-LINE '53) 
(PUT 'EXDFPF 'DEFINED-IN-FILE 'EXCALC/EXDF.RED) 
(PUT 'EXDFPF 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE EXDFPF (U)
    (COND ((NULL U) NIL)
          (T
           (ADDPF
            (COND ((EQUAL (CAAR U) 1) (EXDF0 (CDAR U)))
                  (T
                   (ADDPF (MULTPFSQ (EXDFK (CAAR U)) (CDAR U))
                    (MKUNIQUEWEDGE
                     (WEDGEPF2 (EXDF0 (CDAR U))
                      (CONS (CONS (LIST (CAAR U)) (CONS 1 1)) NIL))))))
            (EXDFPF (CDR U)))))) 
(PUT 'EXDFK 'NUMBER-OF-ARGS 1) 
(PUT 'EXDFK 'DEFINED-ON-LINE '62) 
(PUT 'EXDFK 'DEFINED-IN-FILE 'EXCALC/EXDF.RED) 
(PUT 'EXDFK 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE EXDFK (U)
    (COND
     ((OR (EQUAL U 1) (EQCAR U 'D) (DIM<=DEG U) (FLAGP (LID U) 'CLOSED)) NIL)
     ((OR (FLAGP 'D 'NOXPND) (SMEMQLP LFTSHFT* U)) (MKEXDF U))
     ((ATOMF U)
      (COND
       ((AND (NOT (FLAGP 'PARTDF 'NOXPND)) (FLAGP (LID U) 'IMPFUN))
        (DIMPFUN U (CDR (ASSOC (LID U) DEPL*))))
       ((COORDP U)
        (COND (SUBFG* (*PFSQ2PF (CDR (ATSOC U NATURALFRAME2COFRAME))))
              (T (MKEXDF U))))
       ((AND (BASISFORMP U) DBASEFORM2BASE2FORM)
        (*PFSQ2PF (CDR (ATSOC U DBASEFORM2BASE2FORM))))
       (T (MKEXDF U))))
     ((EQ (CAR U) 'WEDGE) (DWEDGE (CDR U)))
     ((MEMQ (CAR U) '(HODGE INNERPROD LIEDF)) (MKEXDF U))
     ((EQ (CAR U) 'PARTDF)
      (COND
       ((AND (NOT (FLAGP 'PARTDF 'NOXPND)) (ATOMF (CADR U)))
        (DIMPFUN U (CDR (ASSOC (LID (CADR U)) DEPL*))))
       (T (MKEXDF U))))
     (T
      (PROG (X Y Z)
        (COND ((NULL (SETQ X (GET (CAR U) (DFN_PROP U)))) (RETURN (MKEXDF U))))
        (SETQ Z (CDR U))
        (PROG (J)
          (SETQ J
                  (PROG (K FORALL-RESULT FORALL-ENDPTR)
                    (SETQ K Z)
                    (COND ((NULL K) (RETURN NIL)))
                    (SETQ FORALL-RESULT
                            (SETQ FORALL-ENDPTR
                                    (CONS
                                     ((LAMBDA (K) (PARTITEXDF (LIST K)))
                                      (CAR K))
                                     NIL)))
                   LOOPLABEL
                    (SETQ K (CDR K))
                    (COND ((NULL K) (RETURN FORALL-RESULT)))
                    (RPLACD FORALL-ENDPTR
                            (CONS ((LAMBDA (K) (PARTITEXDF (LIST K))) (CAR K))
                                  NIL))
                    (SETQ FORALL-ENDPTR (CDR FORALL-ENDPTR))
                    (GO LOOPLABEL)))
         LAB
          (COND ((NULL J) (RETURN NIL)))
          ((LAMBDA (J)
             (PROGN
              (COND
               (J
                (SETQ Y
                        (ADDPF
                         (MULTPFSQ J (SIMP (SUBLA (PAIR (CAAR X) Z) (CDAR X))))
                         Y))))
              (SETQ X (CDR X))))
           (CAR J))
          (SETQ J (CDR J))
          (GO LAB))
        (RETURN Y))))) 
(PUT 'LID 'NUMBER-OF-ARGS 1) 
(PUT 'LID 'DEFINED-ON-LINE '95) 
(PUT 'LID 'DEFINED-IN-FILE 'EXCALC/EXDF.RED) 
(PUT 'LID 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE LID (U) (COND ((ATOM U) U) (T (CAR U)))) 
(PUT 'ATOMF 'NUMBER-OF-ARGS 1) 
(PUT 'ATOMF 'DEFINED-ON-LINE '98) 
(PUT 'ATOMF 'DEFINED-IN-FILE 'EXCALC/EXDF.RED) 
(PUT 'ATOMF 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE ATOMF (U) (OR (ATOM U) (FLAGP (CAR U) 'INDEXVAR))) 
(PUT 'DIM<=DEG 'NUMBER-OF-ARGS 1) 
(PUT 'DIM<=DEG 'DEFINED-ON-LINE '101) 
(PUT 'DIM<=DEG 'DEFINED-IN-FILE 'EXCALC/EXDF.RED) 
(PUT 'DIM<=DEG 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE DIM<=DEG (U)
    ((LAMBDA (X) (OR (NULL X) (AND (FIXP X) (LEQ X 0))))
     (ADDF DIMEX* (NEGF (DEG*FORM U))))) 
(PUT 'DIM<DEG 'NUMBER-OF-ARGS 1) 
(PUT 'DIM<DEG 'DEFINED-ON-LINE '105) 
(PUT 'DIM<DEG 'DEFINED-IN-FILE 'EXCALC/EXDF.RED) 
(PUT 'DIM<DEG 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE DIM<DEG (U)
    (PROG (X)
      (SETQ X (ADDF DIMEX* (NEGF (DEG*FARG U))))
      (RETURN (COND ((AND (NUMBERP X) (MINUSP X)) T) (T NIL))))) 
(PUT 'DIMPFUN 'NUMBER-OF-ARGS 2) 
(PUT 'DIMPFUN 'DEFINED-ON-LINE '112) 
(PUT 'DIMPFUN 'DEFINED-IN-FILE 'EXCALC/EXDF.RED) 
(PUT 'DIMPFUN 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE DIMPFUN (U V)
    (COND ((NULL V) NIL)
          (T
           (ADDPF
            (MULTPFSQ (EXDFP0 (CONS (CAR V) 1)) (PARTDFSQ (SIMP U) (CAR V)))
            (DIMPFUN U (CDR V)))))) 
(PUT 'EXDF0 'NUMBER-OF-ARGS 1) 
(PUT 'EXDF0 'DEFINED-ON-LINE '117) 
(PUT 'EXDF0 'DEFINED-IN-FILE 'EXCALC/EXDF.RED) 
(PUT 'EXDF0 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE EXDF0 (U)
    (MULTPFSQ (ADDPF (EXDFF0 (CAR U)) (MULTPFSQ (EXDFF0 (NEGF (CDR U))) U))
     (CONS 1 (CDR U)))) 
(PUT 'EXDFF0 'NUMBER-OF-ARGS 1) 
(PUT 'EXDFF0 'DEFINED-ON-LINE '121) 
(PUT 'EXDFF0 'DEFINED-IN-FILE 'EXCALC/EXDF.RED) 
(PUT 'EXDFF0 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE EXDFF0 (U)
    (COND ((OR (ATOM U) (ATOM (CAR U))) NIL)
          (T
           (ADDPF
            (ADDPF
             (MULTSQPF (CONS (LIST (CONS (CAAR U) 1)) 1) (EXDFF0 (CDAR U)))
             (MULTPFSQ (EXDFP0 (CAAR U)) (CONS (CDAR U) 1)))
            (EXDFF0 (CDR U)))))) 
(PUT 'EXDFP0 'NUMBER-OF-ARGS 1) 
(PUT 'EXDFP0 'DEFINED-ON-LINE '127) 
(PUT 'EXDFP0 'DEFINED-IN-FILE 'EXCALC/EXDF.RED) 
(PUT 'EXDFP0 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE EXDFP0 (U)
    (PROG (PV N Z)
      (SETQ PV (CAR U))
      (SETQ N (CDR U))
      (RETURN
       (COND
        ((AND (OR (SFP PV) (EXFORMP PV) (NULL SUBFG*))
              (SETQ Z (COND ((SFP PV) (EXDFF0 PV)) (T (EXDFK PV)))))
         (COND ((EQUAL N 1) Z)
               (T
                (MULTPFSQ Z
                 (CONS (LIST (CONS (CONS PV (DIFFERENCE N 1)) N)) 1)))))
        (T NIL))))) 
(PUT 'DWEDGE 'NUMBER-OF-ARGS 1) 
(PUT 'DWEDGE 'DEFINED-ON-LINE '139) 
(PUT 'DWEDGE 'DEFINED-IN-FILE 'EXCALC/EXDF.RED) 
(PUT 'DWEDGE 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE DWEDGE (U)
    (COND ((FLAGP 'D 'NOXPND) (NOXPNDDWEDGE (PARTITWEDGE U)))
          (T (MKUNIQUEWEDGE (DWEDGE1 U NIL))))) 
(PUT 'NOXPNDDWEDGE 'NUMBER-OF-ARGS 1) 
(PUT 'NOXPNDDWEDGE 'DEFINED-ON-LINE '144) 
(PUT 'NOXPNDDWEDGE 'DEFINED-IN-FILE 'EXCALC/EXDF.RED) 
(PUT 'NOXPNDDWEDGE 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE NOXPNDDWEDGE (U)
    (COND ((NULL U) NIL)
          (T
           (ADDPF (MULTPFSQ (EXDFK (CAAR U)) (CDAR U))
            (NOXPNDDWEDGE (CDR U)))))) 
(PUT 'DWEDGE1 'NUMBER-OF-ARGS 2) 
(PUT 'DWEDGE1 'DEFINED-ON-LINE '148) 
(PUT 'DWEDGE1 'DEFINED-IN-FILE 'EXCALC/EXDF.RED) 
(PUT 'DWEDGE1 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE DWEDGE1 (U V)
    (COND
     ((NULL (CDR U)) (MKUNARYWEDGE (MULTPFSQ (EXDFK (CAR U)) (MKSGNSQ V))))
     (T
      (ADDPF
       (WEDGEPF2 (CONS (CONS (CAR U) (CONS 1 1)) NIL)
        (DWEDGE1 (CDR U) (ADDF V (DEG*FORM (CAR U)))))
       (MULTPFSQ
        (WEDGEPF2 (EXDFK (CAR U)) (CONS (CONS (CDR U) (CONS 1 1)) NIL))
        (MKSGNSQ V)))))) 
(PUT 'EXDFPRN 'NUMBER-OF-ARGS 1) 
(PUT 'EXDFPRN 'DEFINED-ON-LINE '155) 
(PUT 'EXDFPRN 'DEFINED-IN-FILE 'EXCALC/EXDF.RED) 
(PUT 'EXDFPRN 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE EXDFPRN (U) (PROGN (PRIN2* "d") (REMBRAS (CADR U)))) 
(PUT 'D 'PRIFN 'EXDFPRN) 
(PUT 'XEXDFPRN 'NUMBER-OF-ARGS 1) 
(PUT 'XEXDFPRN 'DEFINED-ON-LINE '160) 
(PUT 'XEXDFPRN 'DEFINED-IN-FILE 'EXCALC/EXDF.RED) 
(PUT 'XEXDFPRN 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE XEXDFPRN (U)
    (PROG (W)
      (SETQ W (FANCY-PRIN2* "\\,d\\," 2))
      (RETURN (FANCY-MAPRINT (CADR U) 0)))) 
(PUT 'D 'FANCY-PRIFN 'XEXDFPRN) 
(ENDMODULE) 