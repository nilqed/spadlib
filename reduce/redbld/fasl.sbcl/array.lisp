(cl:declaim (cl:optimize cl:debug cl:safety))
(cl:declaim (sb-ext:muffle-conditions sb-ext:compiler-note cl:style-warning))
(MODULE (LIST 'ARRAY)) 
(FLUID '(*RLISP88)) 
(GLOBAL '(ERFG*)) 
(PUT 'GETEL 'NUMBER-OF-ARGS 1) 
(PUT 'GETEL 'DEFINED-ON-LINE '38) 
(PUT 'GETEL 'DEFINED-IN-FILE 'RLISP/ARRAY.RED) 
(PUT 'GETEL 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE GETEL (U)
    ((LAMBDA (N)
       (COND
        ((NEQ (LENGTH N) (LENGTH (CDR U)))
         (RERROR 'RLISP 21 "Incorrect array reference"))
        (T (GETEL1 (CADR (GET (CAR U) 'AVALUE)) (CDR U) N))))
     (GET (CAR U) 'DIMENSION))) 
(PUT 'GETEL1 'NUMBER-OF-ARGS 3) 
(PUT 'GETEL1 'DEFINED-ON-LINE '45) 
(PUT 'GETEL1 'DEFINED-IN-FILE 'RLISP/ARRAY.RED) 
(PUT 'GETEL1 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL GENERAL) GENERAL)) 
(DE GETEL1 (U V DIMS)
    (COND ((NULL V) U) ((NOT (FIXP (CAR V))) (TYPERR (CAR V) "array index"))
          ((OR (GEQ (CAR V) (CAR DIMS)) (LESSP (CAR V) 0))
           (RERROR 'RLISP 21 "Array out of bounds"))
          (T (GETEL1 (GETV U (CAR V)) (CDR V) (CDR DIMS))))) 
(PUT 'SETEL 'NUMBER-OF-ARGS 2) 
(PUT 'SETEL 'DEFINED-ON-LINE '52) 
(PUT 'SETEL 'DEFINED-IN-FILE 'RLISP/ARRAY.RED) 
(PUT 'SETEL 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE SETEL (U V)
    ((LAMBDA (N)
       (COND
        ((NEQ (LENGTH N) (LENGTH (CDR U)))
         (RERROR 'RLISP 22 "Incorrect array reference"))
        (T (SETEL1 (CADR (GET (CAR U) 'AVALUE)) (CDR U) V N))))
     (GET (CAR U) 'DIMENSION))) 
(PUT 'SETEL1 'NUMBER-OF-ARGS 4) 
(PUT 'SETEL1 'DEFINED-ON-LINE '59) 
(PUT 'SETEL1 'DEFINED-IN-FILE 'RLISP/ARRAY.RED) 
(PUT 'SETEL1 'PROCEDURE_TYPE
     '(ARROW (TIMES GENERAL GENERAL GENERAL GENERAL) GENERAL)) 
(DE SETEL1 (U V W DIMS)
    (COND ((NOT (FIXP (CAR V))) (TYPERR (CAR V) "array index"))
          ((OR (GEQ (CAR V) (CAR DIMS)) (LESSP (CAR V) 0))
           (RERROR 'RLISP 23 "Array out of bounds"))
          ((NULL (CDR V)) (PUTV U (CAR V) W))
          (T (SETEL1 (GETV U (CAR V)) (CDR V) W (CDR DIMS))))) 
(PUT 'DIMENSION 'NUMBER-OF-ARGS 1) 
(PUT 'DIMENSION 'DEFINED-ON-LINE '66) 
(PUT 'DIMENSION 'DEFINED-IN-FILE 'RLISP/ARRAY.RED) 
(PUT 'DIMENSION 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE DIMENSION (U) (GET U 'DIMENSION)) 
(PUT 'TYPECHK 'NUMBER-OF-ARGS 2) 
(PUT 'TYPECHK 'DEFINED-ON-LINE '71) 
(PUT 'TYPECHK 'DEFINED-IN-FILE 'RLISP/ARRAY.RED) 
(PUT 'TYPECHK 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE TYPECHK (U V)
    (PROG (X)
      (COND
       ((OR (EQ (SETQ X (GETTYPE U)) V) (EQUAL X 'PARAMETER))
        (LPRIM (LIST V U "redefined")))
       (X (TYPERR (LIST X U) V))))) 
(PUT 'ARRAYFN 'NUMBER-OF-ARGS 2) 
(PUT 'ARRAYFN 'DEFINED-ON-LINE '78) 
(PUT 'ARRAYFN 'DEFINED-IN-FILE 'RLISP/ARRAY.RED) 
(PUT 'ARRAYFN 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE ARRAYFN (U V)
    (PROG (Y)
      (PROG (X)
        (SETQ X V)
       LAB
        (COND ((NULL X) (RETURN NIL)))
        ((LAMBDA (X)
           (PROGN
            (TYPECHK (CAR X) 'ARRAY)
            (SETQ Y
                    (ADD1LIS
                     (PROG (Z FORALL-RESULT FORALL-ENDPTR)
                       (SETQ Z (CDR X))
                       (COND ((NULL Z) (RETURN NIL)))
                       (SETQ FORALL-RESULT
                               (SETQ FORALL-ENDPTR
                                       (CONS
                                        ((LAMBDA (Z) (LISPEVAL Z)) (CAR Z))
                                        NIL)))
                      LOOPLABEL
                       (SETQ Z (CDR Z))
                       (COND ((NULL Z) (RETURN FORALL-RESULT)))
                       (RPLACD FORALL-ENDPTR
                               (CONS ((LAMBDA (Z) (LISPEVAL Z)) (CAR Z)) NIL))
                       (SETQ FORALL-ENDPTR (CDR FORALL-ENDPTR))
                       (GO LOOPLABEL))))
            (COND
             ((NULL ERFG*)
              (PROGN
               (PUT (CAR X) 'RTYPE 'ARRAY)
               (PUT (CAR X) 'AVALUE (LIST 'ARRAY (MKARRAY1 Y U)))
               (PUT (CAR X) 'DIMENSION Y))))))
         (CAR X))
        (SETQ X (CDR X))
        (GO LAB)))) 
(FLAG '(ARRAYFN) 'NOCHANGE) 
(PUT 'ADD1LIS 'NUMBER-OF-ARGS 1) 
(PUT 'ADD1LIS 'DEFINED-ON-LINE '94) 
(PUT 'ADD1LIS 'DEFINED-IN-FILE 'RLISP/ARRAY.RED) 
(PUT 'ADD1LIS 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE ADD1LIS (U)
    (COND ((NULL U) NIL) (T (CONS (PLUS (CAR U) 1) (ADD1LIS (CDR U)))))) 
(PUT 'MKARRAY 'DEFINED-ON-LINE '97) 
(PUT 'MKARRAY 'DEFINED-IN-FILE 'RLISP/ARRAY.RED) 
(PUT 'MKARRAY 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DM MKARRAY (U)
    (COND ((NULL *RLISP88) (MKARRAY1 U 'ALGEBRAIC))
          (T (LIST 'MKAR1 (CONS 'LIST (CDR U)))))) 
(PUT 'MKARRAY1 'NUMBER-OF-ARGS 2) 
(PUT 'MKARRAY1 'DEFINED-ON-LINE '101) 
(PUT 'MKARRAY1 'DEFINED-IN-FILE 'RLISP/ARRAY.RED) 
(PUT 'MKARRAY1 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE MKARRAY1 (U V)
    (COND ((NULL U) (COND ((EQUAL V 'SYMBOLIC) NIL) (T 0)))
          (T
           (PROG (N X)
             (SETQ N 0)
             (SETQ N (DIFFERENCE (CAR U) 1))
             (SETQ X (MKVECT N))
             (PROG (I)
               (SETQ I 0)
              LAB
               (COND ((MINUSP (DIFFERENCE N I)) (RETURN NIL)))
               (PUTV X I (MKARRAY1 (CDR U) V))
               (SETQ I (PLUS2 I 1))
               (GO LAB))
             (RETURN X))))) 
(PUT 'ARRAY 'STAT 'RLIS) 
(FLAG '(ARRAY ARRAYFN) 'EVAL) 
(PUT 'FORMARRAY 'NUMBER-OF-ARGS 3) 
(PUT 'FORMARRAY 'DEFINED-ON-LINE '116) 
(PUT 'FORMARRAY 'DEFINED-IN-FILE 'RLISP/ARRAY.RED) 
(PUT 'FORMARRAY 'PROCEDURE_TYPE
     '(ARROW (TIMES GENERAL GENERAL GENERAL) GENERAL)) 
(DE FORMARRAY (U VARS MODE)
    (PROG (X)
      (SETQ X (CDR U))
      (PROG ()
       WHILELABEL
        (COND ((NOT X) (RETURN NIL)))
        (PROGN
         (COND ((ATOM X) (TYPERR X "Array List"))
               ((OR (ATOM (CAR X)) (NOT (IDP (CAAR X))) (NOT (LISTP (CDAR X))))
                (TYPERR (CAR X) "Array declaration")))
         (SETQ X (CDR X)))
        (GO WHILELABEL))
      (SETQ U
              (PROG (Z FORALL-RESULT FORALL-ENDPTR)
                (SETQ Z (CDR U))
                (COND ((NULL Z) (RETURN NIL)))
                (SETQ FORALL-RESULT
                        (SETQ FORALL-ENDPTR
                                (CONS
                                 ((LAMBDA (Z) (INTARGFN Z VARS MODE)) (CAR Z))
                                 NIL)))
               LOOPLABEL
                (SETQ Z (CDR Z))
                (COND ((NULL Z) (RETURN FORALL-RESULT)))
                (RPLACD FORALL-ENDPTR
                        (CONS ((LAMBDA (Z) (INTARGFN Z VARS MODE)) (CAR Z))
                              NIL))
                (SETQ FORALL-ENDPTR (CDR FORALL-ENDPTR))
                (GO LOOPLABEL)))
      (RETURN (LIST 'ARRAYFN (MKQUOTE MODE) (CONS 'LIST U))))) 
(PUT 'ARRAY 'FORMFN 'FORMARRAY) 
(PUT 'ARRAY 'RTYPEFN 'ARRAYCHK) 
(PUT 'ARRAYCHK 'NUMBER-OF-ARGS 1) 
(PUT 'ARRAYCHK 'DEFINED-ON-LINE '133) 
(PUT 'ARRAYCHK 'DEFINED-IN-FILE 'RLISP/ARRAY.RED) 
(PUT 'ARRAYCHK 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE ARRAYCHK (U) (COND ((NULL U) 'ARRAY) (T NIL))) 
(PUT 'ARRAY 'EVFN 'ARRAYEVAL) 
(PUT 'ARRAYEVAL 'NUMBER-OF-ARGS 2) 
(PUT 'ARRAYEVAL 'DEFINED-ON-LINE '141) 
(PUT 'ARRAYEVAL 'DEFINED-IN-FILE 'RLISP/ARRAY.RED) 
(PUT 'ARRAYEVAL 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE ARRAYEVAL (U V)
    (COND ((NOT (ATOM U)) (RERROR 'RLISP 24 "Array arithmetic not defined"))
          (T U))) 
(PUT 'ARRAY 'LENGTHFN 'ARRAYLENGTH) 
(PUT 'ARRAYLENGTH 'NUMBER-OF-ARGS 1) 
(PUT 'ARRAYLENGTH 'DEFINED-ON-LINE '148) 
(PUT 'ARRAYLENGTH 'DEFINED-IN-FILE 'RLISP/ARRAY.RED) 
(PUT 'ARRAYLENGTH 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE ARRAYLENGTH (U) (CONS 'LIST (GET U 'DIMENSION))) 
(ENDMODULE) 