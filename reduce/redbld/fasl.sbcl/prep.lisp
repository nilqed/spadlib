(cl:declaim (cl:optimize cl:debug cl:safety))
(cl:declaim (sb-ext:muffle-conditions sb-ext:compiler-note cl:style-warning))
(MODULE (LIST 'PREP)) 
(FLUID '(*BOOL *INTSTR)) 
(PUT 'PREPSQXX 'NUMBER-OF-ARGS 1) 
(PUT 'PREPSQXX 'DEFINED-ON-LINE '34) 
(PUT 'PREPSQXX 'DEFINED-IN-FILE 'ALG/PREP.RED) 
(PUT 'PREPSQXX 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE PREPSQXX (U) (NEGNUMBERCHK (PREPSQX U))) 
(PUT 'NEGNUMBERCHK 'NUMBER-OF-ARGS 1) 
(PUT 'NEGNUMBERCHK 'DEFINED-ON-LINE '40) 
(PUT 'NEGNUMBERCHK 'DEFINED-IN-FILE 'ALG/PREP.RED) 
(PUT 'NEGNUMBERCHK 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE NEGNUMBERCHK (U)
    (COND
     ((EQCAR U 'MINUS)
      (PROGN
       (COND ((NUMBERP (CADR U)) (MINUS (CADR U)))
             ((EQCAR (CADR U) '|:RD:|) (|RD:MINUS| (CADR U))) (T U))))
     (T U))) 
(PUT 'PREPSQX 'NUMBER-OF-ARGS 1) 
(PUT 'PREPSQX 'DEFINED-ON-LINE '48) 
(PUT 'PREPSQX 'DEFINED-IN-FILE 'ALG/PREP.RED) 
(PUT 'PREPSQX 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE PREPSQX (U) (COND (*INTSTR (PREPSQ* U)) (T (PREPSQ U)))) 
(PUT 'PREPSQ 'NUMBER-OF-ARGS 1) 
(PUT 'PREPSQ 'DEFINED-ON-LINE '51) 
(PUT 'PREPSQ 'DEFINED-IN-FILE 'ALG/PREP.RED) 
(PUT 'PREPSQ 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE PREPSQ (U) (COND ((NULL (CAR U)) 0) (T (SQFORM U (FUNCTION PREPF))))) 
(PUT 'SQFORM 'NUMBER-OF-ARGS 2) 
(PUT 'SQFORM 'DEFINED-ON-LINE '54) 
(PUT 'SQFORM 'DEFINED-IN-FILE 'ALG/PREP.RED) 
(PUT 'SQFORM 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE SQFORM (U V)
    ((LAMBDA (X Y) (COND ((EQUAL Y 1) X) (T (LIST 'QUOTIENT X Y))))
     (APPLY1 V (CAR U)) (APPLY1 V (CDR U)))) 
(PUT 'OLDPREPF 'NUMBER-OF-ARGS 1) 
(PUT 'OLDPREPF 'DEFINED-ON-LINE '61) 
(PUT 'OLDPREPF 'DEFINED-IN-FILE 'ALG/PREP.RED) 
(PUT 'OLDPREPF 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE OLDPREPF (U)
    ((LAMBDA (X) (COND ((NULL X) 0) (T (REPLUS X)))) (OLDPREPF1 U NIL))) 
(PUT 'PREPF 'NUMBER-OF-ARGS 1) 
(PUT 'PREPF 'DEFINED-ON-LINE '64) 
(PUT 'PREPF 'DEFINED-IN-FILE 'ALG/PREP.RED) 
(PUT 'PREPF 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE PREPF (U) (REPLUS1 (PREPF1A U NIL))) 
(PUT 'OLDPREPF1 'NUMBER-OF-ARGS 2) 
(PUT 'OLDPREPF1 'DEFINED-ON-LINE '73) 
(PUT 'OLDPREPF1 'DEFINED-IN-FILE 'ALG/PREP.RED) 
(PUT 'OLDPREPF1 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE OLDPREPF1 (U V)
    (COND ((NULL U) NIL)
          ((OR (ATOM U) (ATOM (CAR U)))
           (LIST (RETIMES (CONS (PREPD U) (EXCHK V)))))
          (T
           (NCONC*
            (OLDPREPF1 (CDAR U)
                       (COND ((EQ (CAAAR U) 'K*) V) (T (CONS (CAAR U) V))))
            (OLDPREPF1 (CDR U) V))))) 
(PUT 'PREPF1 'NUMBER-OF-ARGS 2) 
(PUT 'PREPF1 'DEFINED-ON-LINE '86) 
(PUT 'PREPF1 'DEFINED-IN-FILE 'ALG/PREP.RED) 
(PUT 'PREPF1 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE PREPF1 (U V) (REVERSIP (PREPF1_REVERSED U V NIL))) 
(PUT 'PREPF1_REVERSED 'NUMBER-OF-ARGS 3) 
(PUT 'PREPF1_REVERSED 'DEFINED-ON-LINE '93) 
(PUT 'PREPF1_REVERSED 'DEFINED-IN-FILE 'ALG/PREP.RED) 
(PUT 'PREPF1_REVERSED 'PROCEDURE_TYPE
     '(ARROW (TIMES GENERAL GENERAL GENERAL) GENERAL)) 
(DE PREPF1_REVERSED (U V R)
    (PROG ()
     TOP
      (COND ((NULL U) (RETURN R))
            ((OR (ATOM U) (ATOM (CAR U)))
             (RETURN (CONS (RETIMES (CONS (PREPD U) (EXCHK V))) R))))
      (SETQ R
              (PREPF1_REVERSED (CDAR U)
                               (COND ((EQ (CAAAR U) 'K*) V)
                                     (T (CONS (CAAR U) V)))
                               R))
      (SETQ U (CDR U))
      (GO TOP))) 
(PUT 'PREPF1A 'NUMBER-OF-ARGS 2) 
(PUT 'PREPF1A 'DEFINED-ON-LINE '111) 
(PUT 'PREPF1A 'DEFINED-IN-FILE 'ALG/PREP.RED) 
(PUT 'PREPF1A 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE PREPF1A (U V) (REVERSIP (PREPF1A_REVERSED U V NIL))) 
(PUT 'PREPF1A_REVERSED 'NUMBER-OF-ARGS 3) 
(PUT 'PREPF1A_REVERSED 'DEFINED-ON-LINE '114) 
(PUT 'PREPF1A_REVERSED 'DEFINED-IN-FILE 'ALG/PREP.RED) 
(PUT 'PREPF1A_REVERSED 'PROCEDURE_TYPE
     '(ARROW (TIMES GENERAL GENERAL GENERAL) GENERAL)) 
(DE PREPF1A_REVERSED (U V R)
    (PROG ()
     TOP
      (COND ((NULL U) (RETURN R))
            ((OR (ATOM U) (ATOM (CAR U)))
             (RETURN
              (PROG (Z)
                (SETQ Z (RETIMES (CONS (PREPD U) (EXCHK V))))
                (COND
                 ((EQCAR Z 'PLUS)
                  (PROGN
                   (PROG (Y)
                     (SETQ Y (CDR Z))
                    LAB
                     (COND ((NULL Y) (RETURN NIL)))
                     ((LAMBDA (Y) (SETQ R (CONS Y R))) (CAR Y))
                     (SETQ Y (CDR Y))
                     (GO LAB))))
                 ((EQCAR Z 'DIFFERENCE)
                  (PROGN
                   (SETQ R (CONS (CADR Z) R))
                   (SETQ R (CONS (LIST 'MINUS (CADDR Z)) R))))
                 (T (SETQ R (CONS Z R))))
                (RETURN R)))))
      (SETQ R
              (PREPF1A_REVERSED (CDAR U)
                                (COND ((EQ (CAAAR U) 'K*) V)
                                      (T (CONS (CAAR U) V)))
                                R))
      (SETQ U (CDR U))
      (GO TOP))) 
(PUT 'PREPD 'NUMBER-OF-ARGS 1) 
(PUT 'PREPD 'DEFINED-ON-LINE '144) 
(PUT 'PREPD 'DEFINED-IN-FILE 'ALG/PREP.RED) 
(PUT 'PREPD 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE PREPD (U)
    (COND ((ATOM U) (COND ((LESSP U 0) (LIST 'MINUS (MINUS U))) (T U)))
          ((APPLY1 (GET (CAR U) 'MINUSP) U)
           ((LAMBDA (X) (COND ((NULL X) 0) (T (LIST 'MINUS X))))
            (PREPD1 (|:MINUS| U))))
          (T (APPLY1 (GET (CAR U) 'PREPFN) U)))) 
(PUT 'PREPD1 'NUMBER-OF-ARGS 1) 
(PUT 'PREPD1 'DEFINED-ON-LINE '153) 
(PUT 'PREPD1 'DEFINED-IN-FILE 'ALG/PREP.RED) 
(PUT 'PREPD1 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE PREPD1 (U) (COND ((ATOM U) U) (T (APPLY1 (GET (CAR U) 'PREPFN) U)))) 
(PUT 'EXCHK 'NUMBER-OF-ARGS 1) 
(PUT 'EXCHK 'DEFINED-ON-LINE '167) 
(PUT 'EXCHK 'DEFINED-IN-FILE 'ALG/PREP.RED) 
(PUT 'EXCHK 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE EXCHK (U) (EXCHK1 U NIL NIL NIL)) 
(PUT 'EXCHK1 'NUMBER-OF-ARGS 4) 
(PUT 'EXCHK1 'DEFINED-ON-LINE '169) 
(PUT 'EXCHK1 'DEFINED-IN-FILE 'ALG/PREP.RED) 
(PUT 'EXCHK1 'PROCEDURE_TYPE
     '(ARROW (TIMES GENERAL GENERAL GENERAL GENERAL) GENERAL)) 
(DE EXCHK1 (U V W X)
    (COND ((NULL U) (EXCHK2 (APPEND X W) V))
          ((EQCAR (CAAR U) 'EXPT)
           (PROG (Y Z)
             (SETQ Y
                     (SIMPEXPON1 (LIST 'TIMES (CDAR U) (CADDAR (CAR U)))
                                 'SIMP*))
             (COND
              ((NUMBERP (CADAAR U))
               (PROGN
                (SETQ Z (ASSOC2 Y X))
                (COND (Z (RPLACA Z (TIMES (CAR Z) (CADAAR U))))
                      (T (SETQ X (CONS (CONS (CADAAR U) Y) X))))))
              (T
               (PROGN
                (SETQ Z (ASSOC (CADAAR U) W))
                (COND (Z (RPLACD Z (ADDSQ Y (CDR Z))))
                      (T (SETQ W (CONS (CONS (CADAAR U) Y) W)))))))
             (RETURN (EXCHK1 (CDR U) V W X))))
          ((EQUAL (CDAR U) 1) (EXCHK1 (CDR U) (CONS (SQCHK (CAAR U)) V) W X))
          (T
           (EXCHK1 (CDR U) (CONS (LIST 'EXPT (SQCHK (CAAR U)) (CDAR U)) V) W
                   X)))) 
(PUT 'EXCHK2 'NUMBER-OF-ARGS 2) 
(PUT 'EXCHK2 'DEFINED-ON-LINE '190) 
(PUT 'EXCHK2 'DEFINED-IN-FILE 'ALG/PREP.RED) 
(PUT 'EXCHK2 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE EXCHK2 (U V)
    (COND ((NULL U) V)
          (T
           (EXCHK2 (CDR U)
                   (CONS
                    ((LAMBDA (X)
                       (COND ((EQUAL X 1) (CAAR U))
                             (*NOSQRTS (LIST 'EXPT (CAAR U) X))
                             ((EQUAL X '(QUOTIENT 1 2)) (LIST 'SQRT (CAAR U)))
                             ((EQUAL X 0.5) (LIST 'SQRT (CAAR U)))
                             (T (LIST 'EXPT (CAAR U) X))))
                     (PREPSQX (CDAR U)))
                    V))))) 
(PUT 'ASSOC2 'NUMBER-OF-ARGS 2) 
(PUT 'ASSOC2 'DEFINED-ON-LINE '203) 
(PUT 'ASSOC2 'DEFINED-IN-FILE 'ALG/PREP.RED) 
(PUT 'ASSOC2 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE ASSOC2 (U V)
    (COND ((NULL V) NIL) ((EQUAL U (CDAR V)) (CAR V)) (T (ASSOC2 U (CDR V))))) 
(PUT 'REPLUS 'NUMBER-OF-ARGS 1) 
(PUT 'REPLUS 'DEFINED-ON-LINE '209) 
(PUT 'REPLUS 'DEFINED-IN-FILE 'ALG/PREP.RED) 
(PUT 'REPLUS 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE REPLUS (U)
    (COND ((NULL U) 0) ((ATOM U) U) ((NULL (CDR U)) (CAR U))
          (T (CONS 'PLUS (UNPLUS U))))) 
(PUT 'REPLUS1 'NUMBER-OF-ARGS 1) 
(PUT 'REPLUS1 'DEFINED-ON-LINE '219) 
(PUT 'REPLUS1 'DEFINED-IN-FILE 'ALG/PREP.RED) 
(PUT 'REPLUS1 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE REPLUS1 (U)
    (COND ((NULL U) 0) ((OR (ATOM U) (AND (EQCAR U 'PLUS) (CDR U))) U)
          ((NULL (CDR U)) (CAR U)) (T (CONS 'PLUS U)))) 
(PUT 'UNPLUS 'NUMBER-OF-ARGS 1) 
(PUT 'UNPLUS 'DEFINED-ON-LINE '225) 
(PUT 'UNPLUS 'DEFINED-IN-FILE 'ALG/PREP.RED) 
(PUT 'UNPLUS 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE UNPLUS (U)
    (COND ((ATOM U) U) ((EQUAL (CAR U) 'PLUS) (UNPLUS (CDR U)))
          ((OR (ATOM (CAR U)) (NOT (EQCAR (CAR U) 'PLUS)))
           (CONS (CAR U) (UNPLUS (CDR U))))
          (T (APPEND (CDAR U) (UNPLUS (CDR U)))))) 
(PUT 'RETIMES 'NUMBER-OF-ARGS 1) 
(PUT 'RETIMES 'DEFINED-ON-LINE '250) 
(PUT 'RETIMES 'DEFINED-IN-FILE 'ALG/PREP.RED) 
(PUT 'RETIMES 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE RETIMES (U)
    (PROG (*BOOL)
      (SETQ U (RETIMES1 U))
      (SETQ U (COND ((NULL U) 1) ((CDR U) (CONS 'TIMES U)) (T (CAR U))))
      (RETURN (COND (*BOOL (LIST 'MINUS U)) (T U))))) 
(PUT 'RETIMES1 'NUMBER-OF-ARGS 1) 
(PUT 'RETIMES1 'DEFINED-ON-LINE '259) 
(PUT 'RETIMES1 'DEFINED-IN-FILE 'ALG/PREP.RED) 
(PUT 'RETIMES1 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE RETIMES1 (U)
    (COND ((NULL U) NIL) ((EQUAL (CAR U) 1) (RETIMES1 (CDR U)))
          ((MINUSP (CAR U))
           (PROGN
            (SETQ *BOOL (NOT *BOOL))
            (RETIMES1 (CONS (MINUS (CAR U)) (CDR U)))))
          ((ATOM (CAR U)) (CONS (CAR U) (RETIMES1 (CDR U))))
          ((EQ (CAAR U) 'MINUS)
           (PROGN
            (SETQ *BOOL (NOT *BOOL))
            (RETIMES1 (CONS (CADAR U) (CDR U)))))
          ((EQ (CAAR U) 'TIMES) (RETIMES1 (APPEND (CDAR U) (CDR U))))
          (T (CONS (CAR U) (RETIMES1 (CDR U)))))) 
(PUT 'SQCHK 'NUMBER-OF-ARGS 1) 
(PUT 'SQCHK 'DEFINED-ON-LINE '270) 
(PUT 'SQCHK 'DEFINED-IN-FILE 'ALG/PREP.RED) 
(PUT 'SQCHK 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE SQCHK (U)
    (COND ((ATOM U) U)
          (T
           ((LAMBDA (X)
              (COND (X (APPLY1 X U)) ((ATOM (CAR U)) U) (T (PREPF U))))
            (GET (CAR U) 'PREPFN2))))) 
(PUT '*SQ 'PREPFN2 'PREPCADR) 
(PUT 'EXPT 'PREPFN2 'PREPEXPT) 
(PUT 'PREPCADR 'NUMBER-OF-ARGS 1) 
(PUT 'PREPCADR 'DEFINED-ON-LINE '279) 
(PUT 'PREPCADR 'DEFINED-IN-FILE 'ALG/PREP.RED) 
(PUT 'PREPCADR 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE PREPCADR (U) (PREPSQ (CADR U))) 
(PUT 'PREPEXPT 'NUMBER-OF-ARGS 1) 
(PUT 'PREPEXPT 'DEFINED-ON-LINE '281) 
(PUT 'PREPEXPT 'DEFINED-IN-FILE 'ALG/PREP.RED) 
(PUT 'PREPEXPT 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE PREPEXPT (U) (COND ((EQUAL (CADDR U) 1) (CADR U)) (T U))) 
(PUT '*HOLD 'PREPFN2 'PREPHOLD) 
(SWITCH (LIST (LIST 'EQUAL 'PREPHOLD 'ON))) 
(PUT 'PREPHOLD 'NUMBER-OF-ARGS 1) 
(PUT 'PREPHOLD 'DEFINED-ON-LINE '295) 
(PUT 'PREPHOLD 'DEFINED-IN-FILE 'ALG/PREP.RED) 
(PUT 'PREPHOLD 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE PREPHOLD (U)
    (COND ((OR (NOT *PREPHOLD) (ATOM U)) U)
          ((EQCAR U '*HOLD) (PREPHOLD (CADR U)))
          ((EQCAR U '*SQ) (PREPSQ (CADR U)))
          (T (CONS (PREPHOLD (CAR U)) (PREPHOLD (CDR U)))))) 
(ENDMODULE) 