(cl:declaim (cl:optimize cl:debug cl:safety))
(cl:declaim (sb-ext:muffle-conditions sb-ext:compiler-note cl:style-warning))
(FLUID '(PGSM_RCSID* PGSM_COPYRIGHT*)) 
(SETQ PGSM_RCSID* "$Id: pgsm.red 5872 2021-07-29 14:53:49Z arthurcnorman $") 
(SETQ PGSM_COPYRIGHT* "(c) 1998 A. Dolzmann, A. Seidl, T. Sturm, 2012 T. Sturm") 
(MODULE (LIST 'PGSM)) 
(EXPORTS
 (LIST 'SM_CREATE 'SM_RIGHTSIDESARENOTREDP 'SM_M 'SM_N 'SM_GET
       'SM_REDCOEFFICIENT 'SM_NONGREENCOEFFICIENT 'SM_SWAP 'SM_PUT 'SM_COPY
       'SM_FIRSTSTEP 'SM_GETCASE 'SM_PRINT)) 
(PUT 'SM_CREATE 'NUMBER-OF-ARGS 2) 
(PUT 'SM_CREATE 'DEFINED-ON-LINE '68) 
(PUT 'SM_CREATE 'DEFINED-IN-FILE 'PGAUSS/PGSM.RED) 
(PUT 'SM_CREATE 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE SM_CREATE (EL VL)
    (PROG (M N V ELP VLP SM)
      (SETQ M (LENGTH EL))
      (SETQ N (LENGTH VL))
      (SETQ SM (MKVECT M))
      (SETQ ELP EL)
      (PROG (L)
        (SETQ L 0)
       LAB
        (COND ((MINUSP (DIFFERENCE (DIFFERENCE M 1) L)) (RETURN NIL)))
        (PROGN
         (SETQ VLP VL)
         (PUTV SM L (SM_EQ2VEC (CAR ELP) VLP N))
         (SETQ ELP (CDR ELP)))
        (SETQ L (PLUS2 L 1))
        (GO LAB))
      (SETQ V (MKVECT N))
      (SETQ VLP VL)
      (PROG (C)
        (SETQ C 0)
       LAB
        (COND ((MINUSP (DIFFERENCE (DIFFERENCE N 1) C)) (RETURN NIL)))
        (PROGN (PUTV V C (CAR VLP)) (SETQ VLP (CDR VLP)))
        (SETQ C (PLUS2 C 1))
        (GO LAB))
      (PUTV SM M V)
      (RETURN SM))) 
(PUT 'SM_EQ2VEC 'NUMBER-OF-ARGS 3) 
(PUT 'SM_EQ2VEC 'DEFINED-ON-LINE '93) 
(PUT 'SM_EQ2VEC 'DEFINED-IN-FILE 'PGAUSS/PGSM.RED) 
(PUT 'SM_EQ2VEC 'PROCEDURE_TYPE
     '(ARROW (TIMES GENERAL GENERAL GENERAL) GENERAL)) 
(DE SM_EQ2VEC (EQT VL N)
    (PROG (OLDORDER V S P Q)
      (SETQ OLDORDER (SETKORDER VL))
      (SETQ V (MKVECT N))
      (SETQ S
              (ADDSQ (SIMP (EQT_LEFTSIDE EQT))
                     (NEGSQ (SIMP (EQT_RIGHTSIDE EQT)))))
      (SETQ P (CAR S))
      (SETQ Q (CDR S))
      (PROG (I)
        (SETQ I 0)
       LAB
        (COND ((MINUSP (DIFFERENCE (DIFFERENCE N 1) I)) (RETURN NIL)))
        (PROGN
         (SETKORDER VL)
         (SETQ P (REORDER P))
         (COND
          ((AND (NOT (OR (ATOM P) (ATOM (CAR P))))
                (NOT (OR (EQ (CDAAR P) 1) (NEQ (CAAAR P) (CAR VL)))))
           (REDERR
            (LIST "sm_eq2vec:"
                  "No degrees higher than 1 are allowed for indeterminants."))))
         (COND
          ((AND (NOT (OR (ATOM P) (ATOM (CAR P)))) (EQ (CAAAR P) (CAR VL)))
           (PROGN
            (PUTV V I (MULTSQ (CONS (CDAR P) 1) (INVSQ (CONS Q 1))))
            (SETQ S (ADDSQ S (NEGSQ (MULTSQ (SIMP (CAR VL)) (GETV V I)))))
            NIL))
          (T (PUTV V I (CONS NIL 1))))
         (SETQ VL (CDR VL))
         NIL)
        (SETQ I (PLUS2 I 1))
        (GO LAB))
      (PUTV V N (NEGSQ S))
      (SETKORDER OLDORDER)
      (RETURN V))) 
(PUT 'SM_RIGHTSIDESARENOTREDP 'NUMBER-OF-ARGS 3) 
(PUT 'SM_RIGHTSIDESARENOTREDP 'DEFINED-ON-LINE '125) 
(PUT 'SM_RIGHTSIDESARENOTREDP 'DEFINED-IN-FILE 'PGAUSS/PGSM.RED) 
(PUT 'SM_RIGHTSIDESARENOTREDP 'PROCEDURE_TYPE
     '(ARROW (TIMES GENERAL GENERAL GENERAL) GENERAL)) 
(DE SM_RIGHTSIDESARENOTREDP (CL SM SL)
    (PROG (ARENOTRED RSCOND TMP TMP2 L M N)
      (SETQ L 0)
      (SETQ M 0)
      (SETQ N 0)
      (SETQ ARENOTRED T)
      (SETQ M (SM_M SM))
      (SETQ N (SM_N SM))
      (SETQ L SL)
      (PG_VERBOSE (LIST "[sm_rightsidesarenotredp entered..."))
      (COND (*PGVERBOSE (SM_PRINT SM)))
      (PROG (I)
        (SETQ I SL)
       LAB
        (COND ((MINUSP (DIFFERENCE (DIFFERENCE M 1) I)) (RETURN NIL)))
        (SETQ TMP2 (CONS (COND_0MKEQT (CAR (SM_GET SM I N))) TMP2))
        (SETQ I (PLUS2 I 1))
        (GO LAB))
      (SETQ TMP2 (NCONC TMP2 CL))
      (COND (*PGVERBOSE (PROGN (PRIN2 "tmp2: ") (PRIN2T TMP2))))
      (SETQ RSCOND
              (COND ((AND TMP2 (CDR TMP2)) (CONS 'AND TMP2))
                    ((NULL TMP2) (COND ((EQ 'AND 'AND) 'TRUE) (T 'FALSE)))
                    (T (CAR TMP2))))
      (COND (*PGVERBOSE (PROGN (PRIN2 "rscond: ") (COND_PRIN2 RSCOND))))
      (COND (*PGVERBOSE (PROGN (PRIN2 "cl: ") (COND_PRIN2L CL))))
      (COND
       ((OR *PGSPSIMPL *PGSPQE)
        (SETQ ARENOTRED (COND ((COND_INCONSISTENTP TMP2) NIL) (T T))))
       (T
        (PROG ()
         WHILELABEL
          (COND ((NOT (AND (LEQ L (DIFFERENCE M 1)) ARENOTRED)) (RETURN NIL)))
          (COND ((SM_REDP CL (CAR (SM_GET SM L N))) (SETQ ARENOTRED NIL))
                (T (SETQ L (PLUS L 1))))
          (GO WHILELABEL))))
      (PG_VERBOSE (LIST "...leaving sm_rightsidesarenotredp " ARENOTRED "]"))
      (RETURN ARENOTRED))) 
(PUT 'SM_M 'NUMBER-OF-ARGS 1) 
(PUT 'SM_M 'DEFINED-ON-LINE '159) 
(PUT 'SM_M 'DEFINED-IN-FILE 'PGAUSS/PGSM.RED) 
(PUT 'SM_M 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE SM_M (SM) (UPBV SM)) 
(PUT 'SM_N 'NUMBER-OF-ARGS 1) 
(PUT 'SM_N 'DEFINED-ON-LINE '163) 
(PUT 'SM_N 'DEFINED-IN-FILE 'PGAUSS/PGSM.RED) 
(PUT 'SM_N 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE SM_N (SM) (UPBV (GETV SM 0))) 
(PUT 'SM_GET 'NUMBER-OF-ARGS 3) 
(PUT 'SM_GET 'DEFINED-ON-LINE '167) 
(PUT 'SM_GET 'DEFINED-IN-FILE 'PGAUSS/PGSM.RED) 
(PUT 'SM_GET 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL GENERAL) GENERAL)) 
(DE SM_GET (SM L C) (GETV (GETV SM L) C)) 
(PUT 'SM_REDCOEFFICIENT 'NUMBER-OF-ARGS 2) 
(PUT 'SM_REDCOEFFICIENT 'DEFINED-ON-LINE '172) 
(PUT 'SM_REDCOEFFICIENT 'DEFINED-IN-FILE 'PGAUSS/PGSM.RED) 
(PUT 'SM_REDCOEFFICIENT 'PROCEDURE_TYPE
     '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE SM_REDCOEFFICIENT (CL SM)
    (PROG (RCFOUND TMP L C M N)
      (SETQ L 0)
      (SETQ C 0)
      (SETQ M 0)
      (SETQ N 0)
      (SETQ M (SM_M SM))
      (SETQ N (SM_N SM))
      (PROG ()
       WHILELABEL
        (COND
         ((NOT (AND (LEQ L (DIFFERENCE M 1)) (NOT RCFOUND))) (RETURN NIL)))
        (PROGN
         (SETQ C 0)
         (PROG ()
          WHILELABEL
           (COND
            ((NOT (AND (LEQ C (DIFFERENCE N 1)) (NOT RCFOUND))) (RETURN NIL)))
           (COND ((SM_REDP CL (CAR (SM_GET SM L C))) (SETQ RCFOUND T))
                 (T (SETQ C (PLUS C 1))))
           (GO WHILELABEL))
         (COND ((NOT RCFOUND) (SETQ L (PLUS L 1)))))
        (GO WHILELABEL))
      (COND
       (RCFOUND
        (PROGN
         (COND
          (*PGVERBOSE
           (PROGN
            (PRIN2 "--redcoefficient found: ")
            (MATHPRINT (PREPSQ (SM_GET SM L C))))))
         (RETURN (CONS L C))))
       (T (RETURN NIL))))) 
(PUT 'SM_NONGREENCOEFFICIENT 'NUMBER-OF-ARGS 2) 
(PUT 'SM_NONGREENCOEFFICIENT 'DEFINED-ON-LINE '206) 
(PUT 'SM_NONGREENCOEFFICIENT 'DEFINED-IN-FILE 'PGAUSS/PGSM.RED) 
(PUT 'SM_NONGREENCOEFFICIENT 'PROCEDURE_TYPE
     '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE SM_NONGREENCOEFFICIENT (CL SM)
    (PROG (WCFOUND L C M N)
      (SETQ L 0)
      (SETQ C 0)
      (SETQ M 0)
      (SETQ N 0)
      (SETQ M (SM_M SM))
      (SETQ N (SM_N SM))
      (PROG ()
       WHILELABEL
        (COND
         ((NOT (AND (LEQ L (DIFFERENCE M 1)) (NOT WCFOUND))) (RETURN NIL)))
        (PROGN
         (SETQ C 0)
         (PROG ()
          WHILELABEL
           (COND
            ((NOT (AND (LEQ C (DIFFERENCE N 1)) (NOT WCFOUND))) (RETURN NIL)))
           (COND ((NOT (SM_GREENP CL (CAR (SM_GET SM L C)))) (SETQ WCFOUND T))
                 (T (SETQ C (PLUS C 1))))
           (GO WHILELABEL))
         (COND ((NOT WCFOUND) (SETQ L (PLUS L 1)))))
        (GO WHILELABEL))
      (COND
       (WCFOUND
        (PROGN
         (COND
          (*PGVERBOSE
           (PROGN
            (PRIN2 "--nongreencoefficient found: ")
            (MATHPRINT (PREPSQ (SM_GET SM L C))))))
         (RETURN (CONS L C))))
       (T (RETURN NIL))))) 
(PUT 'SM_REDP 'NUMBER-OF-ARGS 2) 
(PUT 'SM_REDP 'DEFINED-ON-LINE '240) 
(PUT 'SM_REDP 'DEFINED-IN-FILE 'PGAUSS/PGSM.RED) 
(PUT 'SM_REDP 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE SM_REDP (CL SF) (SM_SUREP CL (COND_0MKUNEQT SF))) 
(PUT 'SM_GREENP 'NUMBER-OF-ARGS 2) 
(PUT 'SM_GREENP 'DEFINED-ON-LINE '246) 
(PUT 'SM_GREENP 'DEFINED-IN-FILE 'PGAUSS/PGSM.RED) 
(PUT 'SM_GREENP 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE SM_GREENP (CL SF) (SM_SUREP CL (COND_0MKEQT SF))) 
(PUT 'SM_SUREP 'NUMBER-OF-ARGS 2) 
(PUT 'SM_SUREP 'DEFINED-ON-LINE '252) 
(PUT 'SM_SUREP 'DEFINED-IN-FILE 'PGAUSS/PGSM.RED) 
(PUT 'SM_SUREP 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE SM_SUREP (CL C)
    (COND
     ((AND *PGSPSIMPL *PGSPQE)
      (OR (COND ((EQ (RL_SIMPL C CL (MINUS 1)) 'TRUE) T))
          (COND
           ((EQ
             ((LAMBDA (*RLVERBOSE)
                (RL_QE (RL_ALL (LIST 'IMPL (CONS 'AND CL) C) NIL) NIL))
              NIL)
             'TRUE)
            T))))
     (*PGSPSIMPL (COND ((EQ (RL_SIMPL C CL (MINUS 1)) 'TRUE) T)))
     (*PGSPQE
      (COND
       ((EQ
         ((LAMBDA (*RLVERBOSE)
            (RL_QE (RL_ALL (LIST 'IMPL (CONS 'AND CL) C) NIL) NIL))
          NIL)
         'TRUE)
        T)))
     ((EQ (CAR C) 'EQUAL) (COND ((NULL (CADR C)) T)))
     ((AND (OR (ATOM (CADR C)) (ATOM (CAR (CADR C)))) (NOT (NULL (CADR C))))
      T))) 
(PUT 'SM_SWAP 'NUMBER-OF-ARGS 3) 
(PUT 'SM_SWAP 'DEFINED-ON-LINE '270) 
(PUT 'SM_SWAP 'DEFINED-IN-FILE 'PGAUSS/PGSM.RED) 
(PUT 'SM_SWAP 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL GENERAL) GENERAL)) 
(DE SM_SWAP (SM L C)
    (PROG (TMP)
      (SETQ TMP (GETV SM 0))
      (COND ((NOT (EQ L 0)) (PROGN (PUTV SM 0 (GETV SM L)) (PUTV SM L TMP))))
      (COND
       ((NOT (EQ C 0))
        (PROG (I)
          (SETQ I 0)
         LAB
          (COND ((MINUSP (DIFFERENCE (SM_M SM) I)) (RETURN NIL)))
          (PROGN
           (SETQ TMP (SM_GET SM I 0))
           (SM_PUT SM I 0 (SM_GET SM I C))
           (SM_PUT SM I C TMP)
           NIL)
          (SETQ I (PLUS2 I 1))
          (GO LAB)))))) 
(PUT 'SM_PUT 'NUMBER-OF-ARGS 4) 
(PUT 'SM_PUT 'DEFINED-ON-LINE '289) 
(PUT 'SM_PUT 'DEFINED-IN-FILE 'PGAUSS/PGSM.RED) 
(PUT 'SM_PUT 'PROCEDURE_TYPE
     '(ARROW (TIMES GENERAL GENERAL GENERAL GENERAL) GENERAL)) 
(DE SM_PUT (SM L C ENTRY) (PUTV (GETV SM L) C ENTRY)) 
(PUT 'SM_COPY 'NUMBER-OF-ARGS 3) 
(PUT 'SM_COPY 'DEFINED-ON-LINE '295) 
(PUT 'SM_COPY 'DEFINED-IN-FILE 'PGAUSS/PGSM.RED) 
(PUT 'SM_COPY 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL GENERAL) GENERAL)) 
(DE SM_COPY (SM SL SC)
    (PROG (NEWSM M N)
      (SETQ M 0)
      (SETQ N 0)
      (SETQ M (SM_M SM))
      (SETQ N (SM_N SM))
      (SETQ NEWSM (MKVECT (DIFFERENCE M SL)))
      (PROG (L)
        (SETQ L SL)
       LAB
        (COND ((MINUSP (DIFFERENCE M L)) (RETURN NIL)))
        (PROGN
         (PUTV NEWSM (DIFFERENCE L SL) (MKVECT (DIFFERENCE N SC)))
         (PROG (C)
           (SETQ C SC)
          LAB
           (COND ((MINUSP (DIFFERENCE N C)) (RETURN NIL)))
           (SM_PUT NEWSM (DIFFERENCE L SL) (DIFFERENCE C SC) (SM_GET SM L C))
           (SETQ C (PLUS2 C 1))
           (GO LAB)))
        (SETQ L (PLUS2 L 1))
        (GO LAB))
      (RETURN NEWSM))) 
(PUT 'SM_FIRSTSTEP 'NUMBER-OF-ARGS 1) 
(PUT 'SM_FIRSTSTEP 'DEFINED-ON-LINE '311) 
(PUT 'SM_FIRSTSTEP 'DEFINED-IN-FILE 'PGAUSS/PGSM.RED) 
(PUT 'SM_FIRSTSTEP 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE SM_FIRSTSTEP (SM)
    (PROG (L)
      (SETQ L 1)
     LAB
      (COND ((MINUSP (DIFFERENCE (DIFFERENCE (SM_M SM) 1) L)) (RETURN NIL)))
      (SM_ADDKL1TOL2 SM
       (NEGSQ (MULTSQ (SM_GET SM L 0) (INVSQ (SM_GET SM 0 0)))) 0 L)
      (SETQ L (PLUS2 L 1))
      (GO LAB))) 
(PUT 'SM_ADDKL1TOL2 'NUMBER-OF-ARGS 4) 
(PUT 'SM_ADDKL1TOL2 'DEFINED-ON-LINE '317) 
(PUT 'SM_ADDKL1TOL2 'DEFINED-IN-FILE 'PGAUSS/PGSM.RED) 
(PUT 'SM_ADDKL1TOL2 'PROCEDURE_TYPE
     '(ARROW (TIMES GENERAL GENERAL GENERAL GENERAL) GENERAL)) 
(DE SM_ADDKL1TOL2 (SM K L1 L2)
    (PROG (C)
      (SETQ C 0)
     LAB
      (COND ((MINUSP (DIFFERENCE (SM_N SM) C)) (RETURN NIL)))
      (SM_PUT SM L2 C (ADDSQ (MULTSQ K (SM_GET SM L1 C)) (SM_GET SM L2 C)))
      (SETQ C (PLUS2 C 1))
      (GO LAB))) 
(PUT 'SM_GETCASE 'NUMBER-OF-ARGS 1) 
(PUT 'SM_GETCASE 'DEFINED-ON-LINE '324) 
(PUT 'SM_GETCASE 'DEFINED-IN-FILE 'PGAUSS/PGSM.RED) 
(PUT 'SM_GETCASE 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE SM_GETCASE (SM)
    (COND ((EQ (SM_M SM) 1) 'PG_LCASE) ((EQ (SM_N SM) 1) 'PG_CCASE)
          (T 'PG_RCASE))) 
(PUT 'SM_PRINT 'NUMBER-OF-ARGS 1) 
(PUT 'SM_PRINT 'DEFINED-ON-LINE '333) 
(PUT 'SM_PRINT 'DEFINED-IN-FILE 'PGAUSS/PGSM.RED) 
(PUT 'SM_PRINT 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE SM_PRINT (SM)
    (PROG (N M)
      (SETQ N 0)
      (SETQ M 0)
      (SETQ M (UPBV SM))
      (SETQ N (UPBV (GETV SM 0)))
      (PROG (L)
        (SETQ L 0)
       LAB
        (COND ((MINUSP (DIFFERENCE (DIFFERENCE M 1) L)) (RETURN NIL)))
        (PROGN
         (TERPRI* NIL)
         (PROG (C)
           (SETQ C 0)
          LAB
           (COND ((MINUSP (DIFFERENCE N C)) (RETURN NIL)))
           (PROGN (MAPRIN (PREPSQ (SM_GET SM L C))) (MAPRIN '__))
           (SETQ C (PLUS2 C 1))
           (GO LAB))
         (TERPRI* T))
        (SETQ L (PLUS2 L 1))
        (GO LAB))
      (PROG (C)
        (SETQ C 0)
       LAB
        (COND ((MINUSP (DIFFERENCE (DIFFERENCE N 1) C)) (RETURN NIL)))
        (PROGN (PRIN2 (SM_GET SM M C)) (PRIN2 "   "))
        (SETQ C (PLUS2 C 1))
        (GO LAB))
      (TERPRI)
      (RETURN NIL))) 
(PUT 'CSM_CREATE 'NUMBER-OF-ARGS 2) 
(PUT 'CSM_CREATE 'DEFINED-ON-LINE '361) 
(PUT 'CSM_CREATE 'DEFINED-IN-FILE 'PGAUSS/PGSM.RED) 
(PUT 'CSM_CREATE 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE CSM_CREATE (C SM) (CONS C SM)) 
(PUT 'CSM_GETC 'NUMBER-OF-ARGS 1) 
(PUT 'CSM_GETC 'DEFINED-ON-LINE '366) 
(PUT 'CSM_GETC 'DEFINED-IN-FILE 'PGAUSS/PGSM.RED) 
(PUT 'CSM_GETC 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE CSM_GETC (CSM) (CAR CSM)) 
(PUT 'CSM_GETSM 'NUMBER-OF-ARGS 1) 
(PUT 'CSM_GETSM 'DEFINED-ON-LINE '371) 
(PUT 'CSM_GETSM 'DEFINED-IN-FILE 'PGAUSS/PGSM.RED) 
(PUT 'CSM_GETSM 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE CSM_GETSM (CSM) (CDR CSM)) 
(PUT 'CSM_COPY 'NUMBER-OF-ARGS 3) 
(PUT 'CSM_COPY 'DEFINED-ON-LINE '376) 
(PUT 'CSM_COPY 'DEFINED-IN-FILE 'PGAUSS/PGSM.RED) 
(PUT 'CSM_COPY 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL GENERAL) GENERAL)) 
(DE CSM_COPY (CSM SL SC)
    (CSM_CREATE (CSM_GETC CSM) (SM_COPY (CSM_GETSM CSM) SL SC))) 
(ENDMODULE) 