(cl:declaim (cl:optimize cl:debug cl:safety))
(cl:declaim (sb-ext:muffle-conditions sb-ext:compiler-note cl:style-warning))
(MODULE (LIST 'RANKS)) 
(FLUID '(ZERO)) 
(SETQ ZERO (MKOBJECT 0 'ZERO)) 
(PUT 'ADDRANK 'NUMBER-OF-ARGS 3) 
(PUT 'ADDRANK 'DEFINED-ON-LINE '34) 
(PUT 'ADDRANK 'DEFINED-IN-FILE 'REDUCE4/RANKS.RED) 
(PUT 'ADDRANK 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL GENERAL) GENERAL)) 
(DE ADDRANK (NAME ARITY COARITY)
    (PROG (M DISAMBOP X)
      (SETQ M (LENGTH ARITY))
      (SETQ DISAMBOP
              (MKRANKEDNAME NAME ARITY
               (COND ((ATOM COARITY) NIL) (T (CAR COARITY)))))
      (SETQ X (GET NAME 'RANKS))
      (COND
       ((NULL X)
        (PUT NAME 'RANKS
             (LIST (CONS M (LIST (MKRANKLIST ARITY DISAMBOP COARITY))))))
       (T (ADDRANK1 DISAMBOP ARITY X M COARITY))))) 
(PUT 'ADDRANK0 'NUMBER-OF-ARGS 3) 
(PUT 'ADDRANK0 'DEFINED-ON-LINE '46) 
(PUT 'ADDRANK0 'DEFINED-IN-FILE 'REDUCE4/RANKS.RED) 
(PUT 'ADDRANK0 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL GENERAL) GENERAL)) 
(DE ADDRANK0 (NAME ARITY COARITY)
    (PROG (M DISAMBOP X)
      (SETQ DISAMBOP (CAADR (CADADR COARITY)))
      (SETQ M (LENGTH ARITY))
      (SETQ X (GET NAME 'RANKS))
      (COND
       ((NULL X)
        (PUT NAME 'RANKS
             (LIST (CONS M (LIST (MKRANKLIST ARITY DISAMBOP COARITY))))))
       (T (ADDRANK1 DISAMBOP ARITY X M COARITY))))) 
(PUT 'ADDRANK1 'NUMBER-OF-ARGS 5) 
(PUT 'ADDRANK1 'DEFINED-ON-LINE '58) 
(PUT 'ADDRANK1 'DEFINED-IN-FILE 'REDUCE4/RANKS.RED) 
(PUT 'ADDRANK1 'PROCEDURE_TYPE
     '(ARROW (TIMES GENERAL GENERAL GENERAL GENERAL GENERAL) GENERAL)) 
(DE ADDRANK1 (DISAMBOP ARITY TREE NOARGS COARITY)
    (COND
     ((EQUAL NOARGS (CAAR TREE))
      (MERGERANK DISAMBOP ARITY (CDAR TREE) COARITY))
     ((GREATERP NOARGS (CAAR TREE))
      (RPLACA (RPLACD TREE (CONS (CAR TREE) (CDR TREE)))
              (LIST NOARGS (MKRANKLIST ARITY DISAMBOP COARITY))))
     ((NULL (CDR TREE))
      (RPLACD TREE (LIST (LIST NOARGS (MKRANKLIST ARITY DISAMBOP COARITY)))))
     (T (ADDRANK1 DISAMBOP ARITY (CDR TREE) NOARGS COARITY)))) 
(PUT 'MERGERANK 'NUMBER-OF-ARGS 4) 
(PUT 'MERGERANK 'DEFINED-ON-LINE '69) 
(PUT 'MERGERANK 'DEFINED-IN-FILE 'REDUCE4/RANKS.RED) 
(PUT 'MERGERANK 'PROCEDURE_TYPE
     '(ARROW (TIMES GENERAL GENERAL GENERAL GENERAL) GENERAL)) 
(DE MERGERANK (DISAMBOP ARITY TREE COARITY)
    (COND
     ((EQUAL (CAR ARITY) (CAAR TREE))
      (COND ((NULL (CDR ARITY)) (UPD_COARITY (CDAR TREE) COARITY))
            (T (MERGERANK DISAMBOP (CDR ARITY) (CDAR TREE) COARITY))))
     ((TYPE_GREATERP (CAAR TREE) (CAR ARITY))
      (RPLACA (RPLACD TREE (CONS (CAR TREE) (CDR TREE)))
              (MKRANKLIST ARITY DISAMBOP COARITY)))
     ((NULL (CDR TREE))
      (RPLACD TREE (LIST (MKRANKLIST ARITY DISAMBOP COARITY))))
     (T (MERGERANK DISAMBOP ARITY (CDR TREE) COARITY)))) 
(PUT 'MKRANKEDNAME 'NUMBER-OF-ARGS 3) 
(PUT 'MKRANKEDNAME 'DEFINED-ON-LINE '87) 
(PUT 'MKRANKEDNAME 'DEFINED-IN-FILE 'REDUCE4/RANKS.RED) 
(PUT 'MKRANKEDNAME 'PROCEDURE_TYPE
     '(ARROW (TIMES GENERAL GENERAL GENERAL) GENERAL)) 
(DE MKRANKEDNAME (NAME ARITY COARITY)
    (PROG (X Y)
      (COND (NAME (SETQ X (EXPLODE NAME)))
            (T
             (PROGN (SETQ X (EXPLODE (CAR ARITY))) (SETQ ARITY (CDR ARITY)))))
      (SETQ Y (EXPLODE2 "_"))
      (PROG (J)
        (SETQ J ARITY)
       LAB
        (COND ((NULL J) (RETURN NIL)))
        ((LAMBDA (J) (SETQ X (NCONC X (APPEND Y (EXPLODE J))))) (CAR J))
        (SETQ J (CDR J))
        (GO LAB))
      (COND
       (COARITY (SETQ X (NCONC X (APPEND (EXPLODE2 "!>") (EXPLODE COARITY))))))
      (RETURN (INTERN (COMPRESS X))))) 
(PUT 'MKRANKLIST 'NUMBER-OF-ARGS 3) 
(PUT 'MKRANKLIST 'DEFINED-ON-LINE '97) 
(PUT 'MKRANKLIST 'DEFINED-IN-FILE 'REDUCE4/RANKS.RED) 
(PUT 'MKRANKLIST 'PROCEDURE_TYPE
     '(ARROW (TIMES GENERAL GENERAL GENERAL) GENERAL)) 
(DE MKRANKLIST (ARITY NAME COARITY)
    (COND
     ((NULL (CDR ARITY))
      (LIST (CAR ARITY) 'LAMBDA (CAR COARITY) (CONS 'COND (CDR COARITY))))
     (T (LIST (CAR ARITY) (MKRANKLIST (CDR ARITY) NAME COARITY))))) 
(PUT 'UPD_COARITY 'NUMBER-OF-ARGS 2) 
(PUT 'UPD_COARITY 'DEFINED-ON-LINE '102) 
(PUT 'UPD_COARITY 'DEFINED-IN-FILE 'REDUCE4/RANKS.RED) 
(PUT 'UPD_COARITY 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE UPD_COARITY (U V)
    (PROG ()
      (SETQ U (CDADDR U))
      (COND ((AND (EQUAL (CADR V) (CAR U)) (NULL (CDR U))) (RETURN NIL))
            ((EQ (CAADR V) T) (ACONC U (CADR V)))
            (T (RPLACA (RPLACD U (CONS (CAR U) (CDR U))) (CADR V)))))) 
(PUT 'TYPE_GREATERP 'NUMBER-OF-ARGS 2) 
(PUT 'TYPE_GREATERP 'DEFINED-ON-LINE '111) 
(PUT 'TYPE_GREATERP 'DEFINED-IN-FILE 'REDUCE4/RANKS.RED) 
(PUT 'TYPE_GREATERP 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE TYPE_GREATERP (U V) (EQ U 'GENERIC)) 
(PUT 'ADDNULLARY 'NUMBER-OF-ARGS 2) 
(PUT 'ADDNULLARY 'DEFINED-ON-LINE '113) 
(PUT 'ADDNULLARY 'DEFINED-IN-FILE 'REDUCE4/RANKS.RED) 
(PUT 'ADDNULLARY 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE ADDNULLARY (ARITY PROPS)
    (PROG (X Y)
      (SETQ X (GET ARITY '*NULLARY*))
      (COND
       ((NULL X)
        (PUT ARITY '*NULLARY*
             (LIST 'LAMBDA (CAR PROPS) (CONS 'COND (CDR PROPS)))))
       (T
        (PUT ARITY '*NULLARY*
             (LIST 'LAMBDA (CADR X)
                   (CONS 'COND (CONS (CADR PROPS) (CDR (CADDR X)))))))))) 
(ENDMODULE) 