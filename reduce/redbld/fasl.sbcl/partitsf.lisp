(cl:declaim (cl:optimize cl:debug cl:safety))
(cl:declaim (sb-ext:muffle-conditions sb-ext:compiler-note cl:style-warning))
(MODULE (LIST 'PARTITSF)) 
(FLUID '(ALGLIST* *EXP)) 
(PUT 'PARTITOP 'NUMBER-OF-ARGS 1) 
(PUT 'PARTITOP 'DEFINED-ON-LINE '32) 
(PUT 'PARTITOP 'DEFINED-IN-FILE 'EXCALC/PARTITSF.RED) 
(PUT 'PARTITOP 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE PARTITOP (U)
    (PROG (X ALGLIST*)
      (SETQ ALGLIST* (CONS NIL NIL))
      (RETURN
       (COND
        ((ATOM U)
         (COND ((SETQ X (GET U 'AVALUE)) (PARTITSQ* (SIMP* (CADR X))))
               (((LAMBDA (X) (COND (X (CAR X)) (T NIL))) (GET U 'FDEGREE))
                (MKUPF U))
               ((CAR (SETQ X (SIMP* U))) (CONS (CONS 1 X) NIL)) (T NIL)))
        ((SETQ X (GET (CAR U) 'PARTITFN))
         (COND ((FLAGP (CAR U) 'FULL) (APPLY1 X U)) (T (APPLY1 X (CDR U)))))
        ((EQ (CAR U) '*SQ) (PARTITSQ* (SIMP* U)))
        ((EQ (CAR U) 'PLUS)
         (PROGN
          (PROG (J)
            (SETQ J (CDR U))
           LAB
            (COND ((NULL J) (RETURN NIL)))
            ((LAMBDA (J) (SETQ X (ADDPF (PARTITOP J) X))) (CAR J))
            (SETQ J (CDR J))
            (GO LAB))
          X))
        ((EQ (CAR U) 'MINUS) (MULTPFSQ (PARTITOP (CADR U)) (CONS (MINUS 1) 1)))
        ((EQ (CAR U) 'DIFFERENCE)
         (ADDPF (PARTITOP (CADR U))
          (MULTPFSQ (PARTITOP (CADDR U)) (CONS (MINUS 1) 1))))
        ((EQ (CAR U) 'TIMES)
         (PROGN
          (SETQ X (PARTITOP (CADR U)))
          (PROG (J)
            (SETQ J (CDDR U))
           LAB
            (COND ((NULL J) (RETURN NIL)))
            ((LAMBDA (J) (SETQ X (MULTPFS X (PARTITOP J)))) (CAR J))
            (SETQ J (CDR J))
            (GO LAB))
          X))
        ((EQ (CAR U) 'QUOTIENT)
         (MULTPFSQ (PARTITOP (CADR U)) (SIMPRECIP (CDDR U))))
        ((EQ (CAR U) 'RECIP) (CONS (CONS 1 (SIMPRECIP (CDR U))) NIL))
        ((CAR (SETQ X (SIMP* U))) (CONS (CONS 1 X) NIL)) (T NIL))))) 
(PUT 'MKUPF 'NUMBER-OF-ARGS 1) 
(PUT 'MKUPF 'DEFINED-ON-LINE '66) 
(PUT 'MKUPF 'DEFINED-IN-FILE 'EXCALC/PARTITSF.RED) 
(PUT 'MKUPF 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE MKUPF (U)
    (PROG (X)
      (SETQ X (MKSQ U 1))
      (RETURN
       (COND ((NULL (CAR X)) NIL)
             ((OR (ATOM (CAR X)) (ATOM (CAR (CAR X)))) (CONS (CONS 1 X) NIL))
             ((AND (EQUAL (CDR X) 1) (EQUAL (CDAR (CAR X)) 1)
                   (NULL (CDR (CAR X))) (NULL (SFP (CAAAR (CAR X)))))
              (CONS (CONS (CAAAR (CAR X)) (CONS 1 1)) NIL))
             (T (PARTITSQ* X)))))) 
(PUT 'PARTITSQ 'NUMBER-OF-ARGS 2) 
(PUT 'PARTITSQ 'DEFINED-ON-LINE '78) 
(PUT 'PARTITSQ 'DEFINED-IN-FILE 'EXCALC/PARTITSF.RED) 
(PUT 'PARTITSQ 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE PARTITSQ (U V)
    ((LAMBDA (X Y)
       (COND ((NULL X) NIL)
             ((OR (ATOM X) (ATOM (CAR X))) (CONS (CONS 1 U) NIL))
             (T
              (ADDPSF
               (COND
                ((AND (SFP (CAAAR X)) (APPLY1 V (CAAAR X)))
                 (MULTPSF (EXPTPSF (PARTITSQ (CONS (CAAAR X) 1) V) (CDAAR X))
                  (PARTITSQ (CANCEL (CONS (CDAR X) Y)) V)))
                ((AND (NULL (SFP (CAAAR X)))
                      (APPLY1 V (LIST (CONS (CONS (CAAAR X) 1) 1))))
                 (MULTPSF (CONS (CONS (LIST (CONS (CAAR X) 1)) (CONS 1 1)) NIL)
                  (PARTITSQ (CANCEL (CONS (CDAR X) Y)) V)))
                (T
                 (MULTSQPSF (CONS (LIST (CONS (CAAR X) 1)) 1)
                  (PARTITSQ (CANCEL (CONS (CDAR X) Y)) V))))
               (PARTITSQ (CANCEL (CONS (CDR X) Y)) V)))))
     (CAR U) (CDR U))) 
(PUT 'EXPTPSF 'NUMBER-OF-ARGS 2) 
(PUT 'EXPTPSF 'DEFINED-ON-LINE '97) 
(PUT 'EXPTPSF 'DEFINED-IN-FILE 'EXCALC/PARTITSF.RED) 
(PUT 'EXPTPSF 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE EXPTPSF (U N)
    (PROG (X)
      (SETQ X U)
      (PROG ()
       WHILELABEL
        (COND ((NOT (GREATERP (SETQ N (DIFFERENCE N 1)) 0)) (RETURN NIL)))
        (SETQ X (MULTPSF U X))
        (GO WHILELABEL))
      (RETURN X))) 
(PUT 'EXPTPF 'NUMBER-OF-ARGS 2) 
(PUT 'EXPTPF 'DEFINED-ON-LINE '104) 
(PUT 'EXPTPF 'DEFINED-IN-FILE 'EXCALC/PARTITSF.RED) 
(PUT 'EXPTPF 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE EXPTPF (U N)
    (PROG (X)
      (SETQ X U)
      (PROG ()
       WHILELABEL
        (COND ((NOT (GREATERP (SETQ N (DIFFERENCE N 1)) 0)) (RETURN NIL)))
        (SETQ X (MULTPFS U X))
        (GO WHILELABEL))
      (RETURN X))) 
(PUT 'ADDPSF 'NUMBER-OF-ARGS 2) 
(PUT 'ADDPSF 'DEFINED-ON-LINE '111) 
(PUT 'ADDPSF 'DEFINED-IN-FILE 'EXCALC/PARTITSF.RED) 
(PUT 'ADDPSF 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE ADDPSF (U V)
    (COND ((NULL U) V) ((NULL V) U)
          ((OR (ATOM (CAAR U)) (ATOM (CAR (CAAR U)))) (ADDMPSF U V))
          ((OR (ATOM (CAAR V)) (ATOM (CAR (CAAR V)))) (ADDMPSF V U))
          ((EQUAL (CAAR U) (CAAR V))
           ((LAMBDA (X Y)
              (COND ((NULL (CAR X)) Y) (T (CONS (CONS (CAAR U) X) Y))))
            (ADDSQ (CDAR U) (CDAR V)) (ADDPSF (CDR U) (CDR V))))
          ((ORDPP (CAAR (CAAR U)) (CAAR (CAAR V)))
           (CONS (CAR U) (ADDPSF (CDR U) V)))
          (T (CONS (CAR V) (ADDPSF U (CDR V)))))) 
(PUT 'ADDPF 'NUMBER-OF-ARGS 2) 
(PUT 'ADDPF 'DEFINED-ON-LINE '123) 
(PUT 'ADDPF 'DEFINED-IN-FILE 'EXCALC/PARTITSF.RED) 
(PUT 'ADDPF 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE ADDPF (U V)
    (COND ((NULL U) V) ((NULL V) U) ((EQUAL (CAAR U) 1) (ADDMPF U V))
          ((EQUAL (CAAR V) 1) (ADDMPF V U))
          ((EQUAL (CAAR U) (CAAR V))
           ((LAMBDA (X Y)
              (COND ((NULL (CAR X)) Y) (T (CONS (CONS (CAAR U) X) Y))))
            (ADDSQ (CDAR U) (CDAR V)) (ADDPF (CDR U) (CDR V))))
          ((ORDOP (CAAR U) (CAAR V)) (CONS (CAR U) (ADDPF (CDR U) V)))
          (T (CONS (CAR V) (ADDPF U (CDR V)))))) 
(PUT 'ADDMPF 'NUMBER-OF-ARGS 2) 
(PUT 'ADDMPF 'DEFINED-ON-LINE '135) 
(PUT 'ADDMPF 'DEFINED-IN-FILE 'EXCALC/PARTITSF.RED) 
(PUT 'ADDMPF 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE ADDMPF (U V)
    (COND ((NULL V) U)
          ((EQUAL (CAAR V) 1)
           ((LAMBDA (X) (COND ((CAR X) (CONS (CONS 1 X) NIL)) (T NIL)))
            (ADDSQ (CDAR U) (CDAR V))))
          (T (CONS (CAR V) (ADDMPF U (CDR V)))))) 
(PUT 'ADDMPSF 'NUMBER-OF-ARGS 2) 
(PUT 'ADDMPSF 'DEFINED-ON-LINE '141) 
(PUT 'ADDMPSF 'DEFINED-IN-FILE 'EXCALC/PARTITSF.RED) 
(PUT 'ADDMPSF 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE ADDMPSF (U V)
    (COND ((NULL V) U)
          ((OR (ATOM (CAAR V)) (ATOM (CAR (CAAR V))))
           (CONS
            (CONS 1
                  (ADDSQ (MULTSQ (CONS (CAAR U) 1) (CDAR U))
                         (MULTSQ (CONS (CAAR V) 1) (CDAR V))))
            NIL))
          (T (CONS (CAR V) (ADDMPSF U (CDR V)))))) 
(PUT 'MULTPSF 'NUMBER-OF-ARGS 2) 
(PUT 'MULTPSF 'DEFINED-ON-LINE '147) 
(PUT 'MULTPSF 'DEFINED-IN-FILE 'EXCALC/PARTITSF.RED) 
(PUT 'MULTPSF 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE MULTPSF (U V)
    (COND ((OR (NULL U) (NULL V)) NIL)
          (T
           (ADDPSF (ADDPSF (MULTTPSF (CAR U) (CAR V)) (MULTPSF (CDR U) V))
            (MULTPSF (LIST (CAR U)) (CDR V)))))) 
(PUT 'MULTPFS 'NUMBER-OF-ARGS 2) 
(PUT 'MULTPFS 'DEFINED-ON-LINE '152) 
(PUT 'MULTPFS 'DEFINED-IN-FILE 'EXCALC/PARTITSF.RED) 
(PUT 'MULTPFS 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE MULTPFS (U V)
    (COND ((OR (NULL U) (NULL V)) NIL)
          ((EQUAL (CAAR U) 1) (MULTSQPF (CDAR U) V))
          ((EQUAL (CAAR V) 1) (MULTPFSQ U (CDAR V)))
          (T
           (ADDPF (ADDPF (MULTTTPF (CAR U) (CAR V)) (MULTPFS (CDR U) V))
            (MULTPFS (CONS (CAR U) NIL) (CDR V)))))) 
(PUT 'MULTTTPF 'NUMBER-OF-ARGS 2) 
(PUT 'MULTTTPF 'DEFINED-ON-LINE '159) 
(PUT 'MULTTTPF 'DEFINED-IN-FILE 'EXCALC/PARTITSF.RED) 
(PUT 'MULTTTPF 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE MULTTTPF (U V)
    (COND
     ((EQUAL (CAR U) 1) (CONS (CONS (CAR V) (MULTSQ (CDR U) (CDR V))) NIL))
     ((EQUAL (CAR V) 1) (CONS (CONS (CAR U) (MULTSQ (CDR U) (CDR V))) NIL))
     (T (RERROR 'EXCALC 10 "Illegal factor in pf")))) 
(PUT 'MULTPFSQ 'NUMBER-OF-ARGS 2) 
(PUT 'MULTPFSQ 'DEFINED-ON-LINE '164) 
(PUT 'MULTPFSQ 'DEFINED-IN-FILE 'EXCALC/PARTITSF.RED) 
(PUT 'MULTPFSQ 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE MULTPFSQ (U V)
    (COND ((OR (NULL U) (NULL (CAR V))) NIL)
          (T (CONS (CONS (CAAR U) (MULTSQ (CDAR U) V)) (MULTPFSQ (CDR U) V))))) 
(PUT 'MULTSQPF 'NUMBER-OF-ARGS 2) 
(PUT 'MULTSQPF 'DEFINED-ON-LINE '168) 
(PUT 'MULTSQPF 'DEFINED-IN-FILE 'EXCALC/PARTITSF.RED) 
(PUT 'MULTSQPF 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE MULTSQPF (U V)
    (COND ((OR (NULL V) (NULL (CAR U))) NIL)
          (T (CONS (CONS (CAAR V) (MULTSQ U (CDAR V))) (MULTSQPF U (CDR V)))))) 
(PUT 'MULTTPSF 'NUMBER-OF-ARGS 2) 
(PUT 'MULTTPSF 'DEFINED-ON-LINE '172) 
(PUT 'MULTTPSF 'DEFINED-IN-FILE 'EXCALC/PARTITSF.RED) 
(PUT 'MULTTPSF 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE MULTTPSF (U V)
    (PROG (X XEXP)
      (SETQ XEXP *EXP)
      (SETQ *EXP T)
      (SETQ X
              (COND ((EQUAL (CAR U) 1) (CAR V)) ((EQUAL (CAR V) 1) (CAR U))
                    (T
                     (COND (*PHYSOP-LOADED (PHYSOP-MULTF (CAR U) (CAR V)))
                           (T (POLY-MULTF (CAR U) (CAR V)))))))
      (SETQ *EXP XEXP)
      (RETURN
       (MULTSQPSF (MULTSQ (CDR U) (CDR V)) (CONS (CONS X (CONS 1 1)) NIL))))) 
(PUT 'MULTSQPSF 'NUMBER-OF-ARGS 2) 
(PUT 'MULTSQPSF 'DEFINED-ON-LINE '183) 
(PUT 'MULTSQPSF 'DEFINED-IN-FILE 'EXCALC/PARTITSF.RED) 
(PUT 'MULTSQPSF 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE MULTSQPSF (U V)
    (COND ((OR (NULL (CAR U)) (NULL V)) NIL)
          (T (CONS (CONS (CAAR V) (MULTSQ U (CDAR V))) (MULTSQPSF U (CDR V)))))) 
(PUT 'REPARTIT 'NUMBER-OF-ARGS 1) 
(PUT 'REPARTIT 'DEFINED-ON-LINE '187) 
(PUT 'REPARTIT 'DEFINED-IN-FILE 'EXCALC/PARTITSF.RED) 
(PUT 'REPARTIT 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE REPARTIT (U)
    (COND ((NULL U) NIL)
          (T
           (ADDPF (MULTPFSQ (PARTITOP (CAAR U)) (RESIMP (CDAR U)))
            (REPARTIT (CDR U)))))) 
(PUT 'PARTITSQ* 'NUMBER-OF-ARGS 1) 
(PUT 'PARTITSQ* 'DEFINED-ON-LINE '191) 
(PUT 'PARTITSQ* 'DEFINED-IN-FILE 'EXCALC/PARTITSF.RED) 
(PUT 'PARTITSQ* 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE PARTITSQ* (U)
    ((LAMBDA (X Y)
       (COND ((NULL X) NIL)
             ((OR (ATOM X) (ATOM (CAR X))) (CONS (CONS 1 U) NIL))
             (T
              (ADDPF
               (COND
                ((AND (SFP (CAAAR X)) (SFEXFORM1P (CAR (CAAAR X))))
                 (MULTPFSQ (EXPTPF (PARTITSQ* (CONS (CAAAR X) 1)) (CDAAR X))
                  (CANCEL (CONS (CDAR X) Y))))
                ((AND (NULL (SFP (CAAAR X))) (DEG*FORM (CAAAR X)))
                 (CONS (CONS (CAAAR X) (CANCEL (CONS (CDAR X) Y))) NIL))
                (T
                 (MULTSQPF (CONS (LIST (CONS (CAAR X) 1)) 1)
                  (PARTITSQ* (CONS (CDAR X) Y)))))
               (PARTITSQ* (CONS (CDR X) Y))))))
     (CAR U) (CDR U))) 
(PUT 'SFEXFORM1P 'NUMBER-OF-ARGS 1) 
(PUT 'SFEXFORM1P 'DEFINED-ON-LINE '206) 
(PUT 'SFEXFORM1P 'DEFINED-IN-FILE 'EXCALC/PARTITSF.RED) 
(PUT 'SFEXFORM1P 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE SFEXFORM1P (U)
    (OR
     (COND ((SFP (CAAR U)) (SFEXFORM1P (CAR (CAAR U))))
           (T (DEG*FORM (CAAR U))))
     (AND (NULL (OR (ATOM (CDR U)) (ATOM (CAR (CDR U)))))
          (SFEXFORM1P (CAR (CDR U)))))) 
(PUT '*PF2SQ 'NUMBER-OF-ARGS 1) 
(PUT '*PF2SQ 'DEFINED-ON-LINE '211) 
(PUT '*PF2SQ 'DEFINED-IN-FILE 'EXCALC/PARTITSF.RED) 
(PUT '*PF2SQ 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE *PF2SQ (U)
    (PROG (RES)
      (SETQ RES (CONS NIL 1))
      (COND ((NULL U) (RETURN RES)))
      (PROG (J)
        (SETQ J U)
       LAB
        (COND ((NULL J) (RETURN NIL)))
        (SETQ RES
                (ADDSQ
                 (MULTSQ
                  (COND ((EQUAL (CAAR J) 1) (CONS 1 1))
                        (T (CONS (LIST (CONS (CONS (CAAR J) 1) 1)) 1)))
                  (CDAR J))
                 RES))
        (SETQ J (CDR J))
        (GO LAB))
      (RETURN RES))) 
(PUT 'MK*SQPF 'NUMBER-OF-ARGS 1) 
(PUT 'MK*SQPF 'DEFINED-ON-LINE '221) 
(PUT 'MK*SQPF 'DEFINED-IN-FILE 'EXCALC/PARTITSF.RED) 
(PUT 'MK*SQPF 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE MK*SQPF (U)
    (COND ((NULL U) NIL)
          (T (CONS (CONS (CAAR U) (MK*SQ (CDAR U))) (MK*SQPF (CDR U)))))) 
(PUT '*PFSQ2PF 'NUMBER-OF-ARGS 1) 
(PUT '*PFSQ2PF 'DEFINED-ON-LINE '225) 
(PUT '*PFSQ2PF 'DEFINED-IN-FILE 'EXCALC/PARTITSF.RED) 
(PUT '*PFSQ2PF 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE *PFSQ2PF (U)
    (COND ((NULL U) NIL)
          (T
           ((LAMBDA (X)
              (COND ((CAR X) (CONS (CONS (CAAR U) X) (*PFSQ2PF (CDR U))))
                    (T (*PFSQ2PF (CDR U)))))
            (SIMP* (CDAR U)))))) 
(ENDMODULE) 