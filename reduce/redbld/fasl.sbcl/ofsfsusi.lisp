(cl:declaim (cl:optimize cl:debug cl:safety))
(cl:declaim (sb-ext:muffle-conditions sb-ext:compiler-note cl:style-warning))
(MODULE (LIST 'OFSFSUSI)) 
(REVISION 'OFSFSUSI
          "$Id: ofsfsusi.red 5986 2021-08-28 13:35:27Z thomas-sturm $") 
(COPYRIGHT 'OFSFSUSI "(c) 1995-2021 A. Dolzmann, T. Sturm") 
(PUT 'OFSF_SUSIRMKNOWL 'NUMBER-OF-ARGS 2) 
(PUT 'OFSF_SUSIRMKNOWL 'DEFINED-ON-LINE '33) 
(PUT 'OFSF_SUSIRMKNOWL 'DEFINED-IN-FILE 'REDLOG/OFSF/OFSFSUSI.RED) 
(PUT 'OFSF_SUSIRMKNOWL 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE OFSF_SUSIRMKNOWL (KNOWL V)
    (PROG (P FORALL-RESULT FORALL-ENDPTR)
      (SETQ P KNOWL)
     STARTOVER
      (COND ((NULL P) (RETURN NIL)))
      (SETQ FORALL-RESULT
              ((LAMBDA (P)
                 (COND ((MEMQ V (OFSF_VARLAT (CAR P))) NIL) (T (LIST P))))
               (CAR P)))
      (SETQ FORALL-ENDPTR (LASTPAIR FORALL-RESULT))
      (SETQ P (CDR P))
      (COND ((ATOM FORALL-ENDPTR) (GO STARTOVER)))
     LOOPLABEL
      (COND ((NULL P) (RETURN FORALL-RESULT)))
      (RPLACD FORALL-ENDPTR
              ((LAMBDA (P)
                 (COND ((MEMQ V (OFSF_VARLAT (CAR P))) NIL) (T (LIST P))))
               (CAR P)))
      (SETQ FORALL-ENDPTR (LASTPAIR FORALL-ENDPTR))
      (SETQ P (CDR P))
      (GO LOOPLABEL))) 
(PUT 'OFSF_SUSIBIN 'NUMBER-OF-ARGS 2) 
(PUT 'OFSF_SUSIBIN 'DEFINED-ON-LINE '40) 
(PUT 'OFSF_SUSIBIN 'DEFINED-IN-FILE 'REDLOG/OFSF/OFSFSUSI.RED) 
(PUT 'OFSF_SUSIBIN 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE OFSF_SUSIBIN (OLD NEW)
    (PROG (W X)
      (COND
       (*RLSUSIADD
        (PROGN
         (SETQ W (OFSF_SUSIBINAD OLD NEW))
         (COND ((EQ W 'FALSE) (RETURN 'FALSE))))))
      (COND
       (*RLSUSIMULT
        (PROGN
         (SETQ X (OFSF_SUSIBINMULT OLD NEW))
         (COND ((EQ X 'FALSE) (RETURN 'FALSE)))
         (SETQ W (NCONC W X)))))
      (RETURN W))) 
(PUT 'OFSF_SUSIBINMULT 'NUMBER-OF-ARGS 2) 
(PUT 'OFSF_SUSIBINMULT 'DEFINED-ON-LINE '60) 
(PUT 'OFSF_SUSIBINMULT 'DEFINED-IN-FILE 'REDLOG/OFSF/OFSFSUSI.RED) 
(PUT 'OFSF_SUSIBINMULT 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE OFSF_SUSIBINMULT (OLD NEW)
    (PROG (W OT NT OREL NREL OLEVEL NLEVEL)
      (SETQ OT (CADR (CAR OLD)))
      (SETQ NT (CADR (CAR NEW)))
      (SETQ OREL (CAR (CAR OLD)))
      (SETQ NREL (CAR (CAR NEW)))
      (SETQ OLEVEL (CDR OLD))
      (SETQ NLEVEL (CDR NEW))
      (SETQ W ((LAMBDA (*EXP) (QUOTF1 OT NT)) T))
      (COND ((EQUAL W 1) (RETURN NIL)))
      (COND (W (RETURN (OFSF_SUSIBINMULT1 OREL NREL OT NT W OLEVEL NLEVEL T))))
      (SETQ W ((LAMBDA (*EXP) (QUOTF1 NT OT)) T))
      (COND
       (W (RETURN (OFSF_SUSIBINMULT1 NREL OREL NT OT W NLEVEL OLEVEL NIL))))
      (RETURN NIL))) 
(PUT 'OFSF_SUSIBINMULT1 'NUMBER-OF-ARGS 8) 
(PUT 'OFSF_SUSIBINMULT1 'DEFINED-ON-LINE '83) 
(PUT 'OFSF_SUSIBINMULT1 'DEFINED-IN-FILE 'REDLOG/OFSF/OFSFSUSI.RED) 
(PUT 'OFSF_SUSIBINMULT1 'PROCEDURE_TYPE
     '(ARROW
       (TIMES GENERAL GENERAL GENERAL GENERAL GENERAL GENERAL GENERAL GENERAL)
       GENERAL)) 
(DE OFSF_SUSIBINMULT1 (PR FR PROD AF CF PLEVEL FLEVEL FLG)
    (PROG (W)
      (SETQ W (OFSF_SUSIBINMULTTAB FR PR))
      (COND ((NOT W) (RETURN NIL)))
      (SETQ W (CDR W))
      (COND ((NOT W) (RETURN NIL)))
      (COND
       ((ATOM W)
        (PROGN
         (COND ((EQ W 'FALSE) (RETURN 'FALSE)))
         (COND ((EQ W 'IGN1) (RETURN (LIST (CONS 'IGNORE FLG)))))
         (COND ((EQ W 'IGN2) (RETURN (LIST (CONS 'IGNORE (NOT FLG)))))))))
      (COND
       ((OFSF_WOP FR)
        (RETURN
         (LIST '(IGNORE . T) '(IGNORE)
               (CONS 'ADD
                     (CONS (LIST (CAR W) AF NIL)
                           (CL_SUSIMINLEVEL PLEVEL FLEVEL)))
               (CONS 'ADD (CONS (LIST (CDR W) CF NIL) PLEVEL)))))
       (T
        (RETURN
         (LIST (CONS 'IGNORE (NOT FLG))
               (CONS 'ADD (CONS (LIST (CDR W) CF NIL) PLEVEL)))))))) 
(PUT 'OFSF_WOP 'NUMBER-OF-ARGS 1) 
(PUT 'OFSF_WOP 'DEFINED-ON-LINE '112) 
(PUT 'OFSF_WOP 'DEFINED-IN-FILE 'REDLOG/OFSF/OFSFSUSI.RED) 
(PUT 'OFSF_WOP 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE OFSF_WOP (REL) (MEMQ REL '(LEQ GEQ))) 
(PUT 'OFSF_SUSIBINMULTTAB 'NUMBER-OF-ARGS 2) 
(PUT 'OFSF_SUSIBINMULTTAB 'DEFINED-ON-LINE '115) 
(PUT 'OFSF_SUSIBINMULTTAB 'DEFINED-IN-FILE 'REDLOG/OFSF/OFSFSUSI.RED) 
(PUT 'OFSF_SUSIBINMULTTAB 'PROCEDURE_TYPE
     '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE OFSF_SUSIBINMULTTAB (U UV)
    (PROG (AL)
      (SETQ AL
              '((EQUAL (EQUAL . IGN2) (LEQ . IGN2) (GEQ . IGN2) (NEQ . FALSE)
                       (GREATERP . FALSE) (LESSP . FALSE))
                (LEQ (EQUAL) (LEQ) (GEQ) (NEQ LESSP . NEQ)
                     (GREATERP LESSP . LESSP) (LESSP LESSP . GREATERP))
                (GEQ (EQUAL) (LEQ) (GEQ) (NEQ GREATERP . NEQ)
                     (GREATERP GREATERP . GREATERP) (LESSP GREATERP . LESSP))
                (NEQ (EQUAL NEQ . EQUAL) (LEQ) (GEQ) (NEQ NEQ . NEQ)
                     (GREATERP . IGN1) (LESSP . IGN1))
                (LESSP (EQUAL LESSP . EQUAL) (LEQ LESSP . GEQ)
                       (GEQ LESSP . LEQ) (NEQ LESSP . NEQ)
                       (LESSP LESSP . GREATERP) (GREATERP LESSP . LESSP))
                (GREATERP (EQUAL GREATERP . EQUAL) (LEQ GREATERP . LEQ)
                          (GEQ GREATERP . GEQ) (NEQ GREATERP . NEQ)
                          (LESSP GREATERP . LESSP)
                          (GREATERP GREATERP . GREATERP))))
      (RETURN (ATSOC UV (ATSOC U AL))))) 
(PUT 'OFSF_SUSIBINAD 'NUMBER-OF-ARGS 2) 
(PUT 'OFSF_SUSIBINAD 'DEFINED-ON-LINE '137) 
(PUT 'OFSF_SUSIBINAD 'DEFINED-IN-FILE 'REDLOG/OFSF/OFSFSUSI.RED) 
(PUT 'OFSF_SUSIBINAD 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE OFSF_SUSIBINAD (OLD NEW)
    (PROG (OD ND LEVEL)
      (SETQ LEVEL (CL_SUSIMINLEVEL (CDR OLD) (CDR NEW)))
      (SETQ OLD (CAR OLD))
      (SETQ NEW (CAR NEW))
      (COND
       ((EQUAL (CADR OLD) (CADR NEW))
        (RETURN (OFSF_SUSIBINEQ (CADR OLD) (CAR OLD) (CAR NEW) LEVEL))))
      (SETQ OD (OFSF_SUSIDEC (CADR OLD)))
      (SETQ ND (OFSF_SUSIDEC (CADR NEW)))
      (COND
       ((EQUAL (CAR OD) (CAR ND))
        (RETURN
         (OFSF_SUSIBINORD (CAR OLD) (CADR OLD) (CDR OD) (CAR NEW) (CADR NEW)
          (CDR ND) LEVEL))))
      (RETURN NIL))) 
(PUT 'OFSF_SUSIBINEQ 'NUMBER-OF-ARGS 4) 
(PUT 'OFSF_SUSIBINEQ 'DEFINED-ON-LINE '152) 
(PUT 'OFSF_SUSIBINEQ 'DEFINED-IN-FILE 'REDLOG/OFSF/OFSFSUSI.RED) 
(PUT 'OFSF_SUSIBINEQ 'PROCEDURE_TYPE
     '(ARROW (TIMES GENERAL GENERAL GENERAL GENERAL) GENERAL)) 
(DE OFSF_SUSIBINEQ (U OOP NOP LEVEL)
    (PROG (W)
      (SETQ W (OFSF_SMEQTABLE OOP NOP))
      (COND ((EQ W 'FALSE) (RETURN 'FALSE))
            ((EQ W OOP) (RETURN '((DELETE . T))))
            ((EQ W NOP) (RETURN (LIST '(DELETE))))
            (T
             (RETURN
              (LIST '(DELETE) '(DELETE . T)
                    (CONS 'ADD (CONS (LIST W U NIL) LEVEL)))))))) 
(PUT 'OFSF_SUSIDEC 'NUMBER-OF-ARGS 1) 
(PUT 'OFSF_SUSIDEC 'DEFINED-ON-LINE '166) 
(PUT 'OFSF_SUSIDEC 'DEFINED-IN-FILE 'REDLOG/OFSF/OFSFSUSI.RED) 
(PUT 'OFSF_SUSIDEC 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE OFSF_SUSIDEC (U)
    (PROG (PAR ABSV C)
      (SETQ ABSV U)
      (PROG ()
       WHILELABEL
        (COND ((NOT (NOT (OR (ATOM ABSV) (ATOM (CAR ABSV))))) (RETURN NIL)))
        (SETQ ABSV (CDR ABSV))
        (GO WHILELABEL))
      (SETQ PAR (ADDF U (NEGF ABSV)))
      (SETQ C (SFTO_DCONTENTF PAR))
      (SETQ PAR ((LAMBDA (*EXP) (QUOTF1 PAR C)) T))
      (SETQ ABSV (MULTSQ (CONS ABSV 1) (INVSQ (CONS C 1))))
      (RETURN (CONS PAR ABSV)))) 
(PUT 'OFSF_SUSIBINORD 'NUMBER-OF-ARGS 7) 
(PUT 'OFSF_SUSIBINORD 'DEFINED-ON-LINE '180) 
(PUT 'OFSF_SUSIBINORD 'DEFINED-IN-FILE 'REDLOG/OFSF/OFSFSUSI.RED) 
(PUT 'OFSF_SUSIBINORD 'PROCEDURE_TYPE
     '(ARROW (TIMES GENERAL GENERAL GENERAL GENERAL GENERAL GENERAL GENERAL)
       GENERAL)) 
(DE OFSF_SUSIBINORD (OREL OT OABS NREL NT NABS LEVEL)
    (PROG (W DIFF)
      (SETQ DIFF (CAR (ADDSQ OABS (NEGSQ NABS))))
      (COND
       ((MINUSF DIFF)
        (PROGN
         (SETQ W (OFSF_SMORDTABLE OREL NREL))
         (COND ((ATOM W) (RETURN W)))
         (COND ((AND (EQCAR W OREL) (CDR W)) (RETURN '((IGNORE . T)))))
         (COND
          ((CDR W)
           (RETURN
            (LIST '(IGNORE) (CONS 'ADD (CONS (LIST (CAR W) OT NIL) LEVEL)))))
          (T (RETURN (LIST '(IGNORE))))))))
      (SETQ W (OFSF_SMORDTABLE NREL OREL))
      (COND ((ATOM W) (RETURN W)))
      (COND ((AND (EQCAR W OREL) (NULL (CDR W))) (RETURN '((IGNORE . T)))))
      (COND ((CDR W) (RETURN (LIST '(IGNORE))))
            (T
             (RETURN
              (LIST '(IGNORE)
                    (CONS 'ADD (CONS (LIST (CAR W) OT NIL) LEVEL)))))))) 
(PUT 'OFSF_SUSIPOST 'NUMBER-OF-ARGS 2) 
(PUT 'OFSF_SUSIPOST 'DEFINED-ON-LINE '203) 
(PUT 'OFSF_SUSIPOST 'DEFINED-IN-FILE 'REDLOG/OFSF/OFSFSUSI.RED) 
(PUT 'OFSF_SUSIPOST 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE OFSF_SUSIPOST (ATL KNOWL)
    (COND (*RLSUSIGS (OFSF_SUSIGS ATL KNOWL)) (T ATL))) 
(PUT 'OFSF_SUSIGS 'NUMBER-OF-ARGS 2) 
(PUT 'OFSF_SUSIGS 'DEFINED-ON-LINE '213) 
(PUT 'OFSF_SUSIGS 'DEFINED-IN-FILE 'REDLOG/OFSF/OFSFSUSI.RED) 
(PUT 'OFSF_SUSIGS 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE OFSF_SUSIGS (ATL KNOWL)
    (PROG (W THEO *RLSIEXPLA *RLSIEXPL)
      (SETQ ATL
              (PROG (AT FORALL-RESULT FORALL-ENDPTR)
                (SETQ AT ATL)
                (COND ((NULL AT) (RETURN NIL)))
                (SETQ FORALL-RESULT
                        (SETQ FORALL-ENDPTR
                                (CONS ((LAMBDA (AT) (RL_NEGATEAT AT)) (CAR AT))
                                      NIL)))
               LOOPLABEL
                (SETQ AT (CDR AT))
                (COND ((NULL AT) (RETURN FORALL-RESULT)))
                (RPLACD FORALL-ENDPTR
                        (CONS ((LAMBDA (AT) (RL_NEGATEAT AT)) (CAR AT)) NIL))
                (SETQ FORALL-ENDPTR (CDR FORALL-ENDPTR))
                (GO LOOPLABEL)))
      (SETQ W
              (COND ((AND ATL (CDR ATL)) (CONS 'OR ATL))
                    ((NULL ATL) (COND ((EQ 'OR 'AND) 'TRUE) (T 'FALSE)))
                    (T (CAR ATL))))
      (SETQ THEO
              (PROG (X FORALL-RESULT FORALL-ENDPTR)
                (SETQ X KNOWL)
                (COND ((NULL X) (RETURN NIL)))
                (SETQ FORALL-RESULT
                        (SETQ FORALL-ENDPTR
                                (CONS ((LAMBDA (X) (CAR X)) (CAR X)) NIL)))
               LOOPLABEL
                (SETQ X (CDR X))
                (COND ((NULL X) (RETURN FORALL-RESULT)))
                (RPLACD FORALL-ENDPTR
                        (CONS ((LAMBDA (X) (CAR X)) (CAR X)) NIL))
                (SETQ FORALL-ENDPTR (CDR FORALL-ENDPTR))
                (GO LOOPLABEL)))
      (SETQ W (OFSF_GSSIMPLIFY0 W THEO))
      (COND ((EQ W 'INCTHEO) (RETURN 'INCTHEO)))
      (COND ((OR (EQ W 'TRUE) (EQ W 'FALSE)) (RETURN (CL_FLIP W))))
      (COND ((CL_ATFP W) (RETURN (LIST (RL_NEGATEAT W)))))
      (SETQ W
              (PROG (AT FORALL-RESULT FORALL-ENDPTR)
                (SETQ AT (CDR W))
                (COND ((NULL AT) (RETURN NIL)))
                (SETQ FORALL-RESULT
                        (SETQ FORALL-ENDPTR
                                (CONS ((LAMBDA (AT) (RL_NEGATEAT AT)) (CAR AT))
                                      NIL)))
               LOOPLABEL
                (SETQ AT (CDR AT))
                (COND ((NULL AT) (RETURN FORALL-RESULT)))
                (RPLACD FORALL-ENDPTR
                        (CONS ((LAMBDA (AT) (RL_NEGATEAT AT)) (CAR AT)) NIL))
                (SETQ FORALL-ENDPTR (CDR FORALL-ENDPTR))
                (GO LOOPLABEL)))
      (RETURN W))) 
(PUT 'OFSF_SUSITF 'NUMBER-OF-ARGS 2) 
(PUT 'OFSF_SUSITF 'DEFINED-ON-LINE '233) 
(PUT 'OFSF_SUSITF 'DEFINED-IN-FILE 'REDLOG/OFSF/OFSFSUSI.RED) 
(PUT 'OFSF_SUSITF 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE OFSF_SUSITF (AT KNOWL)
    (PROG (R S)
      (SETQ R (CAR AT))
      (SETQ S (CADR AT))
      (COND
       ((OR (AND (EQ R 'GEQ) (ASSOC (LIST 'LEQ S NIL) KNOWL))
            (AND (EQ R 'LEQ) (ASSOC (LIST 'GEQ S NIL) KNOWL)))
        (RETURN (LIST 'EQUAL S NIL))))
      (COND ((NOT (OR (EQ R 'LESSP) (EQ R 'GREATERP))) (RETURN AT)))
      (COND
       ((AND *RLSIPW (ASSOC (LIST 'NEQ S NIL) KNOWL))
        (RETURN (LIST (OFSF_CANEGREL 'LEQ (EQ R 'LESSP)) S NIL))))
      (COND (*RLSIPO (RETURN AT)))
      (COND
       ((OR (AND (EQ R 'LESSP) (ASSOC (LIST 'LEQ S NIL) KNOWL))
            (AND (EQ R 'GREATERP) (ASSOC (LIST 'GEQ S NIL) KNOWL)))
        (RETURN (LIST 'NEQ S NIL))))
      (RETURN AT))) 
(ENDMODULE) 