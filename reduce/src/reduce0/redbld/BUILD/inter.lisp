(cl:declaim (cl:optimize cl:debug cl:safety))
(cl:declaim (sb-ext:muffle-conditions sb-ext:compiler-note cl:style-warning))
(MODULE (LIST 'INTER)) 
(FLUID '(*ECHO *INT TRAP-TIME* IFL* CURLINE*)) 
(GLOBAL
 '($EOF$ $EOL$ *LESSSPACE CURSYM* CURESCAPED* CLOC* CONTL* EDIT* EOF* ERFG*
   FLG* IPL* KEY* OFL* OPL* TECHO*)) 
(PUT 'PAUSE 'NUMBER-OF-ARGS 0) 
(PUT 'PAUSE 'DEFINED-ON-LINE '51) 
(PUT 'PAUSE 'DEFINED-IN-FILE 'RLISP/INTER.RED) 
(PUT 'PAUSE 'PROCEDURE_TYPE '(ARROW UNIT GENERAL)) 
(DE PAUSE NIL
    (COND ((NULL *INT) NIL) ((EQUAL KEY* 'PAUSE) (PAUSE1 NIL))
          (T (PAUSE1 NIL)))) 
(PUT 'PAUSE1 'NUMBER-OF-ARGS 1) 
(PUT 'PAUSE1 'DEFINED-ON-LINE '58) 
(PUT 'PAUSE1 'DEFINED-IN-FILE 'RLISP/INTER.RED) 
(PUT 'PAUSE1 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE PAUSE1 (BOOL)
    (PROG (X)
      (COND
       (BOOL
        (COND
         ((AND (GETD 'EDIT1) ERFG* CLOC* (YESP "Edit?"))
          (RETURN
           (PROGN
            (SETQ CONTL* NIL)
            (COND
             (OFL*
              (PROGN
               (LPRIM (LIST (CAR OFL*) 'SHUT))
               (CLOSE (CDR OFL*))
               (SETQ OPL* (DELETE OFL* OPL*))
               (SETQ OFL* NIL))))
            (EDIT1 CLOC* NIL))))
         (FLG* (RETURN (SETQ EDIT* NIL))))))
      (COND ((OR (NULL IFL*) (YESP "Cont?")) (RETURN NIL)))
      (SETQ IFL* (LIST (CAR IFL*) (CADR IFL*) CURLINE*))
      (COND
       ((SETQ X (ASSOCCAR (CAR IFL*) CONTL*))
        (PROGN (SETQ CONTL* (DELETE X CONTL*)) (CLOSE (CADAR X)))))
      (SETQ CONTL* (CONS (CONS IFL* (CONS (CDR IPL*) *ECHO)) CONTL*))
      (SETQ IFL* (SETQ IPL* NIL))
      (RDS NIL)
      (SETQ *ECHO TECHO*))) 
(PUT 'ASSOCCAR 'NUMBER-OF-ARGS 2) 
(PUT 'ASSOCCAR 'DEFINED-ON-LINE '79) 
(PUT 'ASSOCCAR 'DEFINED-IN-FILE 'RLISP/INTER.RED) 
(PUT 'ASSOCCAR 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE ASSOCCAR (U V)
    (COND ((NULL V) NIL) ((EQUAL U (CAAAR V)) (CAR V))
          (T (ASSOCCAR U (CDR V))))) 
(PUT 'YESP 'NUMBER-OF-ARGS 1) 
(PUT 'YESP 'DEFINED-ON-LINE '85) 
(PUT 'YESP 'DEFINED-IN-FILE 'RLISP/INTER.RED) 
(PUT 'YESP 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE YESP (U)
    (PROG (IFL OFL X Y)
      (COND
       (IFL*
        (PROGN
         (SETQ IFL (SETQ IFL* (LIST (CAR IFL*) (CADR IFL*) CURLINE*)))
         (RDS NIL))))
      (COND (OFL* (PROGN (SETQ OFL OFL*) (WRS NIL))))
      (COND ((NULL *LESSSPACE) (TERPRI)))
      (COND ((ATOM U) (PRIN2 U)) (T (LPRI U)))
      (PRIN2T " (Y or N)")
      (COND ((NULL *LESSSPACE) (TERPRI)))
      (SETQ Y (SETPCHAR '?))
      (SETQ X (YESP1))
      (SETPCHAR Y)
      (COND (OFL (WRS (CDR OFL))))
      (COND (IFL (RDS (CADR IFL))))
      (SETQ CURSYM* '*SEMICOL*)
      (SETQ CURESCAPED* NIL)
      (RETURN X))) 
(PUT 'CONT 'NUMBER-OF-ARGS 0) 
(PUT 'CONT 'DEFINED-ON-LINE '117) 
(PUT 'CONT 'DEFINED-IN-FILE 'RLISP/INTER.RED) 
(PUT 'CONT 'PROCEDURE_TYPE '(ARROW UNIT GENERAL)) 
(DE CONT NIL
    (PROG (FL TECHO)
      (COND (IFL* (RETURN NIL))
            ((NULL CONTL*) (RERROR 'RLISP 28 "No file open")))
      (SETQ FL (CAAR CONTL*))
      (SETQ IPL* (CONS FL (CADAR CONTL*)))
      (SETQ TECHO (CDDAR CONTL*))
      (SETQ CONTL* (CDR CONTL*))
      (COND
       ((AND (EQUAL (CAR FL) (CAAR IPL*)) (EQUAL (CADR FL) (CADAR IPL*)))
        (PROGN
         (SETQ IFL* FL)
         (COND (FL (PROGN (RDS (CADR FL)) (SETQ CURLINE* (CADDR FL))))
               (T (RDS NIL)))
         (SETQ *ECHO TECHO)))
       (T (PROGN (SETQ EOF* 1) (LPRIM (LIST FL "not open")) (ERROR1)))))) 
(DEFLIST '((CONT ENDSTAT) (PAUSE ENDSTAT) (RETRY ENDSTAT)) 'STAT) 
(FLAG '(CONT) 'IGNORE) 
(GLOBAL '(MACHINE_SPEED*)) 
(SETQ MACHINE_SPEED* NIL) 
(PUT 'MACHINE_SPEED 'NUMBER-OF-ARGS 0) 
(PUT 'MACHINE_SPEED 'DEFINED-ON-LINE '159) 
(PUT 'MACHINE_SPEED 'DEFINED-IN-FILE 'RLISP/INTER.RED) 
(PUT 'MACHINE_SPEED 'PROCEDURE_TYPE '(ARROW UNIT GENERAL)) 
(DE MACHINE_SPEED NIL
    (COND (MACHINE_SPEED* MACHINE_SPEED*)
          (T
           (PROG (N T0 T1)
             (SETQ N 50)
             (SETQ T1 0)
             (PROG ()
              WHILELABEL
               (COND ((NOT (LESSP T1 20)) (RETURN NIL)))
               (PROGN
                (SETQ N (TIMES 2 N))
                (SETQ T0 (TIME))
                (PROG (I)
                  (SETQ I 1)
                 LAB
                  (COND ((MINUSP (DIFFERENCE N I)) (RETURN NIL)))
                  (EXPTF (CONS (CONS (CONS 'X 1) 1) 1) 40)
                  (SETQ I (PLUS2 I 1))
                  (GO LAB))
                (SETQ T1 (DIFFERENCE (TIME) T0)))
               (GO WHILELABEL))
             (RETURN (SETQ MACHINE_SPEED* (QUOTIENT (FLOAT N) (FLOAT T1)))))))) 
(SETQ TRAP-TIME* NIL) 
(PUT 'AFTERGCSYSTEMHOOK 'NUMBER-OF-ARGS 0) 
(PUT 'AFTERGCSYSTEMHOOK 'DEFINED-ON-LINE '244) 
(PUT 'AFTERGCSYSTEMHOOK 'DEFINED-IN-FILE 'RLISP/INTER.RED) 
(PUT 'AFTERGCSYSTEMHOOK 'PROCEDURE_TYPE '(ARROW UNIT GENERAL)) 
(DE AFTERGCSYSTEMHOOK NIL
    (COND
     ((AND TRAP-TIME* (GREATERP (TIME) TRAP-TIME*))
      (PROGN (SETQ TRAP-TIME* NIL) (THROW '@TIMEOUT@ '@TIMEOUT@))))) 
(SETQ *GC-HOOK* 'AFTERGCSYSTEMHOOK) 
(PUT 'WITH-TIMEOUT 'NUMBER-OF-ARGS 2) 
(PUT 'WITH-TIMEOUT 'DEFINED-ON-LINE '252) 
(PUT 'WITH-TIMEOUT 'DEFINED-IN-FILE 'RLISP/INTER.RED) 
(PUT 'WITH-TIMEOUT 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE WITH-TIMEOUT (N U)
    (PROG (OTT)
      (SETQ OTT TRAP-TIME*)
      (RETURN
       (PROG (TRAP-TIME*)
         (SETQ TRAP-TIME* (PLUS (TIME) (FIX N)))
         (COND
          ((AND (NUMBERP OTT) (GREATERP TRAP-TIME* OTT))
           (SETQ TRAP-TIME* OTT)))
         (RETURN (EVAL (LIST 'CATCH ''@TIMEOUT@ U))))))) 
(PUT 'WITH-NORMALIZED-TIMEOUT 'NUMBER-OF-ARGS 2) 
(PUT 'WITH-NORMALIZED-TIMEOUT 'DEFINED-ON-LINE '262) 
(PUT 'WITH-NORMALIZED-TIMEOUT 'DEFINED-IN-FILE 'RLISP/INTER.RED) 
(PUT 'WITH-NORMALIZED-TIMEOUT 'PROCEDURE_TYPE
     '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE WITH-NORMALIZED-TIMEOUT (N U)
    (PROG (OTT)
      (SETQ OTT TRAP-TIME*)
      (RETURN
       (PROG (TRAP-TIME*)
         (SETQ TRAP-TIME* (PLUS (TIME) (FIX (QUOTIENT N (MACHINE_SPEED)))))
         (COND
          ((AND (NUMBERP OTT) (GREATERP TRAP-TIME* OTT))
           (SETQ TRAP-TIME* OTT)))
         (RETURN (EVAL (LIST 'CATCH ''@TIMEOUT@ U))))))) 
(ENDMODULE) 