(cl:declaim (cl:optimize cl:debug cl:safety))
(cl:declaim (sb-ext:muffle-conditions sb-ext:compiler-note cl:style-warning))
(MODULE (LIST 'SIMPLERTRACE)) 
(COPYD '~~SAVED_GETD 'GETD) 
(COPYD '~~SAVED_PUTD 'PUTD) 
(PUT '|S:ARGCOUNT| 'NUMBER-OF-ARGS 1) 
(PUT '|S:ARGCOUNT| 'DEFINED-ON-LINE '79) 
(PUT '|S:ARGCOUNT| 'DEFINED-IN-FILE 'RTOOLS/SIMPLERTRACE.RED) 
(PUT '|S:ARGCOUNT| 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE |S:ARGCOUNT| (FN)
    (PROG (N)
      (COND ((SETQ N (GET FN NUMBER-OF-ARGS)) (RETURN N))
            ((SETQ N (SYMBOL-ARGCOUNT FN)) (RETURN N)) (T (RETURN NIL))))) 
(PUT '|S:TRACED-VERSION| 'NUMBER-OF-ARGS 3) 
(PUT '|S:TRACED-VERSION| 'DEFINED-ON-LINE '89) 
(PUT '|S:TRACED-VERSION| 'DEFINED-IN-FILE 'RTOOLS/SIMPLERTRACE.RED) 
(PUT '|S:TRACED-VERSION| 'PROCEDURE_TYPE
     '(ARROW (TIMES GENERAL GENERAL GENERAL) GENERAL)) 
(DE |S:TRACED-VERSION| (FN NARGS NEWFN)
    (PROG (R K V P)
      (SETQ R (GENSYM))
      (SETQ K 0)
      (SETQ V
              (PROG (I FORALL-RESULT FORALL-ENDPTR)
                (SETQ I 1)
                (COND ((MINUSP (DIFFERENCE NARGS I)) (RETURN NIL)))
                (SETQ FORALL-RESULT (SETQ FORALL-ENDPTR (CONS (GENSYM) NIL)))
               LOOPLABEL
                (SETQ I (PLUS2 I 1))
                (COND ((MINUSP (DIFFERENCE NARGS I)) (RETURN FORALL-RESULT)))
                (RPLACD FORALL-ENDPTR (CONS (GENSYM) NIL))
                (SETQ FORALL-ENDPTR (CDR FORALL-ENDPTR))
                (GO LOOPLABEL)))
      (SETQ P
              (LIST 'PROG (LIST R) '(COND ((NULL (ZEROP (POSN))) (TERPRI)))
                    (LIST 'PRIN2 "Entering ") (LIST 'PRINT (MKQUOTE FN))
                    (CONS 'PROGN
                          (PROG (X FORALL-RESULT FORALL-ENDPTR)
                            (SETQ X V)
                            (COND ((NULL X) (RETURN NIL)))
                            (SETQ FORALL-RESULT
                                    (SETQ FORALL-ENDPTR
                                            (CONS
                                             ((LAMBDA (X)
                                                (LIST 'PROGN
                                                      (LIST 'PRIN2 "Arg")
                                                      (LIST 'PRIN2
                                                            (SETQ K
                                                                    (PLUS K
                                                                          1)))
                                                      (LIST 'PRIN2 ": ")
                                                      (LIST 'PRINT X)))
                                              (CAR X))
                                             NIL)))
                           LOOPLABEL
                            (SETQ X (CDR X))
                            (COND ((NULL X) (RETURN FORALL-RESULT)))
                            (RPLACD FORALL-ENDPTR
                                    (CONS
                                     ((LAMBDA (X)
                                        (LIST 'PROGN (LIST 'PRIN2 "Arg")
                                              (LIST 'PRIN2 (SETQ K (PLUS K 1)))
                                              (LIST 'PRIN2 ": ")
                                              (LIST 'PRINT X)))
                                      (CAR X))
                                     NIL))
                            (SETQ FORALL-ENDPTR (CDR FORALL-ENDPTR))
                            (GO LOOPLABEL)))
                    (LIST 'SETQ R (CONS NEWFN V))
                    '(COND ((NULL (ZEROP (POSN))) (TERPRI)))
                    (LIST 'PRIN1 (MKQUOTE FN)) (LIST 'PRIN2 " = ")
                    (LIST 'PRINT R) (LIST 'RETURN R)))
      (RETURN (LIST 'LAMBDA V P)))) 
(PUT '|S:TRACE| 'NUMBER-OF-ARGS 1) 
(PUT '|S:TRACE| 'DEFINED-ON-LINE '110) 
(PUT '|S:TRACE| 'DEFINED-IN-FILE 'RTOOLS/SIMPLERTRACE.RED) 
(PUT '|S:TRACE| 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE |S:TRACE| (FN)
    (PROG (D NARGS *REDEFMSG G *COMP *PWRDS)
      (SETQ D (~~SAVED_GETD FN))
      (SETQ G
              (INTERN
               (LIST2STRING (APPEND (EXPLODE2 "~saved_") (EXPLODE2 FN)))))
      (SETQ *COMP T)
      (COND
       ((OR (NOT (EQCAR D 'EXPR)) (NULL (SETQ NARGS (|S:ARGCOUNT| FN))))
        (PROGN
         (COND ((NOT (ZEROP (POSN))) (TERPRI)))
         (PRIN2 "+++ ")
         (PRIN1 FN)
         (PRIN2 " not traceable")
         (RETURN (TERPRI)))))
      (~~SAVED_PUTD G (CAR D) (CDR D))
      (~~SAVED_PUTD FN 'EXPR (|S:TRACED-VERSION| FN NARGS G)))) 
(PUT 'SIMPLE-TRACE 'NUMBER-OF-ARGS 1) 
(PUT 'SIMPLE-TRACE 'DEFINED-ON-LINE '127) 
(PUT 'SIMPLE-TRACE 'DEFINED-IN-FILE 'RTOOLS/SIMPLERTRACE.RED) 
(PUT 'SIMPLE-TRACE 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE SIMPLE-TRACE (L)
    (PROG (X)
      (SETQ X L)
     LAB
      (COND ((NULL X) (RETURN NIL)))
      ((LAMBDA (X) (|S:TRACE| X)) (CAR X))
      (SETQ X (CDR X))
      (GO LAB))) 
(ENDMODULE) 