(cl:declaim (cl:optimize cl:debug cl:safety))
(cl:declaim (sb-ext:muffle-conditions sb-ext:compiler-note cl:style-warning))
(MODULE (LIST 'F5STAT)) 
(REVISION 'F5STAT "$Id: f5stat.red 6359 2022-07-29 06:13:09Z thomas-sturm $") 
(COPYRIGHT 'F5STAT "(c) 2022 A. Demin, T. Sturm, MPI Informatics, Germany") 
(FLUID
 '(STAT_NCURRENTINDEX* STAT_NMODULEINDICES* STAT_NALLREDUCTIONS*
   STAT_NZEROREDUCTIONS* STAT_NNORMALFORMCALLS* STAT_NDEGREERANGE*
   STAT_NCRITICALPAIRS* STAT_INITIALMINDEGREE*)) 
(SETQ STAT_NCURRENTINDEX* 0) 
(SETQ STAT_NMODULEINDICES* 0) 
(SETQ STAT_NALLREDUCTIONS* NIL) 
(SETQ STAT_NZEROREDUCTIONS* NIL) 
(SETQ STAT_NNORMALFORMCALLS* NIL) 
(SETQ STAT_NDEGREERANGE* NIL) 
(SETQ STAT_NCRITICALPAIRS* NIL) 
(FLUID '(STAT_INITIALMINDEGREE*)) 
(SETQ STAT_INITIALMINDEGREE* 10000) 
(PUT 'STAT_INIT 'NUMBER-OF-ARGS 1) 
(DE STAT_INIT (M)
    (PROGN
     (SETQ STAT_NCURRENTINDEX* 0)
     (SETQ STAT_NMODULEINDICES* M)
     (SETQ STAT_NALLREDUCTIONS* (MKVECT M))
     (SETQ STAT_NZEROREDUCTIONS* (MKVECT M))
     (SETQ STAT_NNORMALFORMCALLS* (MKVECT M))
     (SETQ STAT_NDEGREERANGE* (MKVECT M))
     (SETQ STAT_NCRITICALPAIRS* (MKVECT M))
     (PROG (I)
       (SETQ I 0)
      LAB
       (COND ((MINUSP (DIFFERENCE M I)) (RETURN NIL)))
       (PROGN
        (PUTV STAT_NALLREDUCTIONS* I 0)
        (PUTV STAT_NZEROREDUCTIONS* I 0)
        (PUTV STAT_NNORMALFORMCALLS* I 0)
        (PUTV STAT_NCRITICALPAIRS* I 0)
        (PUTV STAT_NDEGREERANGE* I (CONS STAT_INITIALMINDEGREE* 0)))
       (SETQ I (PLUS2 I 1))
       (GO LAB)))) 
(PUT 'STAT_INCREMENTZEROREDUCTIONS 'NUMBER-OF-ARGS 0) 
(DE STAT_INCREMENTZEROREDUCTIONS NIL
    (PUTV STAT_NZEROREDUCTIONS* STAT_NCURRENTINDEX*
          (PLUS (GETV STAT_NZEROREDUCTIONS* STAT_NCURRENTINDEX*) 1))) 
(PUT 'STAT_UPDATEMODULEINDEX 'NUMBER-OF-ARGS 0) 
(DE STAT_UPDATEMODULEINDEX NIL
    (SETQ STAT_NCURRENTINDEX* (PLUS STAT_NCURRENTINDEX* 1))) 
(PUT 'STAT_UPDATEPAIRS 'NUMBER-OF-ARGS 1) 
(DE STAT_UPDATEPAIRS (P)
    (PUTV STAT_NCRITICALPAIRS* STAT_NCURRENTINDEX*
          (PLUS (GETV STAT_NCRITICALPAIRS* STAT_NCURRENTINDEX*) P))) 
(PUT 'STAT_UPDATEINCREMENTAL 'NUMBER-OF-ARGS 2) 
(DE STAT_UPDATEINCREMENTAL (D P)
    (PROG (DEGREERANGE I)
      (SETQ DEGREERANGE (GETV STAT_NDEGREERANGE* STAT_NCURRENTINDEX*))
      (COND ((GREATERP (CAR DEGREERANGE) D) (SETCAR DEGREERANGE D)))
      (COND ((LESSP (CDR DEGREERANGE) D) (SETCDR DEGREERANGE D)))
      (SETQ I STAT_NCURRENTINDEX*)
      (PUTV STAT_NCRITICALPAIRS* I (PLUS (GETV STAT_NCRITICALPAIRS* I) P)))) 
(PUT 'STAT_UPDATEREDUCTIONS 'NUMBER-OF-ARGS 2) 
(DE STAT_UPDATEREDUCTIONS (NEWALLREDUCTIONS NEWNORMALFORMS)
    (PROG (I)
      (SETQ I 0)
      (SETQ I STAT_NCURRENTINDEX*)
      (SETQ NEWALLREDUCTIONS
              (PLUS (GETV STAT_NALLREDUCTIONS* I) NEWALLREDUCTIONS))
      (SETQ NEWNORMALFORMS
              (PLUS (GETV STAT_NNORMALFORMCALLS* I) NEWNORMALFORMS))
      (PUTV STAT_NALLREDUCTIONS* I NEWALLREDUCTIONS)
      (PUTV STAT_NNORMALFORMCALLS* I NEWNORMALFORMS))) 
(PUT 'STAT_PAVELIST 'NUMBER-OF-ARGS 2) 
(DE STAT_PAVELIST (S WIDTH)
    (PROGN
     (PROG ()
      WHILELABEL
       (COND ((NOT (LESSP (LENGTH S) WIDTH)) (RETURN NIL)))
       (PROGN
        (COND ((EVENP (LENGTH S)) (SETQ S (NCONC S (LIST " "))))
              (T (PROGN (SETQ S (CONS " " S)) " "))))
       (GO WHILELABEL))
     S)) 
(PUT 'STAT_JOINLIST 'NUMBER-OF-ARGS 1) 
(DE STAT_JOINLIST (S)
    (COND ((NULL S) "")
          ((LISTP (CAR S))
           (CONCAT (STAT_JOINLIST (CAR S)) (STAT_JOINLIST (CDR S))))
          (T (CONCAT (IOTO_SPRIN2 (CAR S)) (STAT_JOINLIST (CDR S)))))) 
(PUT 'STAT_PRINT 'NUMBER-OF-ARGS 0) 
(DE STAT_PRINT NIL
    (PROG (HEADER0 HEADER1 HEADER2 FOOTER SPACES TMP DEGSEP DEGS LINE COLSEP
           IDX RED1 RED2 NF MINDEG MAXDEG PS TOTALALLREDUCTIONS
           TOTALZEROREDUCTIONS TOTALNORMALFORMS TOTALCRITICALPAIRS)
      (SETQ IDX 0)
      (SETQ RED1 0)
      (SETQ RED2 0)
      (SETQ NF 0)
      (SETQ MINDEG 0)
      (SETQ MAXDEG 0)
      (SETQ PS 0)
      (SETQ TOTALALLREDUCTIONS 0)
      (SETQ TOTALZEROREDUCTIONS 0)
      (SETQ TOTALNORMALFORMS 0)
      (SETQ TOTALCRITICALPAIRS 0)
      (SETQ HEADER0
              "-------------------------------------------------------------------------------")
      (SETQ HEADER1
              "| # i | # pairs | # reductions | # zero reductions | # normal forms | degrees |")
      (SETQ HEADER2
              "-------------------------------------------------------------------------------")
      (SETQ FOOTER HEADER2)
      (SETQ SPACES (LIST 5 9 14 19 16 7))
      (SETQ DEGSEP " - ")
      (SETQ COLSEP "|")
      (PRIN2T HEADER0)
      (PRIN2T HEADER1)
      (PRIN2T HEADER2)
      (PROG (I)
        (SETQ I 1)
       LAB
        (COND ((MINUSP (DIFFERENCE STAT_NMODULEINDICES* I)) (RETURN NIL)))
        (PROGN
         (SETQ TMP SPACES)
         (SETQ IDX
                 (STAT_PAVELIST (LIST I)
                  (PROG1 (CAR TMP) (SETQ TMP (CDR TMP)))))
         (SETQ PS
                 (STAT_PAVELIST (EXPLODE (GETV STAT_NCRITICALPAIRS* I))
                  (PROG1 (CAR TMP) (SETQ TMP (CDR TMP)))))
         (SETQ RED1
                 (STAT_PAVELIST (EXPLODE (GETV STAT_NALLREDUCTIONS* I))
                  (PROG1 (CAR TMP) (SETQ TMP (CDR TMP)))))
         (SETQ RED2
                 (STAT_PAVELIST (EXPLODE (GETV STAT_NZEROREDUCTIONS* I))
                  (PROG1 (CAR TMP) (SETQ TMP (CDR TMP)))))
         (SETQ NF
                 (STAT_PAVELIST (EXPLODE (GETV STAT_NNORMALFORMCALLS* I))
                  (PROG1 (CAR TMP) (SETQ TMP (CDR TMP)))))
         (PROG (G156)
           (SETQ G156 (GETV STAT_NDEGREERANGE* I))
           (SETQ MINDEG (CAR G156))
           (SETQ MAXDEG (CDR G156))
           (RETURN G156))
         (COND
          ((NOT (EQUAL MINDEG STAT_INITIALMINDEGREE*))
           (SETQ DEGS (NCONC (EXPLODE MINDEG) (CONS DEGSEP (EXPLODE MAXDEG)))))
          (T (SETQ DEGS (LIST DEGSEP))))
         (SETQ DEGS
                 (STAT_PAVELIST DEGS (PROG1 (CAR TMP) (SETQ TMP (CDR TMP)))))
         (SETQ LINE
                 (STAT_JOINLIST
                  (LIST COLSEP IDX COLSEP PS COLSEP RED1 COLSEP RED2 COLSEP NF
                        COLSEP DEGS COLSEP)))
         (PRIN2T LINE)
         NIL)
        (SETQ I (PLUS2 I 1))
        (GO LAB))
      (PROG (I)
        (SETQ I 1)
       LAB
        (COND ((MINUSP (DIFFERENCE STAT_NMODULEINDICES* I)) (RETURN NIL)))
        (PROGN
         (SETQ TOTALALLREDUCTIONS
                 (PLUS (GETV STAT_NALLREDUCTIONS* I) TOTALALLREDUCTIONS))
         (SETQ TOTALZEROREDUCTIONS
                 (PLUS (GETV STAT_NZEROREDUCTIONS* I) TOTALZEROREDUCTIONS))
         (SETQ TOTALNORMALFORMS
                 (PLUS (GETV STAT_NNORMALFORMCALLS* I) TOTALNORMALFORMS))
         (SETQ TOTALCRITICALPAIRS
                 (PLUS (GETV STAT_NCRITICALPAIRS* I) TOTALCRITICALPAIRS)))
        (SETQ I (PLUS2 I 1))
        (GO LAB))
      (PRIN2T FOOTER)
      (PRIN2T
       (STAT_JOINLIST
        (LIST
         (STAT_PAVELIST (LIST "Total")
          (DIFFERENCE (PROG1 (CAR SPACES) (SETQ SPACES (CDR SPACES))) 2))
         (STAT_PAVELIST (EXPLODE TOTALCRITICALPAIRS)
          (PROG1 (CAR SPACES) (SETQ SPACES (CDR SPACES))))
         (STAT_PAVELIST (EXPLODE TOTALALLREDUCTIONS)
          (PLUS (PROG1 (CAR SPACES) (SETQ SPACES (CDR SPACES))) 2))
         (STAT_PAVELIST (EXPLODE TOTALZEROREDUCTIONS)
          (PROG1 (CAR SPACES) (SETQ SPACES (CDR SPACES))))
         (STAT_PAVELIST (EXPLODE TOTALNORMALFORMS)
          (PLUS (PROG1 (CAR SPACES) (SETQ SPACES (CDR SPACES))) 2))))))) 
(ENDMODULE) 