(cl:declaim (cl:optimize cl:debug cl:safety))
(cl:declaim (sb-ext:muffle-conditions sb-ext:compiler-note cl:style-warning))
(MODULE (LIST 'FORDER)) 
(GLOBAL '(KEEPL* WEDGEMTCH* LFTSHFT* INDXL*)) 
(FLUID '(KORD* SUBFG*)) 
(PUT 'ADD2L 'NUMBER-OF-ARGS 2) 
(PUT 'ADD2L 'DEFINED-ON-LINE '35) 
(PUT 'ADD2L 'DEFINED-IN-FILE 'EXCALC/FORDER.RED) 
(PUT 'ADD2L 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE ADD2L (U V) (CONS (*A2K U) (COND ((MEMQ U V) (DELETE U V)) (T V)))) 
(PUT 'FORDER 'NUMBER-OF-ARGS 1) 
(PUT 'FORDER 'DEFINED-ON-LINE '38) 
(PUT 'FORDER 'DEFINED-IN-FILE 'EXCALC/FORDER.RED) 
(PUT 'FORDER 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE FORDER (U) (FORDER1 U)) 
(PUT 'FORDER1 'NUMBER-OF-ARGS 1) 
(PUT 'FORDER1 'DEFINED-ON-LINE '41) 
(PUT 'FORDER1 'DEFINED-IN-FILE 'EXCALC/FORDER.RED) 
(PUT 'FORDER1 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE FORDER1 (U)
    ((LAMBDA (X)
       (PROG ()
        WHILELABEL
         (COND ((NOT X) (RETURN NIL)))
         (PROGN
          (SETQ KORD* (ADD2L (CAR X) KORD*))
          (COND
           ((EQCAR (CAR X) 'WEDGE)
            (PROG (J)
              (SETQ J (REVERSE (CDAR X)))
             LAB
              (COND ((NULL J) (RETURN NIL)))
              ((LAMBDA (J) (SETQ KORD* (ADD2L J KORD*))) (CAR J))
              (SETQ J (CDR J))
              (GO LAB))))
          (SETQ X (CDR X)))
         (GO WHILELABEL)))
     (REVERSE U))) 
(PUT 'REMFORDER 'NUMBER-OF-ARGS 1) 
(PUT 'REMFORDER 'DEFINED-ON-LINE '51) 
(PUT 'REMFORDER 'DEFINED-IN-FILE 'EXCALC/FORDER.RED) 
(PUT 'REMFORDER 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE REMFORDER (U)
    (PROG (J)
      (SETQ J U)
     LAB
      (COND ((NULL J) (RETURN NIL)))
      ((LAMBDA (J) (SETQ KORD* (DELETE J KORD*))) (CAR J))
      (SETQ J (CDR J))
      (GO LAB))) 
(PUT 'ISOLATE 'NUMBER-OF-ARGS 1) 
(PUT 'ISOLATE 'DEFINED-ON-LINE '54) 
(PUT 'ISOLATE 'DEFINED-IN-FILE 'EXCALC/FORDER.RED) 
(PUT 'ISOLATE 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE ISOLATE (U)
    (RERROR 'EXCALC 2 "Sorry, ISOLATE not supported in this version")) 
(PUT 'REMISOLATE 'NUMBER-OF-ARGS 1) 
(PUT 'REMISOLATE 'DEFINED-ON-LINE '60) 
(PUT 'REMISOLATE 'DEFINED-IN-FILE 'EXCALC/FORDER.RED) 
(PUT 'REMISOLATE 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE REMISOLATE (U)
    (PROG (J)
      (SETQ J U)
     LAB
      (COND ((NULL J) (RETURN NIL)))
      ((LAMBDA (J) (SETQ LFTSHFT* (DELETE J LFTSHFT*))) (CAR J))
      (SETQ J (CDR J))
      (GO LAB))) 
(PUT 'WORDERP 'NUMBER-OF-ARGS 2) 
(PUT 'WORDERP 'DEFINED-ON-LINE '63) 
(PUT 'WORDERP 'DEFINED-IN-FILE 'EXCALC/FORDER.RED) 
(PUT 'WORDERP 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE WORDERP (X Y)
    (COND
     ((AND (NULL (ATOM X)) (FLAGP (CAR X) 'INDEXVAR) (NULL (ATOM Y))
           (FLAGP (CAR Y) 'INDEXVAR))
      (INDEXVARORDP X Y))
     ((OR (ATOM X) (MEMQ X KORD*))
      (COND ((OR (ATOM Y) (MEMQ Y KORD*)) (ORDOP X Y))
            (T ((LAMBDA (Z) (COND ((EQ X Z) T) (T (WORDERP X Z)))) (PEEL Y)))))
     ((OR (ATOM Y) (MEMQ Y KORD*))
      ((LAMBDA (Z) (COND ((EQ Z Y) NIL) (T (WORDERP Z Y)))) (PEEL X)))
     (T (WORDERP (PEEL X) (PEEL Y))))) 
(PUT 'INDEXVARORDP 'NUMBER-OF-ARGS 2) 
(PUT 'INDEXVARORDP 'DEFINED-ON-LINE '76) 
(PUT 'INDEXVARORDP 'DEFINED-IN-FILE 'EXCALC/FORDER.RED) 
(PUT 'INDEXVARORDP 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE INDEXVARORDP (U V)
    (COND
     ((OR (NOT (EQ (CAR U) (CAR V))) (MEMQ U KORD*) (MEMQ V KORD*))
      (ORDOP U V))
     (T
      ((LAMBDA (X Y)
         (COND
          ((BOUNDINDP X INDXL*)
           (COND ((BOUNDINDP Y INDXL*) (INDORDLP (CDR U) (CDR V))) (T T)))
          ((BOUNDINDP Y INDXL*) NIL) (T (ORDOP U V))))
       (FLATINDXL (CDR U)) (FLATINDXL (CDR V)))))) 
(PUT 'INDORDLP 'NUMBER-OF-ARGS 2) 
(PUT 'INDORDLP 'DEFINED-ON-LINE '86) 
(PUT 'INDORDLP 'DEFINED-IN-FILE 'EXCALC/FORDER.RED) 
(PUT 'INDORDLP 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE INDORDLP (U V)
    (COND ((NULL U) NIL) ((NULL V) T)
          ((EQUAL (CAR U) (CAR V)) (INDORDLP (CDR U) (CDR V)))
          ((ATOM (CAR U))
           (COND ((ATOM (CAR V)) (INDORDP (CAR U) (CAR V))) (T T)))
          ((ATOM (CAR V)) NIL) (T (INDORDP (CADAR U) (CADAR V))))) 
(PUT 'PEEL 'NUMBER-OF-ARGS 1) 
(PUT 'PEEL 'DEFINED-ON-LINE '96) 
(PUT 'PEEL 'DEFINED-IN-FILE 'EXCALC/FORDER.RED) 
(PUT 'PEEL 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE PEEL (U)
    (COND ((MEMQ (CAR U) '(LIEDF INNERPROD)) (CADDR U))
          ((EQ (CAR U) 'QUOTIENT)
           (COND ((WORDERP (CADR U) (CADDR U)) (CADR U)) (T (CADDR U))))
          (T (CADR U)))) 
(PUT 'INDORDP 'NUMBER-OF-ARGS 2) 
(PUT 'INDORDP 'DEFINED-ON-LINE '103) 
(PUT 'INDORDP 'DEFINED-IN-FILE 'EXCALC/FORDER.RED) 
(PUT 'INDORDP 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE INDORDP (U V)
    (PROG (X)
      (SETQ X INDXL*)
      (COND ((NULL (MEMQ U X)) (RETURN T)))
     A
      (COND ((NULL X) (RETURN (ORDERP U V))))
      (COND ((EQ U (CAR X)) (RETURN T)) ((EQ V (CAR X)) (RETURN NIL)))
      (SETQ X (CDR X))
      (GO A))) 
(PUT 'INDORDN 'NUMBER-OF-ARGS 1) 
(PUT 'INDORDN 'DEFINED-ON-LINE '114) 
(PUT 'INDORDN 'DEFINED-IN-FILE 'EXCALC/FORDER.RED) 
(PUT 'INDORDN 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE INDORDN (U)
    (COND ((NULL U) NIL) ((NULL (CDR U)) U)
          ((NULL (CDDR U)) (INDORD2 (CAR U) (CADR U)))
          (T (INDORDAD (CAR U) (INDORDN (CDR U)))))) 
(PUT 'INDORD2 'NUMBER-OF-ARGS 2) 
(PUT 'INDORD2 'DEFINED-ON-LINE '120) 
(PUT 'INDORD2 'DEFINED-IN-FILE 'EXCALC/FORDER.RED) 
(PUT 'INDORD2 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE INDORD2 (U V) (COND ((INDORDP U V) (LIST U V)) (T (LIST V U)))) 
(PUT 'INDORDAD 'NUMBER-OF-ARGS 2) 
(PUT 'INDORDAD 'DEFINED-ON-LINE '123) 
(PUT 'INDORDAD 'DEFINED-IN-FILE 'EXCALC/FORDER.RED) 
(PUT 'INDORDAD 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE INDORDAD (A U)
    (COND ((NULL U) (LIST A)) ((INDORDP A (CAR U)) (CONS A U))
          (T (CONS (CAR U) (INDORDAD A (CDR U)))))) 
(PUT 'KEEP 'NUMBER-OF-ARGS 1) 
(PUT 'KEEP 'DEFINED-ON-LINE '128) 
(PUT 'KEEP 'DEFINED-IN-FILE 'EXCALC/FORDER.RED) 
(PUT 'KEEP 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE KEEP (U)
    (PROG ()
     WHILELABEL
      (COND ((NOT U) (RETURN NIL)))
      (PROGN
       (COND ((NOT (EQEXPR (CAR U))) (ERRPRI2 (CAR U) 'HOLD))
             (T
              (PROG (X Y Z)
                (SETQ Z SUBFG*)
                (SETQ SUBFG* NIL)
                (SETQ X (*A2K (CADAR U)))
                (SETQ Y (*A2K (CADDAR U)))
                (FORDER1 (LIST X Y))
                (SETQ KEEPL* (CONS (CONS X Y) KEEPL*))
                (FLAG (LIST X) 'KEEP)
                (PUT X 'KEEPL (LIST Y))
                (SETQ SUBFG* Z)
                (PUTDEP X Y)
                (COND ((NULL (EXDFK Y)) (FLAG (LIST X) 'CLOSED)))
                (COND
                 ((EQCAR Y 'WEDGE)
                  (PROGN
                   (SETQ WEDGEMTCH* (CONS (CONS (CDR Y) X) WEDGEMTCH*))
                   (PROG (J)
                     (SETQ J (CDR Y))
                    LAB
                     (COND ((NULL J) (RETURN NIL)))
                     ((LAMBDA (J)
                        (SETQ WEDGEMTCH*
                                (CONS (CONS (LIST X J) NIL) WEDGEMTCH*)))
                      (CAR J))
                     (SETQ J (CDR J))
                     (GO LAB))))
                 (T (LET2 Y X NIL T))))))
       (SETQ U (CDR U)))
      (GO WHILELABEL))) 
(PUT 'PUTDEP 'NUMBER-OF-ARGS 2) 
(PUT 'PUTDEP 'DEFINED-ON-LINE '151) 
(PUT 'PUTDEP 'DEFINED-IN-FILE 'EXCALC/FORDER.RED) 
(PUT 'PUTDEP 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE PUTDEP (U V)
    (PROG (J)
      (SETQ J (CDR V))
     LAB
      (COND ((NULL J) (RETURN NIL)))
      ((LAMBDA (J) (COND ((ATOM J) (DEPEND1 U J T)) (T (PUTDEP U J)))) (CAR J))
      (SETQ J (CDR J))
      (GO LAB))) 
(ENDMODULE) 