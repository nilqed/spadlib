(cl:declaim (cl:optimize cl:debug cl:safety))
(cl:declaim (sb-ext:muffle-conditions sb-ext:compiler-note cl:style-warning))
(MODULE (LIST 'TPSEVAL)) 
(FLUID '(PS |PS:ORDER-LIMIT| |PS:MAX-ORDER|)) 
(PUT '|PS:UNKNOWN-ORDER| 'NUMBER-OF-ARGS 1) 
(PUT '|PS:UNKNOWN-ORDER| 'DEFINED-ON-LINE '100) 
(PUT '|PS:UNKNOWN-ORDER| 'DEFINED-IN-FILE 'TPS/TPSEVAL.RED) 
(PUT '|PS:UNKNOWN-ORDER| 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE |PS:UNKNOWN-ORDER| (PS)
    ((LAMBDA (U V)
       (COND ((GEQ V U) U)
             (T
              (RERROR 'TPS 20
                      (LIST "Can't find the order of " (|PS:VALUE| PS))))))
     (|PS:ORDER| PS) (|PS:LAST-TERM| PS))) 
(PUT '|PS:FIND-ORDER| 'NUMBER-OF-ARGS 1) 
(PUT '|PS:FIND-ORDER| 'DEFINED-ON-LINE '107) 
(PUT '|PS:FIND-ORDER| 'DEFINED-IN-FILE 'TPS/TPSEVAL.RED) 
(PUT '|PS:FIND-ORDER| 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE |PS:FIND-ORDER| (PS)
    (COND ((NULL PS) 0) ((IDP PS) PS)
          (((LAMBDA (U)
              (OR (NUMBERP U)
                  (AND (PAIRP U) (NEQ (CAR U) '|:PS:|) (GET (CAR U) 'DNAME))))
            PS)
           0)
          ((EQCAR PS '|:PS:|)
           (PROGN
            (COND ((IDP (CDR PS)) (|PS:UNKNOWN-ORDER| PS))
                  ((ATOM (|PS:EXPRESSION| PS)) (|PS:ORDER| PS))
                  (T (|PS:FIND-ORDER1| PS)))))
          (T (RERROR 'TPS 21 "Unexpected form in ps!:find!-order")))) 
(PUT '|PS:FIND-ORDER1| 'NUMBER-OF-ARGS 1) 
(PUT '|PS:FIND-ORDER1| 'DEFINED-ON-LINE '117) 
(PUT '|PS:FIND-ORDER1| 'DEFINED-IN-FILE 'TPS/TPSEVAL.RED) 
(PUT '|PS:FIND-ORDER1| 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE |PS:FIND-ORDER1| (PS)
    (PROG (PSOPERATOR PSORD PSLAST)
      (SETQ PSORD (|PS:ORDER| PS))
      (SETQ PSLAST (|PS:LAST-TERM| PS))
      (COND ((LEQ PSORD PSLAST) (RETURN PSORD)))
      (SETQ PSOPERATOR (CAR (|PS:GETV| PS 6)))
      (SETQ PSORD (APPLY (GET PSOPERATOR '|PS:ORDER-FN|) (LIST PS)))
      (|PS:PUTV| PS 0 PSORD)
      (|PS:PUTV| PS 1 (DIFFERENCE PSORD 1))
      (COND
       ((EQUAL (|PS:VALUE| PS) 0)
        (PROGN (SETQ PSORD 0) (|PS:PUTV| PS 1 |PS:MAX-ORDER|)))
       (T
        (PROG ()
         WHILELABEL
          (COND
           ((NOT (EQUAL (|PS:EVALUATE-NEXT| PS PSORD) (CONS NIL 1)))
            (RETURN NIL)))
          (PROGN
           (SETQ PSORD (PLUS PSORD 1))
           (COND
            ((GREATERP PSORD |PS:ORDER-LIMIT|)
             (RERROR 'TPS 22
                     (LIST "Expression " (|PS:VALUE| PS)
                           " has zero expansion to order " PSORD)))))
          (GO WHILELABEL))))
      (RETURN PSORD))) 
(SETQ |PS:ORDER-LIMIT| 100) 
(PUT 'PSORDLIM 'SIMPFN 'SIMPPSORDLIM) 
(PUT 'SIMPPSORDLIM 'NUMBER-OF-ARGS 1) 
(PUT 'SIMPPSORDLIM 'DEFINED-ON-LINE '150) 
(PUT 'SIMPPSORDLIM 'DEFINED-IN-FILE 'TPS/TPSEVAL.RED) 
(PUT 'SIMPPSORDLIM 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE SIMPPSORDLIM (U)
    (PROG (N)
      (SETQ N 0)
      (SETQ N |PS:ORDER-LIMIT|)
      (COND (U (SETQ |PS:ORDER-LIMIT| (IEVAL (CARX U 'PSORDLIM)))))
      (RETURN (COND ((EQUAL N 0) (CONS NIL 1)) (T (CONS N 1)))))) 
(PUT 'PLUS '|PS:ORDER-FN| '|PS:PLUS-ORDERFN|) 
(PUT 'INT '|PS:ORDER-FN| '|PS:INT-ORDERFN|) 
(PUT 'DF '|PS:ORDER-FN| '|PS:DF-ORDERFN|) 
(PUT 'QUOTIENT '|PS:ORDER-FN| '|PS:QUOTIENT-ORDERFN|) 
(PUT 'TIMES '|PS:ORDER-FN| '|PS:TIMES-ORDERFN|) 
(PUT 'MINUS '|PS:ORDER-FN| '|PS:MINUS-ORDERFN|) 
(PUT 'DIFFERENCE '|PS:ORDER-FN| '|PS:DIFFERENCE-ORDERFN|) 
(PUT '|PS:INT-ORDERFN| 'NUMBER-OF-ARGS 1) 
(PUT '|PS:INT-ORDERFN| 'DEFINED-ON-LINE '165) 
(PUT '|PS:INT-ORDERFN| 'DEFINED-IN-FILE 'TPS/TPSEVAL.RED) 
(PUT '|PS:INT-ORDERFN| 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE |PS:INT-ORDERFN| (PS)
    (PROG (U V)
      (SETQ V (|PS:DEPVAR| PS))
      (SETQ U (|PS:FIND-ORDER| (CADR (|PS:EXPRESSION| PS))))
      (RETURN
       (COND
        ((EQUAL V (CADDR (|PS:EXPRESSION| PS)))
         (COND
          ((NEQ (|PS:EXPANSION-POINT| PS) '|PS:INF|)
           (COND
            ((EQUAL U (MINUS 1)) (RERROR 'TPS 23 "Logarithmic Singularity"))
            (T (PLUS U 1))))
          ((EQUAL U 1) (RERROR 'TPS 24 "Logarithmic Singularity"))
          (T (DIFFERENCE U 1))))
        (T U))))) 
(PUT '|PS:DF-ORDERFN| 'NUMBER-OF-ARGS 1) 
(PUT '|PS:DF-ORDERFN| 'DEFINED-ON-LINE '180) 
(PUT '|PS:DF-ORDERFN| 'DEFINED-IN-FILE 'TPS/TPSEVAL.RED) 
(PUT '|PS:DF-ORDERFN| 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE |PS:DF-ORDERFN| (PS)
    (PROG (U V PT DFVAR)
      (SETQ V (|PS:EXPRESSION| PS))
      (SETQ U (|PS:FIND-ORDER| (CADR V)))
      (SETQ DFVAR (CADDR V))
      (SETQ PT (|PS:EXPANSION-POINT| PS))
      (RETURN
       (COND
        ((EQUAL (|PS:DEPVAR| PS) DFVAR)
         (COND ((NEQ PT '|PS:INF|) (COND ((EQUAL U 0) 0) (T (DIFFERENCE U 1))))
               ((EQUAL U 0) 2) (T (PLUS U 1))))
        ((DEPENDS PT DFVAR) (COND ((EQUAL U 0) 0) (T (DIFFERENCE U 1))))
        (T U))))) 
(PUT '|PS:QUOTIENT-ORDERFN| 'NUMBER-OF-ARGS 1) 
(PUT '|PS:QUOTIENT-ORDERFN| 'DEFINED-ON-LINE '195) 
(PUT '|PS:QUOTIENT-ORDERFN| 'DEFINED-IN-FILE 'TPS/TPSEVAL.RED) 
(PUT '|PS:QUOTIENT-ORDERFN| 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE |PS:QUOTIENT-ORDERFN| (PS)
    (PROG (U V)
      (SETQ V (|PS:EXPRESSION| PS))
      (SETQ U (|PS:FIND-ORDER| (CADR V)))
      (SETQ V (|PS:FIND-ORDER| (CADDR V)))
      (RETURN (DIFFERENCE U V)))) 
(PUT '|PS:TIMES-ORDERFN| 'NUMBER-OF-ARGS 1) 
(PUT '|PS:TIMES-ORDERFN| 'DEFINED-ON-LINE '203) 
(PUT '|PS:TIMES-ORDERFN| 'DEFINED-IN-FILE 'TPS/TPSEVAL.RED) 
(PUT '|PS:TIMES-ORDERFN| 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE |PS:TIMES-ORDERFN| (PS)
    (PROG (U V)
      (SETQ V (|PS:EXPRESSION| PS))
      (SETQ U (|PS:FIND-ORDER| (CADR V)))
      (SETQ V (|PS:FIND-ORDER| (CADDR V)))
      (RETURN (PLUS2 U V)))) 
(PUT '|PS:PLUS-ORDERFN| 'NUMBER-OF-ARGS 1) 
(PUT '|PS:PLUS-ORDERFN| 'DEFINED-ON-LINE '214) 
(PUT '|PS:PLUS-ORDERFN| 'DEFINED-IN-FILE 'TPS/TPSEVAL.RED) 
(PUT '|PS:PLUS-ORDERFN| 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE |PS:PLUS-ORDERFN| (PS)
    (PROG (W M)
      (COND ((NULL PS) (RETURN 0)))
      (SETQ W (MAPCAR (CDR (|PS:EXPRESSION| PS)) '|PS:FIND-ORDER|))
      (SETQ M (CAR W))
      (PROG (Z)
        (SETQ Z (CDR W))
       LAB
        (COND ((NULL Z) (RETURN NIL)))
        ((LAMBDA (Z) (COND ((LESSP Z M) (SETQ M Z)))) (CAR Z))
        (SETQ Z (CDR Z))
        (GO LAB))
      (RETURN M))) 
(PUT '|PS:MINUS-ORDERFN| 'NUMBER-OF-ARGS 1) 
(PUT '|PS:MINUS-ORDERFN| 'DEFINED-ON-LINE '224) 
(PUT '|PS:MINUS-ORDERFN| 'DEFINED-IN-FILE 'TPS/TPSEVAL.RED) 
(PUT '|PS:MINUS-ORDERFN| 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE |PS:MINUS-ORDERFN| (PS) (|PS:FIND-ORDER| (CADR (|PS:EXPRESSION| PS)))) 
(PUT '|PS:DIFFERENCE-ORDERFN| 'NUMBER-OF-ARGS 1) 
(PUT '|PS:DIFFERENCE-ORDERFN| 'DEFINED-ON-LINE '227) 
(PUT '|PS:DIFFERENCE-ORDERFN| 'DEFINED-IN-FILE 'TPS/TPSEVAL.RED) 
(PUT '|PS:DIFFERENCE-ORDERFN| 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE |PS:DIFFERENCE-ORDERFN| (PS)
    (PROG (U V)
      (SETQ V (|PS:EXPRESSION| PS))
      (SETQ U (|PS:FIND-ORDER| (CADR V)))
      (SETQ V (|PS:FIND-ORDER| (CADDR V)))
      (RETURN (MIN2 U V)))) 
(PUT 'SQRT '|PS:ORDER-FN| '|PS:SQRT-ORDERFN|) 
(PUT 'SQRT '|PS:ERULE| '|PS:SQRT-ERULE|) 
(PUT '|PS:SQRT-ORDERFN| 'NUMBER-OF-ARGS 1) 
(PUT '|PS:SQRT-ORDERFN| 'DEFINED-ON-LINE '238) 
(PUT '|PS:SQRT-ORDERFN| 'DEFINED-IN-FILE 'TPS/TPSEVAL.RED) 
(PUT '|PS:SQRT-ORDERFN| 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE |PS:SQRT-ORDERFN| (PS)
    (PROG (U)
      (SETQ U (|PS:FIND-ORDER| (CADR (|PS:EXPRESSION| PS))))
      (RETURN
       ((LAMBDA (V)
          (COND ((EQUAL (TIMES V 2) U) V)
                (T (RERROR 'TPS 25 "Branch Point in Sqrt"))))
        (QUOTIENT U 2))))) 
(PUT '|PS:SQRT-ERULE| 'NUMBER-OF-ARGS 2) 
(PUT '|PS:SQRT-ERULE| 'DEFINED-ON-LINE '246) 
(PUT '|PS:SQRT-ERULE| 'DEFINED-IN-FILE 'TPS/TPSEVAL.RED) 
(PUT '|PS:SQRT-ERULE| 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE |PS:SQRT-ERULE| (A N)
    (PROG (AA X Y Z)
      (SETQ AA (CADR A))
      (SETQ Z (CONS NIL 1))
      (SETQ Y (|PS:ORDER| AA))
      (SETQ X (|PS:ORDER| PS))
      (COND
       ((EQUAL N X)
        (RETURN
         ((LAMBDA (U)
            (COND (*QSUM-SIMPEXPT (QSUM-SIMPEXPT U)) (T (BASIC-SIMPEXPT U))))
          (LIST (PREPSQXX (|PS:EVALUATE| AA Y)) '(QUOTIENT 1 2))))))
      (PROG (K)
        (SETQ K 1)
       LAB
        (COND ((MINUSP (DIFFERENCE (DIFFERENCE N X) K)) (RETURN NIL)))
        (SETQ Z
                (ADDSQ Z
                       (MULTSQ
                        (CONS
                         ((LAMBDA (Y) (COND ((EQUAL Y 0) NIL) (T Y)))
                          (PLUS (DIFFERENCE (TIMES K 3) (TIMES 2 N)) Y))
                         1)
                        (MULTSQ (|PS:EVALUATE| AA (PLUS K Y))
                                (|PS:EVALUATE| PS (DIFFERENCE N K))))))
        (SETQ K (PLUS2 K 1))
        (GO LAB))
      (RETURN
       (MULTSQ Z
               (INVSQ
                (MULTSQ (CONS (TIMES 2 (DIFFERENCE N X)) 1)
                        (|PS:EVALUATE| AA Y))))))) 
(PUT 'CBRT '|PS:ORDER-FN| '|PS:CBRT-ORDERFN|) 
(PUT 'CBRT '|PS:ERULE| '|PS:CBRT-ERULE|) 
(PUT '|PS:CBRT-ORDERFN| 'NUMBER-OF-ARGS 1) 
(PUT '|PS:CBRT-ORDERFN| 'DEFINED-ON-LINE '274) 
(PUT '|PS:CBRT-ORDERFN| 'DEFINED-IN-FILE 'TPS/TPSEVAL.RED) 
(PUT '|PS:CBRT-ORDERFN| 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE |PS:CBRT-ORDERFN| (PS)
    (PROG (U)
      (SETQ U (|PS:FIND-ORDER| (CADR (|PS:EXPRESSION| PS))))
      (RETURN
       ((LAMBDA (V)
          (COND ((EQUAL (TIMES V 3) U) V)
                (T (RERROR 'TPS 26 "Branch Point in Cbrt"))))
        (QUOTIENT U 3))))) 
(PUT '|PS:CBRT-ERULE| 'NUMBER-OF-ARGS 2) 
(PUT '|PS:CBRT-ERULE| 'DEFINED-ON-LINE '282) 
(PUT '|PS:CBRT-ERULE| 'DEFINED-IN-FILE 'TPS/TPSEVAL.RED) 
(PUT '|PS:CBRT-ERULE| 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE |PS:CBRT-ERULE| (A N)
    (PROG (AA X Y Z)
      (SETQ AA (CADR A))
      (SETQ Z (CONS NIL 1))
      (SETQ Y (|PS:ORDER| AA))
      (SETQ X (|PS:ORDER| PS))
      (COND
       ((EQUAL N X)
        (RETURN
         ((LAMBDA (U)
            (COND (*QSUM-SIMPEXPT (QSUM-SIMPEXPT U)) (T (BASIC-SIMPEXPT U))))
          (LIST (PREPSQXX (|PS:EVALUATE| AA Y)) '(QUOTIENT 1 3))))))
      (PROG (K)
        (SETQ K 1)
       LAB
        (COND ((MINUSP (DIFFERENCE (DIFFERENCE N X) K)) (RETURN NIL)))
        (SETQ Z
                (ADDSQ Z
                       (MULTSQ
                        (CONS
                         ((LAMBDA (Y) (COND ((EQUAL Y 0) NIL) (T Y)))
                          (PLUS (DIFFERENCE (TIMES K 4) (TIMES 3 N)) Y))
                         1)
                        (MULTSQ (|PS:EVALUATE| AA (PLUS K Y))
                                (|PS:EVALUATE| PS (DIFFERENCE N K))))))
        (SETQ K (PLUS2 K 1))
        (GO LAB))
      (RETURN
       (MULTSQ Z
               (INVSQ
                (MULTSQ (CONS (TIMES 3 (DIFFERENCE N X)) 1)
                        (|PS:EVALUATE| AA Y))))))) 
(PUT 'DEF-INT '|PS:ORDER-FN| '|PS:DEFINT-ORDERFN|) 
(PUT 'DEF-INT '|PS:ERULE| '|PS:DEFINT-ERULE|) 
(PUT '|PS:DEFINT-ORDERFN| 'NUMBER-OF-ARGS 1) 
(PUT '|PS:DEFINT-ORDERFN| 'DEFINED-ON-LINE '301) 
(PUT '|PS:DEFINT-ORDERFN| 'DEFINED-IN-FILE 'TPS/TPSEVAL.RED) 
(PUT '|PS:DEFINT-ORDERFN| 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE |PS:DEFINT-ORDERFN| (PS) (|PS:FIND-ORDER| (CADR (|PS:EXPRESSION| PS)))) 
(PUT '|PS:DEFINT-ERULE| 'NUMBER-OF-ARGS 2) 
(PUT '|PS:DEFINT-ERULE| 'DEFINED-ON-LINE '304) 
(PUT '|PS:DEFINT-ERULE| 'DEFINED-IN-FILE 'TPS/TPSEVAL.RED) 
(PUT '|PS:DEFINT-ERULE| 'PROCEDURE_TYPE
     '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE |PS:DEFINT-ERULE| (A N)
    ((LAMBDA (TERM)
       (ADDSQ (SUBST (CADDDR A) '**X TERM)
              (NEGSQ (SUBST (CADDR A) '**X TERM))))
     (|PS:EVALUATE| (CADR A) N))) 
(PUT '|PS:EVALUATE| 'NUMBER-OF-ARGS 2) 
(PUT '|PS:EVALUATE| 'DEFINED-ON-LINE '310) 
(PUT '|PS:EVALUATE| 'DEFINED-IN-FILE 'TPS/TPSEVAL.RED) 
(PUT '|PS:EVALUATE| 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE |PS:EVALUATE| (PS I)
    (PROG (TERM)
      (SETQ TERM (|PS:GET-TERM| PS I))
      (COND (TERM (RETURN TERM)))
      (PROG (J)
        (SETQ J (PLUS (|PS:LAST-TERM| PS) 1))
       LAB
        (COND ((MINUSP (DIFFERENCE I J)) (RETURN NIL)))
        (SETQ TERM (|PS:EVALUATE-NEXT| PS J))
        (SETQ J (PLUS2 J 1))
        (GO LAB))
      (RETURN TERM))) 
(PUT '|PS:EVALUATE-NEXT| 'NUMBER-OF-ARGS 2) 
(PUT '|PS:EVALUATE-NEXT| 'DEFINED-ON-LINE '319) 
(PUT '|PS:EVALUATE-NEXT| 'DEFINED-IN-FILE 'TPS/TPSEVAL.RED) 
(PUT '|PS:EVALUATE-NEXT| 'PROCEDURE_TYPE
     '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE |PS:EVALUATE-NEXT| (PS N)
    (PROG (NEXT)
      (SETQ NEXT
              (APPLY (GET (CAR (|PS:GETV| PS 6)) '|PS:ERULE|)
                     (LIST (|PS:EXPRESSION| PS) N)))
      (|PS:SET-TERM| PS N (SETQ NEXT (SIMP* (PREPSQXX NEXT))))
      (RETURN NEXT))) 
(PUT '|PS:PLUS-ERULE| 'NUMBER-OF-ARGS 2) 
(PUT '|PS:PLUS-ERULE| 'DEFINED-ON-LINE '329) 
(PUT '|PS:PLUS-ERULE| 'DEFINED-IN-FILE 'TPS/TPSEVAL.RED) 
(PUT '|PS:PLUS-ERULE| 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE |PS:PLUS-ERULE| (A N)
    (PROG (Z)
      (SETQ Z (CONS NIL 1))
      (PROG (TERM)
        (SETQ TERM (CDR A))
       LAB
        (COND ((NULL TERM) (RETURN NIL)))
        ((LAMBDA (TERM) (SETQ Z (ADDSQ Z (|PS:EVALUATE| TERM N)))) (CAR TERM))
        (SETQ TERM (CDR TERM))
        (GO LAB))
      (RETURN Z))) 
(PUT 'PLUS '|PS:ERULE| '|PS:PLUS-ERULE|) 
(PUT '|PS:MINUS-ERULE| 'NUMBER-OF-ARGS 2) 
(PUT '|PS:MINUS-ERULE| 'DEFINED-ON-LINE '339) 
(PUT '|PS:MINUS-ERULE| 'DEFINED-IN-FILE 'TPS/TPSEVAL.RED) 
(PUT '|PS:MINUS-ERULE| 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE |PS:MINUS-ERULE| (A N) (NEGSQ (|PS:EVALUATE| (CADR A) N))) 
(PUT 'MINUS '|PS:ERULE| '|PS:MINUS-ERULE|) 
(PUT '|PS:DIFFERENCE-ERULE| 'NUMBER-OF-ARGS 2) 
(PUT '|PS:DIFFERENCE-ERULE| 'DEFINED-ON-LINE '344) 
(PUT '|PS:DIFFERENCE-ERULE| 'DEFINED-IN-FILE 'TPS/TPSEVAL.RED) 
(PUT '|PS:DIFFERENCE-ERULE| 'PROCEDURE_TYPE
     '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE |PS:DIFFERENCE-ERULE| (A N)
    (ADDSQ (|PS:EVALUATE| (CADR A) N) (NEGSQ (|PS:EVALUATE| (CADDR A) N)))) 
(PUT 'DIFFERENCE '|PS:ERULE| '|PS:DIFFERENCE-ERULE|) 
(PUT '|PS:TIMES-ERULE| 'NUMBER-OF-ARGS 2) 
(PUT '|PS:TIMES-ERULE| 'DEFINED-ON-LINE '350) 
(PUT '|PS:TIMES-ERULE| 'DEFINED-IN-FILE 'TPS/TPSEVAL.RED) 
(PUT '|PS:TIMES-ERULE| 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE |PS:TIMES-ERULE| (A N)
    (PROG (AA B X Y Y1 Z)
      (SETQ AA (CADR A))
      (SETQ B (CADDR A))
      (SETQ Z (CONS NIL 1))
      (SETQ X (|PS:ORDER| AA))
      (SETQ Y (|PS:ORDER| PS))
      (SETQ Y1 (|PS:ORDER| B))
      (PROG (I)
        (SETQ I 0)
       LAB
        (COND ((MINUSP (DIFFERENCE (DIFFERENCE N Y) I)) (RETURN NIL)))
        (COND
         ((GEQ (DIFFERENCE (DIFFERENCE N X) I) Y1)
          (SETQ Z
                  (ADDSQ Z
                         (MULTSQ (|PS:EVALUATE| AA (PLUS I X))
                                 (|PS:EVALUATE| B
                                  (DIFFERENCE (DIFFERENCE N X) I)))))))
        (SETQ I (PLUS2 I 1))
        (GO LAB))
      (RETURN Z))) 
(PUT 'TIMES '|PS:ERULE| '|PS:TIMES-ERULE|) 
(PUT '|PS:QUOTIENT-ERULE| 'NUMBER-OF-ARGS 2) 
(PUT '|PS:QUOTIENT-ERULE| 'DEFINED-ON-LINE '364) 
(PUT '|PS:QUOTIENT-ERULE| 'DEFINED-IN-FILE 'TPS/TPSEVAL.RED) 
(PUT '|PS:QUOTIENT-ERULE| 'PROCEDURE_TYPE
     '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE |PS:QUOTIENT-ERULE| (A N)
    (PROG (AA B X Y Z)
      (SETQ AA (CADR A))
      (SETQ B (CADDR A))
      (SETQ Z (CONS NIL 1))
      (SETQ Y (|PS:ORDER| B))
      (SETQ X (|PS:ORDER| PS))
      (PROG (I)
        (SETQ I 1)
       LAB
        (COND ((MINUSP (DIFFERENCE (DIFFERENCE N X) I)) (RETURN NIL)))
        (SETQ Z
                (ADDSQ Z
                       (MULTSQ (|PS:EVALUATE| B (PLUS I Y))
                               (|PS:EVALUATE| PS (DIFFERENCE N I)))))
        (SETQ I (PLUS2 I 1))
        (GO LAB))
      (RETURN
       (MULTSQ (ADDSQ (|PS:EVALUATE| AA (PLUS N Y)) (NEGSQ Z))
               (INVSQ (|PS:EVALUATE| B Y)))))) 
(PUT 'QUOTIENT '|PS:ERULE| '|PS:QUOTIENT-ERULE|) 
(PUT 'PSMULT '|PS:ORDER-FN| '|PS:CONSTMULT-ORDERFN|) 
(PUT 'PSMULT '|PS:ERULE| '|PS:CONSTMULT-ERULE|) 
(PUT '|PS:CONSTMULT-ORDERFN| 'NUMBER-OF-ARGS 1) 
(PUT '|PS:CONSTMULT-ORDERFN| 'DEFINED-ON-LINE '387) 
(PUT '|PS:CONSTMULT-ORDERFN| 'DEFINED-IN-FILE 'TPS/TPSEVAL.RED) 
(PUT '|PS:CONSTMULT-ORDERFN| 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE |PS:CONSTMULT-ORDERFN| (PS) (|PS:FIND-ORDER| (CADDR (|PS:EXPRESSION| PS)))) 
(PUT '|PS:CONSTMULT-ERULE| 'NUMBER-OF-ARGS 2) 
(PUT '|PS:CONSTMULT-ERULE| 'DEFINED-ON-LINE '390) 
(PUT '|PS:CONSTMULT-ERULE| 'DEFINED-IN-FILE 'TPS/TPSEVAL.RED) 
(PUT '|PS:CONSTMULT-ERULE| 'PROCEDURE_TYPE
     '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE |PS:CONSTMULT-ERULE| (A N) (MULTSQ (CADR A) (|PS:EVALUATE| (CADDR A) N))) 
(PUT '|PS:DF-ERULE| 'NUMBER-OF-ARGS 2) 
(PUT '|PS:DF-ERULE| 'DEFINED-ON-LINE '393) 
(PUT '|PS:DF-ERULE| 'DEFINED-IN-FILE 'TPS/TPSEVAL.RED) 
(PUT '|PS:DF-ERULE| 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE |PS:DF-ERULE| (A N)
    (PROG (DFVAR SERIES ABOUT)
      (SETQ DFVAR (CADDR A))
      (SETQ SERIES (CADR A))
      (SETQ ABOUT (|PS:EXPANSION-POINT| SERIES))
      (RETURN
       (COND
        ((EQUAL DFVAR (|PS:DEPVAR| SERIES))
         (COND
          ((NEQ ABOUT '|PS:INF|)
           (MULTSQ (CONS (PLUS N 1) 1) (|PS:EVALUATE| SERIES (PLUS N 1))))
          (T
           (MULTSQ (CONS (DIFFERENCE 1 N) 1)
                   (|PS:EVALUATE| SERIES (DIFFERENCE N 1))))))
        ((DEPENDS ABOUT DFVAR)
         (ADDSQ (DIFFSQ (|PS:EVALUATE| SERIES N) DFVAR)
                (MULTSQ (CONS (DIFFERENCE (MINUS N) 1) 1)
                        (MULTSQ (|PS:EVALUATE| SERIES (PLUS N 1))
                                (DIFFSQ (SIMP* ABOUT) DFVAR)))))
        (T (DIFFSQ (|PS:EVALUATE| SERIES N) DFVAR)))))) 
(PUT 'DF '|PS:ERULE| '|PS:DF-ERULE|) 
(PUT '|PS:INT-ERULE| 'NUMBER-OF-ARGS 2) 
(PUT '|PS:INT-ERULE| 'DEFINED-ON-LINE '412) 
(PUT '|PS:INT-ERULE| 'DEFINED-IN-FILE 'TPS/TPSEVAL.RED) 
(PUT '|PS:INT-ERULE| 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE |PS:INT-ERULE| (A N)
    (COND
     ((EQUAL (CADDR A) (|PS:DEPVAR| (CADR A)))
      (COND
       ((NEQ (|PS:EXPANSION-POINT| (CADR A)) '|PS:INF|)
        (MULTSQ (|PS:EVALUATE| (CADR A) (DIFFERENCE N 1)) (INVSQ (CONS N 1))))
       (T
        (MULTSQ (|PS:EVALUATE| (CADR A) (PLUS N 1))
                (INVSQ (CONS (MINUS N) 1))))))
     (T (SIMPINT (LIST (PREPSQXX (|PS:EVALUATE| (CADR A) N)) (CADDR A)))))) 
(PUT 'INT '|PS:ERULE| '|PS:INT-ERULE|) 
(PUT '|PS:EXPT-ORDERFN| 'NUMBER-OF-ARGS 1) 
(PUT '|PS:EXPT-ORDERFN| 'DEFINED-ON-LINE '421) 
(PUT '|PS:EXPT-ORDERFN| 'DEFINED-IN-FILE 'TPS/TPSEVAL.RED) 
(PUT '|PS:EXPT-ORDERFN| 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE |PS:EXPT-ORDERFN| (PS)
    (PROG (U V W EXPRES)
      (SETQ EXPRES (|PS:EXPRESSION| PS))
      (SETQ U (|PS:FIND-ORDER| (CADR EXPRES)))
      (SETQ V (CADDR EXPRES))
      (SETQ W (CADDDR EXPRES))
      (COND ((EQUAL (CDR (SETQ V (DIVIDE (TIMES U V) W))) 0) (RETURN (CAR V)))
            (T (RERROR 'TPS 27 "Branch Point in EXPT"))))) 
(PUT '|PS:EXPT-ERULE| 'NUMBER-OF-ARGS 2) 
(PUT '|PS:EXPT-ERULE| 'DEFINED-ON-LINE '431) 
(PUT '|PS:EXPT-ERULE| 'DEFINED-IN-FILE 'TPS/TPSEVAL.RED) 
(PUT '|PS:EXPT-ERULE| 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE |PS:EXPT-ERULE| (A N)
    (PROG (BASE X Y Z P Q)
      (SETQ BASE (CADR A))
      (SETQ P (CADDR A))
      (SETQ Q (CADDDR A))
      (SETQ Y (|PS:ORDER| BASE))
      (SETQ Z (|PS:ORDER| PS))
      (COND
       ((EQUAL N Z)
        (PROGN
         (COND ((EQUAL Q 1) (SETQ X P)) (T (SETQ X (LIST 'QUOTIENT P Q))))
         (RETURN
          ((LAMBDA (U)
             (COND (*QSUM-SIMPEXPT (QSUM-SIMPEXPT U)) (T (BASIC-SIMPEXPT U))))
           (LIST (PREPSQXX (|PS:EVALUATE| BASE Y)) X)))))
       (T
        (PROGN
         (SETQ X (CONS NIL 1))
         (PROG (K)
           (SETQ K 1)
          LAB
           (COND ((MINUSP (DIFFERENCE (DIFFERENCE N Z) K)) (RETURN NIL)))
           (SETQ X
                   (ADDSQ X
                          (MULTSQ
                           (CONS
                            ((LAMBDA (NUM) (COND ((EQUAL NUM 0) NIL) (T NUM)))
                             (PLUS (TIMES K P)
                                   (TIMES Q (PLUS (DIFFERENCE K N) Z))))
                            Q)
                           (MULTSQ (|PS:EVALUATE| BASE (PLUS K Y))
                                   (|PS:EVALUATE| PS (DIFFERENCE N K))))))
           (SETQ K (PLUS2 K 1))
           (GO LAB))
         (RETURN
          (MULTSQ X
                  (INVSQ
                   (MULTSQ (CONS (DIFFERENCE N Z) 1)
                           (|PS:EVALUATE| BASE Y)))))))))) 
(PUT 'EXPT '|PS:ERULE| '|PS:EXPT-ERULE|) 
(PUT 'EXPT '|PS:ORDER-FN| '|PS:EXPT-ORDERFN|) 
(PUT '|PS:EXP-ORDERFN| 'NUMBER-OF-ARGS 1) 
(PUT '|PS:EXP-ORDERFN| 'DEFINED-ON-LINE '454) 
(PUT '|PS:EXP-ORDERFN| 'DEFINED-IN-FILE 'TPS/TPSEVAL.RED) 
(PUT '|PS:EXP-ORDERFN| 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE |PS:EXP-ORDERFN| (PS)
    (COND
     ((LESSP (|PS:FIND-ORDER| (CADR (|PS:EXPRESSION| PS))) 0)
      (RERROR 'TPS 28 "Essential Singularity in EXP"))
     (T 0))) 
(PUT '|PS:EXP-ERULE| 'NUMBER-OF-ARGS 2) 
(PUT '|PS:EXP-ERULE| 'DEFINED-ON-LINE '459) 
(PUT '|PS:EXP-ERULE| 'DEFINED-IN-FILE 'TPS/TPSEVAL.RED) 
(PUT '|PS:EXP-ERULE| 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE |PS:EXP-ERULE| (A N)
    (PROG (EXP1 X)
      (SETQ EXP1 (CADR A))
      (COND
       ((EQUAL N 0)
        (RETURN
         ((LAMBDA (U)
            (COND (*QSUM-SIMPEXPT (QSUM-SIMPEXPT U)) (T (BASIC-SIMPEXPT U))))
          (LIST 'E (PREPSQXX (|PS:EVALUATE| EXP1 0)))))))
      (SETQ X (CONS NIL 1))
      (PROG (K)
        (SETQ K 0)
       LAB
        (COND ((MINUSP (DIFFERENCE (DIFFERENCE N 1) K)) (RETURN NIL)))
        (SETQ X
                (ADDSQ X
                       (MULTSQ (CONS (DIFFERENCE N K) 1)
                               (MULTSQ (|PS:EVALUATE| EXP1 (DIFFERENCE N K))
                                       (|PS:EVALUATE| PS K)))))
        (SETQ K (PLUS2 K 1))
        (GO LAB))
      (RETURN (MULTSQ X (INVSQ (CONS N 1)))))) 
(PUT 'EXP '|PS:ERULE| '|PS:EXP-ERULE|) 
(PUT 'EXP '|PS:ORDER-FN| '|PS:EXP-ORDERFN|) 
(PUT '|PS:TAYLOR-ERULE| 'NUMBER-OF-ARGS 2) 
(PUT '|PS:TAYLOR-ERULE| 'DEFINED-ON-LINE '479) 
(PUT '|PS:TAYLOR-ERULE| 'DEFINED-IN-FILE 'TPS/TPSEVAL.RED) 
(PUT '|PS:TAYLOR-ERULE| 'PROCEDURE_TYPE
     '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE |PS:TAYLOR-ERULE| (A N)
    (PROG (DERIV TERM DEPVAR ABOUT)
      (SETQ DEPVAR (CADR A))
      (SETQ ABOUT (CADDR A))
      (SETQ DERIV (CADDDR A))
      (SETQ DERIV (PREPSQ (SIMP (LIST 'QUOTIENT (LIST 'DF DERIV DEPVAR) N))))
      (SETQ TERM (SIMP (SUBST ABOUT DEPVAR DERIV)))
      (RPLACD (CDDR A) (LIST DERIV))
      (RETURN TERM))) 
(PUT '|PS:TAYLOR| '|PS:ERULE| '|PS:TAYLOR-ERULE|) 
(PUT '|PS:GAMMA-ERULE| 'NUMBER-OF-ARGS 2) 
(PUT '|PS:GAMMA-ERULE| 'DEFINED-ON-LINE '493) 
(PUT '|PS:GAMMA-ERULE| 'DEFINED-IN-FILE 'TPS/TPSEVAL.RED) 
(PUT '|PS:GAMMA-ERULE| 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE |PS:GAMMA-ERULE| (A N)
    (PROG (DERIV TERM DEPVAR ABOUT)
      (SETQ DEPVAR (CADR A))
      (SETQ ABOUT (CADDR A))
      (SETQ DERIV (CADDDR A))
      (RULE-LIST '(PSI_RULES) NIL)
      (SETQ DERIV (PREPSQ (SIMP (LIST 'QUOTIENT (LIST 'DF DERIV DEPVAR) N))))
      (RULE-LIST '(PSI_RULES) T)
      (SETQ TERM (SIMP (SUBST ABOUT DEPVAR DERIV)))
      (RPLACD (CDDR A) (LIST DERIV))
      (RETURN TERM))) 
(PUT '|PS:GAMMA| '|PS:ERULE| '|PS:GAMMA-ERULE|) 
(ENDMODULE) 