(cl:declaim (cl:optimize cl:debug cl:safety))
(cl:declaim (sb-ext:muffle-conditions sb-ext:compiler-note cl:style-warning))
(MODULE (LIST 'ACFSFQE)) 
(REVISION 'ACFSFQE "$Id: acfsfqe.red 5986 2021-08-28 13:35:27Z thomas-sturm $") 
(COPYRIGHT 'ACFSFQE "(c) 1995-2009 A. Dolzmann, T. Sturm") 
(PUT 'ACFSF_GQE 'NUMBER-OF-ARGS 3) 
(PUT 'ACFSF_GQE 'DEFINED-ON-LINE '36) 
(PUT 'ACFSF_GQE 'DEFINED-IN-FILE 'REDLOG/ACFSF/ACFSFQE.RED) 
(PUT 'ACFSF_GQE 'PROCEDURE_TYPE
     '(ARROW (TIMES GENERAL GENERAL GENERAL) GENERAL)) 
(DE ACFSF_GQE (F THEO XBVL)
    (PROG (*CGBGEN *CGBREAL) (SETQ *CGBGEN T) (RETURN (ACFSF_QE1 F THEO XBVL)))) 
(PUT 'ACFSF_QE 'NUMBER-OF-ARGS 2) 
(PUT 'ACFSF_QE 'DEFINED-ON-LINE '44) 
(PUT 'ACFSF_QE 'DEFINED-IN-FILE 'REDLOG/ACFSF/ACFSFQE.RED) 
(PUT 'ACFSF_QE 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE ACFSF_QE (F THEO)
    (PROG (*CGBGEN *CGBREAL)
      (SETQ *CGBGEN NIL)
      (RETURN (ACFSF_QE1 F THEO NIL)))) 
(PUT 'ACFSF_QE1 'NUMBER-OF-ARGS 3) 
(PUT 'ACFSF_QE1 'DEFINED-ON-LINE '53) 
(PUT 'ACFSF_QE1 'DEFINED-IN-FILE 'REDLOG/ACFSF/ACFSFQE.RED) 
(PUT 'ACFSF_QE1 'PROCEDURE_TYPE
     '(ARROW (TIMES GENERAL GENERAL GENERAL) GENERAL)) 
(DE ACFSF_QE1 (F THEO XBVL)
    (PROG (W QBLKL QFF BVL)
      (SETQ F (RL_SIMPL (RL_PNF F) THEO (MINUS 1)))
      (SETQ W (CL_SPLT F))
      (SETQ QBLKL (CAR W))
      (COND ((NULL QBLKL) (RETURN F)))
      (SETQ QFF (CADR W))
      (SETQ BVL (CADDR W))
      (SETQ THEO
              (PROG (ATF FORALL-RESULT FORALL-ENDPTR)
                (SETQ ATF THEO)
               STARTOVER
                (COND ((NULL ATF) (RETURN NIL)))
                (SETQ FORALL-RESULT
                        ((LAMBDA (ATF)
                           (COND
                            ((NULL (INTERSECTION (RL_VARLAT ATF) BVL))
                             (LIST ATF))))
                         (CAR ATF)))
                (SETQ FORALL-ENDPTR (LASTPAIR FORALL-RESULT))
                (SETQ ATF (CDR ATF))
                (COND ((ATOM FORALL-ENDPTR) (GO STARTOVER)))
               LOOPLABEL
                (COND ((NULL ATF) (RETURN FORALL-RESULT)))
                (RPLACD FORALL-ENDPTR
                        ((LAMBDA (ATF)
                           (COND
                            ((NULL (INTERSECTION (RL_VARLAT ATF) BVL))
                             (LIST ATF))))
                         (CAR ATF)))
                (SETQ FORALL-ENDPTR (LASTPAIR FORALL-ENDPTR))
                (SETQ ATF (CDR ATF))
                (GO LOOPLABEL)))
      (SETQ XBVL (NCONC BVL XBVL))
      (COND
       (*RLQEGEN
        (COND
         ((CDR QBLKL)
          (REDERR "acfsf_qe: gqe supported only for one block of quantifiers"))
         (XBVL (REDERR "acfsf_qe: does not accept a xbvl")))))
      (PROG (QBLK)
        (SETQ QBLK QBLKL)
       LAB
        (COND ((NULL QBLK) (RETURN NIL)))
        ((LAMBDA (QBLK) (SETQ QFF (ACFSF_QEBLK QBLK QFF THEO XBVL)))
         (CAR QBLK))
        (SETQ QBLK (CDR QBLK))
        (GO LAB))
      (RETURN QFF))) 
(PUT 'ACFSF_QEBLK 'NUMBER-OF-ARGS 4) 
(PUT 'ACFSF_QEBLK 'DEFINED-ON-LINE '78) 
(PUT 'ACFSF_QEBLK 'DEFINED-IN-FILE 'REDLOG/ACFSF/ACFSFQE.RED) 
(PUT 'ACFSF_QEBLK 'PROCEDURE_TYPE
     '(ARROW (TIMES GENERAL GENERAL GENERAL GENERAL) GENERAL)) 
(DE ACFSF_QEBLK (QBLK F THEO BVL)
    (COND ((EQ (CAR QBLK) 'EX) (ACFSF_QEBLK1 (CDR QBLK) F THEO BVL))
          (T (CL_NNFNOT (ACFSF_QEBLK1 (CDR QBLK) (CL_NNFNOT F) THEO BVL))))) 
(PUT 'ACFSF_QEBLK1 'NUMBER-OF-ARGS 4) 
(PUT 'ACFSF_QEBLK1 'DEFINED-ON-LINE '88) 
(PUT 'ACFSF_QEBLK1 'DEFINED-IN-FILE 'REDLOG/ACFSF/ACFSFQE.RED) 
(PUT 'ACFSF_QEBLK1 'PROCEDURE_TYPE
     '(ARROW (TIMES GENERAL GENERAL GENERAL GENERAL) GENERAL)) 
(DE ACFSF_QEBLK1 (VL F THEO BVL)
    (PROG (W FL)
      (SETQ F (RL_DNF F))
      (SETQ FL
              (COND ((EQ (COND ((ATOM F) F) (T (CAR F))) 'OR) (CDR F))
                    (T (LIST F))))
      (SETQ W
              (PROG (C FORALL-RESULT FORALL-ENDPTR)
                (SETQ C FL)
                (COND ((NULL C) (RETURN NIL)))
                (SETQ FORALL-RESULT
                        (SETQ FORALL-ENDPTR
                                (CONS
                                 ((LAMBDA (C) (ACFSF_QEBLK2 VL C THEO BVL))
                                  (CAR C))
                                 NIL)))
               LOOPLABEL
                (SETQ C (CDR C))
                (COND ((NULL C) (RETURN FORALL-RESULT)))
                (RPLACD FORALL-ENDPTR
                        (CONS
                         ((LAMBDA (C) (ACFSF_QEBLK2 VL C THEO BVL)) (CAR C))
                         NIL))
                (SETQ FORALL-ENDPTR (CDR FORALL-ENDPTR))
                (GO LOOPLABEL)))
      (RETURN
       (RL_SIMPL
        ((LAMBDA (G142)
           (COND ((AND G142 (CDR G142)) (CONS 'OR G142))
                 ((NULL G142) (COND ((EQ 'OR 'AND) 'TRUE) (T 'FALSE)))
                 (T (CAR G142))))
         (REVERSIP W))
        THEO (MINUS 1))))) 
(PUT 'ACFSF_QEBLK2 'NUMBER-OF-ARGS 4) 
(PUT 'ACFSF_QEBLK2 'DEFINED-ON-LINE '101) 
(PUT 'ACFSF_QEBLK2 'DEFINED-IN-FILE 'REDLOG/ACFSF/ACFSFQE.RED) 
(PUT 'ACFSF_QEBLK2 'PROCEDURE_TYPE
     '(ARROW (TIMES GENERAL GENERAL GENERAL GENERAL) GENERAL)) 
(DE ACFSF_QEBLK2 (VL F THEO BVL)
    (PROG (W ATL EQTL ITHEO CGB CD)
      (COND ((OR (EQ F 'TRUE) (EQ F 'FALSE)) (RETURN F)))
      (SETQ ATL (CL_ATL1 F))
      (SETQ W (ACFSF_SPLTCJ ATL VL))
      (SETQ ATL (CAR W))
      (SETQ ITHEO (CDR W))
      (SETQ W (ACFSF_EQTL ATL))
      (SETQ EQTL (CAR W))
      (SETQ VL (NCONC (CDR W) VL))
      ((LAMBDA (*CGBVERBOSE) (SETQ CGB (CGB_CGBF EQTL CD VL 'REVGRADLEX NIL)))
       NIL)
      (RETURN
       ((LAMBDA (G144)
          (COND ((AND G144 (CDR G144)) (CONS 'AND G144))
                ((NULL G144) (COND ((EQ 'AND 'AND) 'TRUE) (T 'FALSE)))
                (T (CAR G144))))
        (CONS (ACFSF_QEFL CGB VL) ITHEO))))) 
(PUT 'ACFSF_SPLTCJ 'NUMBER-OF-ARGS 2) 
(PUT 'ACFSF_SPLTCJ 'DEFINED-ON-LINE '122) 
(PUT 'ACFSF_SPLTCJ 'DEFINED-IN-FILE 'REDLOG/ACFSF/ACFSFQE.RED) 
(PUT 'ACFSF_SPLTCJ 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE ACFSF_SPLTCJ (ATL VL)
    (PROG (NATL ITHEO)
      (PROG (X)
        (SETQ X ATL)
       LAB
        (COND ((NULL X) (RETURN NIL)))
        ((LAMBDA (X)
           (COND ((INTERSECTION (ACFSF_VARLAT X) VL) (SETQ NATL (CONS X NATL)))
                 (T (SETQ ITHEO (CONS X ITHEO)))))
         (CAR X))
        (SETQ X (CDR X))
        (GO LAB))
      (RETURN (CONS NATL ITHEO)))) 
(PUT 'ACFSF_EQTL 'NUMBER-OF-ARGS 1) 
(PUT 'ACFSF_EQTL 'DEFINED-ON-LINE '138) 
(PUT 'ACFSF_EQTL 'DEFINED-IN-FILE 'REDLOG/ACFSF/ACFSFQE.RED) 
(PUT 'ACFSF_EQTL 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE ACFSF_EQTL (ATL)
    (PROG (EQTL NEQTL W)
      (PROG (AT)
        (SETQ AT ATL)
       LAB
        (COND ((NULL AT) (RETURN NIL)))
        ((LAMBDA (AT)
           (COND
            ((EQ (ACFSF_OP AT) 'EQUAL)
             (SETQ EQTL (CONS (ACFSF_ARG2L AT) EQTL)))
            (T (SETQ NEQTL (CONS (ACFSF_ARG2L AT) NEQTL)))))
         (CAR AT))
        (SETQ AT (CDR AT))
        (GO LAB))
      (SETQ W (ACFSF_RMNEQTL NEQTL))
      (SETQ EQTL (NCONC (CAR W) EQTL))
      (RETURN (CONS EQTL (CDR W))))) 
(PUT 'ACFSF_RMNEQTL 'NUMBER-OF-ARGS 1) 
(PUT 'ACFSF_RMNEQTL 'DEFINED-ON-LINE '155) 
(PUT 'ACFSF_RMNEQTL 'DEFINED-IN-FILE 'REDLOG/ACFSF/ACFSFQE.RED) 
(PUT 'ACFSF_RMNEQTL 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE ACFSF_RMNEQTL (NEQTL)
    (PROG (P V)
      (COND ((NULL NEQTL) (RETURN (CONS NIL NIL))))
      (SETQ P 1)
      (PROG (U)
        (SETQ U NEQTL)
       LAB
        (COND ((NULL U) (RETURN NIL)))
        ((LAMBDA (U)
           (SETQ P
                   (COND (*PHYSOP-LOADED (PHYSOP-MULTF P U))
                         (T (POLY-MULTF P U)))))
         (CAR U))
        (SETQ U (CDR U))
        (GO LAB))
      (SETQ V (ACFSF_TAGVAR))
      (SETQ P
              (ADDF
               ((LAMBDA (G146)
                  (COND (*PHYSOP-LOADED (PHYSOP-MULTF P G146))
                        (T (POLY-MULTF P G146))))
                (CAR (SIMP V)))
               (NEGF 1)))
      (RETURN (CONS (LIST P) (LIST V))))) 
(PUT 'ACFSF_TAGVAR 'NUMBER-OF-ARGS 0) 
(PUT 'ACFSF_TAGVAR 'DEFINED-ON-LINE '172) 
(PUT 'ACFSF_TAGVAR 'DEFINED-IN-FILE 'REDLOG/ACFSF/ACFSFQE.RED) 
(PUT 'ACFSF_TAGVAR 'PROCEDURE_TYPE '(ARROW UNIT GENERAL)) 
(DE ACFSF_TAGVAR NIL (INTERN (GENSYM))) 
(PUT 'ACFSF_QEFL 'NUMBER-OF-ARGS 2) 
(PUT 'ACFSF_QEFL 'DEFINED-ON-LINE '177) 
(PUT 'ACFSF_QEFL 'DEFINED-IN-FILE 'REDLOG/ACFSF/ACFSFQE.RED) 
(PUT 'ACFSF_QEFL 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE ACFSF_QEFL (UL VL)
    (PROG (FL OENV)
      (COND ((NULL UL) (RETURN 'TRUE)))
      (SETQ OENV (DIP_INIT VL 'REVGRADLEX NIL))
      (SETQ FL
              (PROG (U FORALL-RESULT FORALL-ENDPTR)
                (SETQ U UL)
                (COND ((NULL U) (RETURN NIL)))
                (SETQ FORALL-RESULT
                        (SETQ FORALL-ENDPTR
                                (CONS
                                 ((LAMBDA (U)
                                    (ACFSF_QEFL1
                                     (DIP_F2DIP1 U (EV_ZERO) (CONS 1 1))))
                                  (CAR U))
                                 NIL)))
               LOOPLABEL
                (SETQ U (CDR U))
                (COND ((NULL U) (RETURN FORALL-RESULT)))
                (RPLACD FORALL-ENDPTR
                        (CONS
                         ((LAMBDA (U)
                            (ACFSF_QEFL1 (DIP_F2DIP1 U (EV_ZERO) (CONS 1 1))))
                          (CAR U))
                         NIL))
                (SETQ FORALL-ENDPTR (CDR FORALL-ENDPTR))
                (GO LOOPLABEL)))
      (DIP_CLEANUP OENV)
      (RETURN
       (COND ((AND FL (CDR FL)) (CONS 'AND FL))
             ((NULL FL) (COND ((EQ 'AND 'AND) 'TRUE) (T 'FALSE)))
             (T (CAR FL)))))) 
(PUT 'ACFSF_QEFL1 'NUMBER-OF-ARGS 1) 
(PUT 'ACFSF_QEFL1 'DEFINED-ON-LINE '190) 
(PUT 'ACFSF_QEFL1 'DEFINED-IN-FILE 'REDLOG/ACFSF/ACFSFQE.RED) 
(PUT 'ACFSF_QEFL1 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE ACFSF_QEFL1 (P)
    (PROG (FL CL LEV LC)
      (PROG ()
       WHILELABEL
        (COND ((NOT P) (RETURN NIL)))
        (PROGN
         (SETQ CL (CONS (CADR P) CL))
         (SETQ LEV (CAR P))
         (SETQ P (CDDR P))
         NIL)
        (GO WHILELABEL))
      (COND ((EV_ZERO? LEV) (PROGN (SETQ LC (CAR CL)) (SETQ CL (CDR CL))))
            (T (SETQ LC (SIMP 0))))
      (SETQ FL
              (PROG (C FORALL-RESULT FORALL-ENDPTR)
                (SETQ C CL)
                (COND ((NULL C) (RETURN NIL)))
                (SETQ FORALL-RESULT
                        (SETQ FORALL-ENDPTR
                                (CONS
                                 ((LAMBDA (C) (ACFSF_0MK2 'NEQ (ACFSF_BC2F C)))
                                  (CAR C))
                                 NIL)))
               LOOPLABEL
                (SETQ C (CDR C))
                (COND ((NULL C) (RETURN FORALL-RESULT)))
                (RPLACD FORALL-ENDPTR
                        (CONS
                         ((LAMBDA (C) (ACFSF_0MK2 'NEQ (ACFSF_BC2F C)))
                          (CAR C))
                         NIL))
                (SETQ FORALL-ENDPTR (CDR FORALL-ENDPTR))
                (GO LOOPLABEL)))
      (SETQ FL (CONS (ACFSF_0MK2 'EQUAL (ACFSF_BC2F LC)) FL))
      (RETURN
       (COND ((AND FL (CDR FL)) (CONS 'OR FL))
             ((NULL FL) (COND ((EQ 'OR 'AND) 'TRUE) (T 'FALSE)))
             (T (CAR FL)))))) 
(PUT 'ACFSF_BC2F 'NUMBER-OF-ARGS 1) 
(PUT 'ACFSF_BC2F 'DEFINED-ON-LINE '211) 
(PUT 'ACFSF_BC2F 'DEFINED-IN-FILE 'REDLOG/ACFSF/ACFSFQE.RED) 
(PUT 'ACFSF_BC2F 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE ACFSF_BC2F (C) (CAR C)) 
(PUT 'ACFSF_THSIMPL 'NUMBER-OF-ARGS 1) 
(PUT 'ACFSF_THSIMPL 'DEFINED-ON-LINE '217) 
(PUT 'ACFSF_THSIMPL 'DEFINED-IN-FILE 'REDLOG/ACFSF/ACFSFQE.RED) 
(PUT 'ACFSF_THSIMPL 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE ACFSF_THSIMPL (ATL)
    (PROG (*RLSIEXPLA *RLSIPO)
      (SETQ *RLSIEXPLA T)
      (RETURN
       (SORT
        (ACFSF_THREGEN
         (CL_SIMPL
          (COND ((AND ATL (CDR ATL)) (CONS 'AND ATL))
                ((NULL ATL) (COND ((EQ 'AND 'AND) 'TRUE) (T 'FALSE)))
                (T (CAR ATL)))
          NIL (MINUS 1)))
        'RL_ORDATP)))) 
(PUT 'ACFSF_THREGEN 'NUMBER-OF-ARGS 1) 
(PUT 'ACFSF_THREGEN 'DEFINED-ON-LINE '226) 
(PUT 'ACFSF_THREGEN 'DEFINED-IN-FILE 'REDLOG/ACFSF/ACFSFQE.RED) 
(PUT 'ACFSF_THREGEN 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE ACFSF_THREGEN (F)
    (PROG (OP)
      (SETQ OP (COND ((ATOM F) F) (T (CAR F))))
      (COND
       ((EQUAL OP 'AND)
        (RETURN
         (PROG (X FORALL-RESULT FORALL-ENDPTR)
           (SETQ X (CDR F))
           (COND ((NULL X) (RETURN NIL)))
           (SETQ FORALL-RESULT
                   (SETQ FORALL-ENDPTR
                           (CONS ((LAMBDA (X) (ACFSF_THREGEN-OR X)) (CAR X))
                                 NIL)))
          LOOPLABEL
           (SETQ X (CDR X))
           (COND ((NULL X) (RETURN FORALL-RESULT)))
           (RPLACD FORALL-ENDPTR
                   (CONS ((LAMBDA (X) (ACFSF_THREGEN-OR X)) (CAR X)) NIL))
           (SETQ FORALL-ENDPTR (CDR FORALL-ENDPTR))
           (GO LOOPLABEL)))))
      (COND ((EQUAL OP 'OR) (RETURN (LIST (ACFSF_THREGEN-OR F)))))
      (COND ((EQUAL OP 'TRUE) (RETURN NIL)))
      (COND ((EQUAL OP 'FALSE) (LIST 'FALSE)))
      (RETURN (LIST F)))) 
(PUT 'ACFSF_THREGEN-OR 'NUMBER-OF-ARGS 1) 
(PUT 'ACFSF_THREGEN-OR 'DEFINED-ON-LINE '245) 
(PUT 'ACFSF_THREGEN-OR 'DEFINED-IN-FILE 'REDLOG/ACFSF/ACFSFQE.RED) 
(PUT 'ACFSF_THREGEN-OR 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE ACFSF_THREGEN-OR (F)
    (PROG (W)
      (COND ((CL_ATFP F) (RETURN F)))
      (SETQ W (CAR (SIMP 1)))
      (PROG (EQU)
        (SETQ EQU (CDR F))
       LAB
        (COND ((NULL EQU) (RETURN NIL)))
        ((LAMBDA (EQU)
           (PROGN
            (COND
             ((NEQ (COND ((ATOM EQU) EQU) (T (CAR EQU))) 'EQUAL)
              (REDERR "Bug in acfsf_thregen!-or")))
            (SETQ W
                    (COND (*PHYSOP-LOADED (PHYSOP-MULTF W (CADR EQU)))
                          (T (POLY-MULTF W (CADR EQU)))))))
         (CAR EQU))
        (SETQ EQU (CDR EQU))
        (GO LAB))
      (RETURN (ACFSF_0MK2 'EQUAL W)))) 
(ENDMODULE) 