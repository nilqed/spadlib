(cl:declaim (cl:optimize cl:debug cl:safety))
(cl:declaim (sb-ext:muffle-conditions sb-ext:compiler-note cl:style-warning))
(MODULE (LIST 'IO)) 
(FLUID '(*ECHO *INT *REDUCE4 SEMIC* IFL* CURLINE*)) 
(GLOBAL '(CONTL* IPL* LINELIST* OFL* OPL* TECHO*)) 
(PUT 'FILE-TRANSFORM 'NUMBER-OF-ARGS 2) 
(PUT 'FILE-TRANSFORM 'DEFINED-ON-LINE '36) 
(PUT 'FILE-TRANSFORM 'DEFINED-IN-FILE 'RLISP/IO.RED) 
(PUT 'FILE-TRANSFORM 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE FILE-TRANSFORM (U V)
    (PROG (ECHO ICHAN OLDICHAN VAL)
      (SETQ ECHO *ECHO)
      (SETQ *ECHO NIL)
      (SETQ ICHAN (OPEN U 'INPUT))
      (SETQ OLDICHAN (RDS ICHAN))
      (SETQ VAL (ERRORSET* (LIST V) T))
      (SETQ *ECHO ECHO)
      (CLOSE ICHAN)
      (RDS OLDICHAN)
      (COND ((NOT (ERRORP VAL)) (RETURN (CAR VAL)))))) 
(PUT 'INFILE 'NUMBER-OF-ARGS 1) 
(PUT 'INFILE 'DEFINED-ON-LINE '51) 
(PUT 'INFILE 'DEFINED-IN-FILE 'RLISP/IO.RED) 
(PUT 'INFILE 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE INFILE (U)
    (PROG (*INT IFL* CURLINE*)
      (SETQ IFL* (LIST U))
      (SETQ CURLINE* 1)
      (RETURN (FILE-TRANSFORM U (FUNCTION BEGIN1))))) 
(PUT 'IN 'NUMBER-OF-ARGS 1) 
(PUT 'IN 'DEFINED-ON-LINE '59) 
(PUT 'IN 'DEFINED-IN-FILE 'RLISP/IO.RED) 
(PUT 'IN 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE IN (U) (IN_NON_EMPTY_LIST U)) 
(PUT 'IN_TEX 'NUMBER-OF-ARGS 1) 
(PUT 'IN_TEX 'DEFINED-ON-LINE '61) 
(PUT 'IN_TEX 'DEFINED-IN-FILE 'RLISP/IO.RED) 
(PUT 'IN_TEX 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE IN_TEX (U) (IN_NON_EMPTY_LIST1 U '(|\\| E N D { R E D U C E }))) 
(PUT 'IN_NON_EMPTY_LIST 'NUMBER-OF-ARGS 1) 
(PUT 'IN_NON_EMPTY_LIST 'DEFINED-ON-LINE '65) 
(PUT 'IN_NON_EMPTY_LIST 'DEFINED-IN-FILE 'RLISP/IO.RED) 
(PUT 'IN_NON_EMPTY_LIST 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE IN_NON_EMPTY_LIST (U) (IN_NON_EMPTY_LIST1 U NIL)) 
(PUT 'IN_NON_EMPTY_LIST1 'NUMBER-OF-ARGS 2) 
(PUT 'IN_NON_EMPTY_LIST1 'DEFINED-ON-LINE '67) 
(PUT 'IN_NON_EMPTY_LIST1 'DEFINED-IN-FILE 'RLISP/IO.RED) 
(PUT 'IN_NON_EMPTY_LIST1 'PROCEDURE_TYPE
     '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE IN_NON_EMPTY_LIST1 (U PREFIXCHARS)
    (PROG (ECHOP)
      (SETQ ECHOP (NULL (EQUAL SEMIC* '$)))
      (COND ((NULL IFL*) (SETQ TECHO* *ECHO)))
      (COND (*REDUCE4 (SETQ U (VALUE U))))
      (PROG (FL)
        (SETQ FL U)
       LAB
        (COND ((NULL FL) (RETURN NIL)))
        ((LAMBDA (FL) (IN_LIST1A FL ECHOP PREFIXCHARS)) (CAR FL))
        (SETQ FL (CDR FL))
        (GO LAB))
      (COND (IPL* (SETQ IFL* (CAR IPL*))) (T (SETQ IFL* NIL)))
      (COND (IFL* (SETQ CURLINE* (CADDR IFL*))))
      (COND (*REDUCE4 (RETURN (MKOBJECT NIL 'NOVAL)))))) 
(PUT 'MKFIL* 'NUMBER-OF-ARGS 1) 
(PUT 'MKFIL* 'DEFINED-ON-LINE '78) 
(PUT 'MKFIL* 'DEFINED-IN-FILE 'RLISP/IO.RED) 
(PUT 'MKFIL* 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE MKFIL* (U)
    (PROG (X)
      (RETURN
       (COND ((STRINGP U) U) ((NOT (IDP U)) (TYPERR U "file name"))
             ((AND (FLAGP U 'SHARE) (STRINGP (SETQ X (EVAL U)))) X)
             (T (STRING-DOWNCASE U)))))) 
(PUT 'IN_LIST1 'NUMBER-OF-ARGS 2) 
(PUT 'IN_LIST1 'DEFINED-ON-LINE '89) 
(PUT 'IN_LIST1 'DEFINED-IN-FILE 'RLISP/IO.RED) 
(PUT 'IN_LIST1 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE IN_LIST1 (FL ECHOP) (IN_LIST1A FL ECHOP NIL)) 
(PUT 'IN_LIST1A 'NUMBER-OF-ARGS 3) 
(PUT 'IN_LIST1A 'DEFINED-ON-LINE '92) 
(PUT 'IN_LIST1A 'DEFINED-IN-FILE 'RLISP/IO.RED) 
(PUT 'IN_LIST1A 'PROCEDURE_TYPE
     '(ARROW (TIMES GENERAL GENERAL GENERAL) GENERAL)) 
(DE IN_LIST1A (FL ECHOP PREFIXCHARS)
    (PROG (CHAN ECHO OCHAN W W1 USEPIPE)
      (SETQ ECHO *ECHO)
      (COND
       (*REDUCE4
        (COND ((NEQ (TYPE FL) 'STRING) (TYPERR FL 'STRING))
              (T (SETQ FL (VALUE FL))))))
      (SETQ FL (MKFIL* FL))
      (SETQ W (EXPLODE2 FL))
      (COND
       ((EQCAR W '|\||)
        (PROGN (SETQ USEPIPE T) (SETQ FL (LIST2STRING (CDR W)))))
       ((AND (EQCAR W '$) (OR (EQCAR (CDR W) '/) (EQCAR (CDR W) '|\\|)))
        (PROGN
         (COND ((NULL IFL*) (SETQ FL (LIST2STRING (CONS '|.| (CDR W)))))
               (T
                (PROGN
                 (SETQ W1 (REVERSE (EXPLODE2 (CAR IFL*))))
                 (PROG ()
                  WHILELABEL
                   (COND
                    ((NOT (AND W1 (NOT (OR (EQCAR W1 '/) (EQCAR W1 '|\\|)))))
                     (RETURN NIL)))
                   (SETQ W1 (CDR W1))
                   (GO WHILELABEL))
                 (COND ((NULL W1) (SETQ W1 '(/ |.|))))
                 (SETQ W (APPEND (REVERSE W1) (CDDR W)))
                 (SETQ FL (LIST2STRING W))))))))
      (SETQ CHAN (COND (USEPIPE (PIPE-OPEN FL 'INPUT)) (T (OPEN FL 'INPUT))))
      (SETQ OCHAN (RDS CHAN))
      (COND ((ASSOC FL LINELIST*) NIL))
      (SETQ CURLINE* 1)
      (SETQ IFL* (LIST FL CHAN 1))
      (SETQ IPL* (CONS IFL* IPL*))
      (SETQ *ECHO ECHOP)
      (BEGIN1A PREFIXCHARS)
      (RDS OCHAN)
      (CLOSE CHAN)
      (SETQ *ECHO ECHO)
      (COND ((AND (NULL IPL*) CONTL*) (RETURN NIL))
            ((OR (NULL IPL*) (NULL (EQ FL (CAAR IPL*))))
             (REDERR (LIST "FILE STACK CONFUSION" FL IPL*)))
            (T (SETQ IPL* (CDR IPL*)))))) 
(PUT 'OUT 'NUMBER-OF-ARGS 1) 
(PUT 'OUT 'DEFINED-ON-LINE '135) 
(PUT 'OUT 'DEFINED-IN-FILE 'RLISP/IO.RED) 
(PUT 'OUT 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE OUT (U) (OUT_NON_EMPTY_LIST U)) 
(PUT 'OUT_NON_EMPTY_LIST 'NUMBER-OF-ARGS 1) 
(PUT 'OUT_NON_EMPTY_LIST 'DEFINED-ON-LINE '137) 
(PUT 'OUT_NON_EMPTY_LIST 'DEFINED-IN-FILE 'RLISP/IO.RED) 
(PUT 'OUT_NON_EMPTY_LIST 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE OUT_NON_EMPTY_LIST (U)
    (PROG (N CHAN FL X)
      (SETQ N 0)
      (SETQ N (LINELENGTH NIL))
      (COND (*REDUCE4 (SETQ U (VALUE U))))
      (COND ((NULL U) (RETURN NIL)))
      (SETQ U (CAR U))
      (COND
       (*REDUCE4
        (COND ((NEQ (TYPE U) 'STRING) (TYPERR U 'STRING))
              (T (SETQ U (VALUE U))))))
      (COND ((EQUAL U 'T) (RETURN (PROGN (WRS (SETQ OFL* NIL)) NIL))))
      (SETQ FL (MKFIL U))
      (COND
       ((NOT (SETQ X (ASSOC FL OPL*)))
        (PROGN
         (SETQ CHAN (OPEN FL 'OUTPUT))
         (COND
          (CHAN
           (PROGN (SETQ OFL* (CONS FL CHAN)) (SETQ OPL* (CONS OFL* OPL*)))))))
       (T (SETQ OFL* X)))
      (WRS (CDR OFL*))
      (LINELENGTH N)
      (COND (*REDUCE4 (RETURN (MKOBJECT NIL 'NOVAL)))))) 
(PUT 'SHUT 'NUMBER-OF-ARGS 1) 
(PUT 'SHUT 'DEFINED-ON-LINE '158) 
(PUT 'SHUT 'DEFINED-IN-FILE 'RLISP/IO.RED) 
(PUT 'SHUT 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE SHUT (U) (SHUT_NON_EMPTY_LIST U)) 
(PUT 'SHUT_NON_EMPTY_LIST 'NUMBER-OF-ARGS 1) 
(PUT 'SHUT_NON_EMPTY_LIST 'DEFINED-ON-LINE '160) 
(PUT 'SHUT_NON_EMPTY_LIST 'DEFINED-IN-FILE 'RLISP/IO.RED) 
(PUT 'SHUT_NON_EMPTY_LIST 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE SHUT_NON_EMPTY_LIST (U)
    (PROG (FL1)
      (COND (*REDUCE4 (SETQ U (VALUE U))))
      (PROG (FL)
        (SETQ FL U)
       LAB
        (COND ((NULL FL) (RETURN NIL)))
        ((LAMBDA (FL)
           (PROGN
            (COND
             (*REDUCE4
              (COND ((NEQ (TYPE FL) 'STRING) (TYPERR FL 'STRING))
                    (T (SETQ FL (VALUE FL))))))
            (COND
             ((SETQ FL1 (ASSOC (SETQ FL (MKFIL FL)) OPL*))
              (PROGN
               (SETQ OPL* (DELETE FL1 OPL*))
               (COND ((EQUAL FL1 OFL*) (PROGN (SETQ OFL* NIL) (WRS NIL))))
               (CLOSE (CDR FL1))))
             ((NOT (SETQ FL1 (ASSOC FL IPL*)))
              (RERROR 'RLISP 26 (LIST FL "not open")))
             ((NEQ FL1 IFL*)
              (PROGN (CLOSE (CADR FL1)) (SETQ IPL* (DELETE FL1 IPL*))))
             (T
              (RERROR 'RLISP 27
                      (LIST "Cannot shut current input file" (CAR FL1)))))))
         (CAR FL))
        (SETQ FL (CDR FL))
        (GO LAB))
      (COND (*REDUCE4 (RETURN (MKOBJECT NIL 'NOVAL)))))) 
(DEFLIST '((IN RLIS) (IN_TEX RLIS) (OUT RLIS) (SHUT RLIS)) 'STAT) 
(FLAG '(IN IN_TEX OUT SHUT) 'EVAL) 
(FLAG '(IN IN_TEX OUT SHUT) 'IGNORE) 
(PUT 'RLISP_PRINTF 'DEFINED-ON-LINE '191) 
(PUT 'RLISP_PRINTF 'DEFINED-IN-FILE 'RLISP/IO.RED) 
(PUT 'RLISP_PRINTF 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DM RLISP_PRINTF (U) (LIST 'PRINTF_INTERNAL (CADR U) (CONS 'LIST (CDDR U)))) 
(PUT 'RLISP_BLDMSG 'DEFINED-ON-LINE '194) 
(PUT 'RLISP_BLDMSG 'DEFINED-IN-FILE 'RLISP/IO.RED) 
(PUT 'RLISP_BLDMSG 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DM RLISP_BLDMSG (U) (LIST 'BLDMSG_INTERNAL (CADR U) (CONS 'LIST (CDDR U)))) 
(FLAG '(RLISP_PRINTF RLISP_BLDMSG) 'VARIADIC) 
(PUT 'PRINTF 'NEWNAM 'RLISP_PRINTF) 
(PUT 'BLDMSG 'NEWNAM 'RLISP_BLDMSG) 
(PUT 'PRINL 'NEWNAM 'RLISP_PRINL) 
(ENDMODULE) 