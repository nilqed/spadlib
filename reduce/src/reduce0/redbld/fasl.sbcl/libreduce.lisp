(cl:declaim (cl:optimize cl:debug cl:safety))
(cl:declaim (sb-ext:muffle-conditions sb-ext:compiler-note cl:style-warning))
(FLUID '(LR_RCSID* LR_COPYRIGHT*)) 
(SETQ LR_RCSID* "$Id: libreduce.red 6712 2024-02-09 11:59:12Z arthurcnorman $") 
(SETQ LR_COPYRIGHT* "(c) 2008-2013 T. Sturm") 
(MODULE (LIST 'COLOUTPUT)) 
(FLUID '(*MODE)) 
(FLUID '(*LIBREDUCE_ACTIVE)) 
(GLOBAL '(STATCOUNTER)) 
(SETQ *LIBREDUCE_ACTIVE T) 
(SWITCH (LIST 'LRXML)) 
(PUT 'LR_SPRINT 'NUMBER-OF-ARGS 1) 
(PUT 'LR_SPRINT 'DEFINED-ON-LINE '52) 
(PUT 'LR_SPRINT 'DEFINED-IN-FILE 'LIBREDUCE/LIBREDUCE.RED) 
(PUT 'LR_SPRINT 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE LR_SPRINT (U) (COND (*LRXML (LR_PRINTXML U)) (T (PRIN2 U)))) 
(PUT 'LR_APRINT 'NUMBER-OF-ARGS 1) 
(PUT 'LR_APRINT 'DEFINED-ON-LINE '58) 
(PUT 'LR_APRINT 'DEFINED-IN-FILE 'LIBREDUCE/LIBREDUCE.RED) 
(PUT 'LR_APRINT 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE LR_APRINT (U)
    (COND (*LRXML (LR_PRINTXML (REVAL1 U T))) (T (PRIN2 (REVAL1 U T))))) 
(PUT 'LR_PRINTXML 'NUMBER-OF-ARGS 1) 
(PUT 'LR_PRINTXML 'DEFINED-ON-LINE '64) 
(PUT 'LR_PRINTXML 'DEFINED-IN-FILE 'LIBREDUCE/LIBREDUCE.RED) 
(PUT 'LR_PRINTXML 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE LR_PRINTXML (S) (LR_PRINTXML1 S 0)) 
(PUT 'LR_PRINTXML1 'NUMBER-OF-ARGS 2) 
(PUT 'LR_PRINTXML1 'DEFINED-ON-LINE '67) 
(PUT 'LR_PRINTXML1 'DEFINED-IN-FILE 'LIBREDUCE/LIBREDUCE.RED) 
(PUT 'LR_PRINTXML1 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE LR_PRINTXML1 (S INDENT)
    (PROG (OP)
      (PROG (I)
        (SETQ I 1)
       LAB
        (COND ((MINUSP (DIFFERENCE INDENT I)) (RETURN NIL)))
        (PRIN2 " ")
        (SETQ I (PLUS2 I 1))
        (GO LAB))
      (COND
       ((NOT (PAIRP S))
        (PROGN (PRIN2 "<constant symbol=\"") (PRIN2 S) (PRIN2T "\"/>")))
       (T
        (PROGN
         (SETQ OP (PROG1 (CAR S) (SETQ S (CDR S))))
         (PRIN2 "<apply symbol=\"")
         (PRIN2 OP)
         (PRIN2T "\">")
         (PROG (ARG)
           (SETQ ARG S)
          LAB
           (COND ((NULL ARG) (RETURN NIL)))
           ((LAMBDA (ARG) (LR_PRINTXML1 ARG (PLUS INDENT 2))) (CAR ARG))
           (SETQ ARG (CDR ARG))
           (GO LAB))
         (PROG (I)
           (SETQ I 1)
          LAB
           (COND ((MINUSP (DIFFERENCE INDENT I)) (RETURN NIL)))
           (PRIN2 " ")
           (SETQ I (PLUS2 I 1))
           (GO LAB))
         (PRIN2T "</apply>")))))) 
(PUT 'LR_RESULT 'NUMBER-OF-ARGS 0) 
(PUT 'LR_RESULT 'DEFINED-ON-LINE '86) 
(PUT 'LR_RESULT 'DEFINED-IN-FILE 'LIBREDUCE/LIBREDUCE.RED) 
(PUT 'LR_RESULT 'PROCEDURE_TYPE '(ARROW UNIT GENERAL)) 
(DE LR_RESULT NIL (PRIN2 (INT2ID 3))) 
(PUT 'LR_STATCOUNTER 'NUMBER-OF-ARGS 0) 
(PUT 'LR_STATCOUNTER 'DEFINED-ON-LINE '89) 
(PUT 'LR_STATCOUNTER 'DEFINED-IN-FILE 'LIBREDUCE/LIBREDUCE.RED) 
(PUT 'LR_STATCOUNTER 'PROCEDURE_TYPE '(ARROW UNIT GENERAL)) 
(DE LR_STATCOUNTER NIL (PRIN2 (INT2ID 4))) 
(PUT 'LR_MODE 'NUMBER-OF-ARGS 0) 
(PUT 'LR_MODE 'DEFINED-ON-LINE '92) 
(PUT 'LR_MODE 'DEFINED-IN-FILE 'LIBREDUCE/LIBREDUCE.RED) 
(PUT 'LR_MODE 'PROCEDURE_TYPE '(ARROW UNIT GENERAL)) 
(DE LR_MODE NIL (PRIN2 (INT2ID 5))) 
(PUT 'LR_POSTTEXT 'NUMBER-OF-ARGS 0) 
(PUT 'LR_POSTTEXT 'DEFINED-ON-LINE '95) 
(PUT 'LR_POSTTEXT 'DEFINED-IN-FILE 'LIBREDUCE/LIBREDUCE.RED) 
(PUT 'LR_POSTTEXT 'PROCEDURE_TYPE '(ARROW UNIT GENERAL)) 
(DE LR_POSTTEXT NIL (PRIN2 (INT2ID 6))) 
(PUT 'LR_PRINTER 'NUMBER-OF-ARGS 2) 
(PUT 'LR_PRINTER 'DEFINED-ON-LINE '98) 
(PUT 'LR_PRINTER 'DEFINED-IN-FILE 'LIBREDUCE/LIBREDUCE.RED) 
(PUT 'LR_PRINTER 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE LR_PRINTER (U MODE)
    (PROGN
     (COND
      ((EQ MODE 'SYMBOLIC) (COND ((OR U (EQ *MODE 'SYMBOLIC)) (LR_SPRINT U))))
      (T (LR_APRINT U))))) 
(ENDMODULE) 
(MODULE (LIST 'REDFRONT)) 
(FLUID '(PROMPTSTRING* LR_SWITCHES* LR_SWITCHES-THIS-SL* LISPSYSTEM*)) 
(SETQ LR_SWITCHES* (LIST *MSG *OUTPUT)) 
(OFF1 'MSG) 
(OFF1 'OUTPUT) 
(PUT 'LR_PSLP 'NUMBER-OF-ARGS 0) 
(PUT 'LR_PSLP 'DEFINED-ON-LINE '121) 
(PUT 'LR_PSLP 'DEFINED-IN-FILE 'LIBREDUCE/LIBREDUCE.RED) 
(PUT 'LR_PSLP 'PROCEDURE_TYPE '(ARROW UNIT GENERAL)) 
(DE LR_PSLP NIL (MEMQ 'PSL LISPSYSTEM*)) 
(COND
 ((LR_PSLP)
  (PROGN (SETQ LR_SWITCHES-THIS-SL* (LIST *USERMODE)) (OFF1 'USERMODE)))) 
(PUT 'LR_COLOR 'NUMBER-OF-ARGS 1) 
(PUT 'LR_COLOR 'DEFINED-ON-LINE '129) 
(PUT 'LR_COLOR 'DEFINED-IN-FILE 'LIBREDUCE/LIBREDUCE.RED) 
(PUT 'LR_COLOR 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE LR_COLOR (C)
    (COND
     ((STRINGP C)
      (COMPRESS
       (CONS '|"|
             (CONS (INT2ID 1)
                   (REVERSIP
                    (CONS '|"|
                          (CONS (INT2ID 2)
                                (CDR (REVERSIP (CDR (EXPLODE C)))))))))))
     (T
      (INTERN
       (COMPRESS (CONS (INT2ID 1) (NCONC (EXPLODE C) (LIST (INT2ID 2))))))))) 
(PUT 'LR_UNCOLOR 'NUMBER-OF-ARGS 1) 
(PUT 'LR_UNCOLOR 'DEFINED-ON-LINE '140) 
(PUT 'LR_UNCOLOR 'DEFINED-IN-FILE 'LIBREDUCE/LIBREDUCE.RED) 
(PUT 'LR_UNCOLOR 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE LR_UNCOLOR (C)
    (COND
     ((STRINGP C)
      (COMPRESS
       (CONS '|"|
             (REVERSIP (CONS '|"| (CDDR (REVERSIP (CDDR (EXPLODE C)))))))))
     (T
      (INTERN
       (COMPRESS (CONS '! (REVERSIP (CDR (REVERSIP (CDR (EXPLODE C))))))))))) 
(PUT 'LR_SETPCHAR-PSL 'NUMBER-OF-ARGS 1) 
(PUT 'LR_SETPCHAR-PSL 'DEFINED-ON-LINE '146) 
(PUT 'LR_SETPCHAR-PSL 'DEFINED-IN-FILE 'LIBREDUCE/LIBREDUCE.RED) 
(PUT 'LR_SETPCHAR-PSL 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE LR_SETPCHAR-PSL (C)
    (PROG (W)
      (SETQ W (LR_SETPCHAR-ORIG C))
      (SETQ PROMPTSTRING* (LR_COLOR PROMPTSTRING*))
      (RETURN (LR_UNCOLOR W)))) 
(PUT 'LR_SETPCHAR-CSL 'NUMBER-OF-ARGS 1) 
(PUT 'LR_SETPCHAR-CSL 'DEFINED-ON-LINE '153) 
(PUT 'LR_SETPCHAR-CSL 'DEFINED-IN-FILE 'LIBREDUCE/LIBREDUCE.RED) 
(PUT 'LR_SETPCHAR-CSL 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE LR_SETPCHAR-CSL (C) (LR_UNCOLOR (LR_SETPCHAR-ORIG (LR_COLOR C)))) 
(COPYD 'LR_SETPCHAR-ORIG 'SETPCHAR) 
(COND ((LR_PSLP) (COPYD 'SETPCHAR 'LR_SETPCHAR-PSL))
      (T (COPYD 'SETPCHAR 'LR_SETPCHAR-CSL))) 
(GLOBAL '(*LESSSPACE)) 
(PUT 'LR_YESP-PSL 'NUMBER-OF-ARGS 1) 
(PUT 'LR_YESP-PSL 'DEFINED-ON-LINE '165) 
(PUT 'LR_YESP-PSL 'DEFINED-IN-FILE 'LIBREDUCE/LIBREDUCE.RED) 
(PUT 'LR_YESP-PSL 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE LR_YESP-PSL (U)
    (PROG (IFL OFL X Y)
      (COND
       (IFL*
        (PROGN
         (SETQ IFL (SETQ IFL* (LIST (CAR IFL*) (CADR IFL*) CURLINE*)))
         (RDS NIL))))
      (COND (OFL* (PROGN (SETQ OFL OFL*) (WRS NIL))))
      (COND ((NULL *LESSSPACE) (TERPRI)))
      (COND ((ATOM U) (PRIN2 U)) (T (LPRI U)))
      (COND ((NULL *LESSSPACE) (TERPRI)))
      (SETQ Y (SETPCHAR "?"))
      (SETQ X (YESP1))
      (SETPCHAR Y)
      (COND (OFL (WRS (CDR OFL))))
      (COND (IFL (RDS (CADR IFL))))
      (SETQ CURSYM* '*SEMICOL*)
      (RETURN X))) 
(COND
 ((LR_PSLP)
  (PROGN
   (REMFLAG '(YESP) 'LOSE)
   (COPYD 'LR_YESP-ORIG 'YESP)
   (COPYD 'YESP 'LR_YESP-PSL)
   (FLAG '(YESP) 'LOSE)))) 
(COND
 ((LR_PSLP)
  (PROGN
   (COPYD 'BREAK_PROMPT 'LR_BREAK_PROMPT)
   (FLAG '(BREAK_PROMPT) 'LOSE)
   NIL))) 
(COND ((LR_PSLP) (ONOFF 'USERMODE (CAR LR_SWITCHES-THIS-SL*)))) 
(ONOFF 'MSG (CAR LR_SWITCHES*)) 
(ONOFF 'OUTPUT (CADR LR_SWITCHES*)) 
(SETQ CRBUF* NIL) 
(SETQ INPUTBUFLIS* NIL) 
(SETQ LESSSPACE* T) 
(SETQ STATCOUNTER 0) 
(OFF1 'MSG) 
(OFF1 'OUTPUT) 
(ON1 'TIME) 
(ENDMODULE) 