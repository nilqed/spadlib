(cl:declaim (cl:optimize cl:debug cl:safety))
(cl:declaim (sb-ext:muffle-conditions sb-ext:compiler-note cl:style-warning))
(MODULE (LIST 'RATIONAL)) 
(GLOBAL '(DOMAINLIST*)) 
(SWITCH (LIST 'RATIONAL)) 
(SETQ DOMAINLIST* (UNION '(|:RN:|) DOMAINLIST*)) 
(PUT 'RATIONAL 'TAG '|:RN:|) 
(PUT '|:RN:| 'DNAME 'RATIONAL) 
(FLAG '(|:RN:|) 'FIELD) 
(PUT '|:RN:| 'I2D '*I2RN) 
(PUT '|:RN:| '|:FT:| '*RN2FT) 
(PUT '|:RN:| 'MINUS '|RNMINUS:|) 
(PUT '|:RN:| 'MINUSP '|RNMINUSP:|) 
(PUT '|:RN:| 'PLUS '|RNPLUS:|) 
(PUT '|:RN:| 'TIMES '|RNTIMES:|) 
(PUT '|:RN:| 'DIFFERENCE '|RNDIFFERENCE:|) 
(PUT '|:RN:| 'QUOTIENT '|RNQUOTIENT:|) 
(PUT '|:RN:| 'ZEROP '|RNZEROP:|) 
(PUT '|:RN:| 'ONEP '|RNONEP:|) 
(PUT '|:RN:| 'FACTORFN '|RNFACTOR:|) 
(PUT '|:RN:| 'EXPT '|RNEXPT:|) 
(PUT '|:RN:| 'PREPFN '|RNPREP:|) 
(PUT '|:RN:| 'PRIFN 'RNPRIN) 
(PUT '|:RN:| 'INTEQUIVFN 'RNEQUIV) 
(PUT '|:RN:| 'ROOTFN '|RN:ROOT|) 
(FLAG '(|:RN:|) 'RATMODE) 
(PUT '|RNEXPT:| 'NUMBER-OF-ARGS 2) 
(PUT '|RNEXPT:| 'DEFINED-ON-LINE '58) 
(PUT '|RNEXPT:| 'DEFINED-IN-FILE 'POLY/RATIONAL.RED) 
(PUT '|RNEXPT:| 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE |RNEXPT:| (U N)
    (PROG (V)
      (COND ((EQUAL N 0) (RETURN 1)))
      (SETQ V (CDR U))
      (COND
       ((LESSP N 0)
        (PROGN
         (SETQ N (MINUS N))
         (COND
          ((LESSP (CAR V) 0) (SETQ V (CONS (MINUS (CDR V)) (MINUS (CAR V)))))
          (T (SETQ V (CONS (CDR V) (CAR V))))))))
      (COND ((EQUAL N 1) (RETURN (CONS (CAR U) V))))
      (RETURN (CONS (CAR U) (CONS (EXPT (CAR V) N) (EXPT (CDR V) N)))))) 
(PUT 'MKRATNUM 'NUMBER-OF-ARGS 1) 
(PUT 'MKRATNUM 'DEFINED-ON-LINE '73) 
(PUT 'MKRATNUM 'DEFINED-IN-FILE 'POLY/RATIONAL.RED) 
(PUT 'MKRATNUM 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE MKRATNUM (U)
    (COND ((ATOM U) (*I2RN U))
          ((EQ (CAR U) '|:GI:|) (APPLY1 (GET '|:GI:| '|:CRN:|) U))
          (T (APPLY1 (GET (CAR U) '|:RN:|) U)))) 
(PUT 'MKRN 'NUMBER-OF-ARGS 2) 
(PUT 'MKRN 'DEFINED-ON-LINE '81) 
(PUT 'MKRN 'DEFINED-IN-FILE 'POLY/RATIONAL.RED) 
(PUT 'MKRN 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE MKRN (U V)
    (COND ((LESSP V 0) (MKRN (MINUS U) (MINUS V)))
          ((EQUAL U 0.0) (CONS '|:RN:| (CONS 0 1)))
          ((EQUAL V 1.0) (CONS '|:RN:| (CONS U 1)))
          (T
           ((LAMBDA (M) (CONS '|:RN:| (CONS (QUOTIENT U M) (QUOTIENT V M))))
            (GCDN U V))))) 
(PUT '*I2RN 'NUMBER-OF-ARGS 1) 
(PUT '*I2RN 'DEFINED-ON-LINE '93) 
(PUT '*I2RN 'DEFINED-IN-FILE 'POLY/RATIONAL.RED) 
(PUT '*I2RN 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE *I2RN (U) (CONS '|:RN:| (CONS U 1))) 
(PUT '|RNMINUS:| 'NUMBER-OF-ARGS 1) 
(PUT '|RNMINUS:| 'DEFINED-ON-LINE '97) 
(PUT '|RNMINUS:| 'DEFINED-IN-FILE 'POLY/RATIONAL.RED) 
(PUT '|RNMINUS:| 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE |RNMINUS:| (U) (CONS (CAR U) (CONS (|:MINUS| (CADR U)) (CDDR U)))) 
(PUT '|RNMINUSP:| 'NUMBER-OF-ARGS 1) 
(PUT '|RNMINUSP:| 'DEFINED-ON-LINE '102) 
(PUT '|RNMINUSP:| 'DEFINED-IN-FILE 'POLY/RATIONAL.RED) 
(PUT '|RNMINUSP:| 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE |RNMINUSP:| (U)
    (COND ((ATOM (SETQ U (CADR U))) (LESSP U 0))
          (T (APPLY1 (GET (CAR U) 'MINUSP) U)))) 
(PUT '|RNPLUS:| 'NUMBER-OF-ARGS 2) 
(PUT '|RNPLUS:| 'DEFINED-ON-LINE '107) 
(PUT '|RNPLUS:| 'DEFINED-IN-FILE 'POLY/RATIONAL.RED) 
(PUT '|RNPLUS:| 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE |RNPLUS:| (U V)
    (MKRN (PLUS (TIMES (CADR U) (CDDR V)) (TIMES (CDDR U) (CADR V)))
          (TIMES (CDDR U) (CDDR V)))) 
(PUT '|RNTIMES:| 'NUMBER-OF-ARGS 2) 
(PUT '|RNTIMES:| 'DEFINED-ON-LINE '110) 
(PUT '|RNTIMES:| 'DEFINED-IN-FILE 'POLY/RATIONAL.RED) 
(PUT '|RNTIMES:| 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE |RNTIMES:| (U V) (MKRN (TIMES (CADR U) (CADR V)) (TIMES (CDDR U) (CDDR V)))) 
(PUT '|RNDIFFERENCE:| 'NUMBER-OF-ARGS 2) 
(PUT '|RNDIFFERENCE:| 'DEFINED-ON-LINE '113) 
(PUT '|RNDIFFERENCE:| 'DEFINED-IN-FILE 'POLY/RATIONAL.RED) 
(PUT '|RNDIFFERENCE:| 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE |RNDIFFERENCE:| (U V)
    (MKRN (DIFFERENCE (TIMES (CADR U) (CDDR V)) (TIMES (CDDR U) (CADR V)))
          (TIMES (CDDR U) (CDDR V)))) 
(PUT '|RNQUOTIENT:| 'NUMBER-OF-ARGS 2) 
(PUT '|RNQUOTIENT:| 'DEFINED-ON-LINE '116) 
(PUT '|RNQUOTIENT:| 'DEFINED-IN-FILE 'POLY/RATIONAL.RED) 
(PUT '|RNQUOTIENT:| 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE |RNQUOTIENT:| (U V)
    (MKRN (TIMES (CADR U) (CDDR V)) (TIMES (CDDR U) (CADR V)))) 
(PUT '|RNZEROP:| 'NUMBER-OF-ARGS 1) 
(PUT '|RNZEROP:| 'DEFINED-ON-LINE '119) 
(PUT '|RNZEROP:| 'DEFINED-IN-FILE 'POLY/RATIONAL.RED) 
(PUT '|RNZEROP:| 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE |RNZEROP:| (U) (EQUAL (CADR U) 0)) 
(PUT '|RNONEP:| 'NUMBER-OF-ARGS 1) 
(PUT '|RNONEP:| 'DEFINED-ON-LINE '121) 
(PUT '|RNONEP:| 'DEFINED-IN-FILE 'POLY/RATIONAL.RED) 
(PUT '|RNONEP:| 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE |RNONEP:| (U) (AND (EQUAL (CADR U) 1) (EQUAL (CDDR U) 1))) 
(PUT '|RNFACTOR:| 'NUMBER-OF-ARGS 1) 
(PUT '|RNFACTOR:| 'DEFINED-ON-LINE '123) 
(PUT '|RNFACTOR:| 'DEFINED-IN-FILE 'POLY/RATIONAL.RED) 
(PUT '|RNFACTOR:| 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE |RNFACTOR:| (U)
    (PROG (X Y DMODE* M N)
      (SETQ M 0)
      (SETQ N 0)
      (SETQ X (SUBF U NIL))
      (COND
       ((NOT (OR (ATOM (CDR X)) (ATOM (CAR (CDR X)))))
        (RETURN (LIST 1 (CONS U 1)))))
      (SETQ Y (INTERNAL-FACTORF (CAR X)))
      (SETQ N (CAR Y))
      (SETQ DMODE* '|:RN:|)
      (SETQ Y
              (PROG (J FORALL-RESULT FORALL-ENDPTR)
                (SETQ J (CDR Y))
                (COND ((NULL J) (RETURN NIL)))
                (SETQ FORALL-RESULT
                        (SETQ FORALL-ENDPTR
                                (CONS
                                 ((LAMBDA (J)
                                    (PROGN
                                     (SETQ N
                                             (TIMES N
                                                    (SETQ M
                                                            (EXPT
                                                             (LNC
                                                              (CKRN (CAR J)))
                                                             (CDR J)))))
                                     (CONS (QUOTFD (CAR J) M) (CDR J))))
                                  (CAR J))
                                 NIL)))
               LOOPLABEL
                (SETQ J (CDR J))
                (COND ((NULL J) (RETURN FORALL-RESULT)))
                (RPLACD FORALL-ENDPTR
                        (CONS
                         ((LAMBDA (J)
                            (PROGN
                             (SETQ N
                                     (TIMES N
                                            (SETQ M
                                                    (EXPT (LNC (CKRN (CAR J)))
                                                          (CDR J)))))
                             (CONS (QUOTFD (CAR J) M) (CDR J))))
                          (CAR J))
                         NIL))
                (SETQ FORALL-ENDPTR (CDR FORALL-ENDPTR))
                (GO LOOPLABEL)))
      (RETURN (CONS (INT-EQUIV-CHK (MKRN N (CDR X))) Y)))) 
(PUT '|RNPREP:| 'NUMBER-OF-ARGS 1) 
(PUT '|RNPREP:| 'DEFINED-ON-LINE '137) 
(PUT '|RNPREP:| 'DEFINED-IN-FILE 'POLY/RATIONAL.RED) 
(PUT '|RNPREP:| 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE |RNPREP:| (U)
    ((LAMBDA (X)
       (COND ((EQUAL (CDDR U) 1) X) (T (LIST 'QUOTIENT X (PREPF (CDDR U))))))
     (PREPF (CADR U)))) 
(PUT 'RNPRIN 'NUMBER-OF-ARGS 1) 
(PUT 'RNPRIN 'DEFINED-ON-LINE '143) 
(PUT 'RNPRIN 'DEFINED-IN-FILE 'POLY/RATIONAL.RED) 
(PUT 'RNPRIN 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE RNPRIN (U) (PROGN (PRIN2* (CADR U)) (PRIN2* "/") (PRIN2* (CDDR U)))) 
(PUT 'RNEQUIV 'NUMBER-OF-ARGS 1) 
(PUT 'RNEQUIV 'DEFINED-ON-LINE '146) 
(PUT 'RNEQUIV 'DEFINED-IN-FILE 'POLY/RATIONAL.RED) 
(PUT 'RNEQUIV 'PROCEDURE_TYPE '(ARROW GENERAL GENERAL)) 
(DE RNEQUIV (U) (COND ((EQUAL (CDR (SETQ U (CDR U))) 1) (CAR U)) (T NIL))) 
(PUT '|RN:ROOT| 'NUMBER-OF-ARGS 2) 
(PUT '|RN:ROOT| 'DEFINED-ON-LINE '150) 
(PUT '|RN:ROOT| 'DEFINED-IN-FILE 'POLY/RATIONAL.RED) 
(PUT '|RN:ROOT| 'PROCEDURE_TYPE '(ARROW (TIMES GENERAL GENERAL) GENERAL)) 
(DE |RN:ROOT| (U N)
    ((LAMBDA (X Y)
       (COND ((OR (EQ X 'FAILED) (EQ Y 'FAILED)) 'FAILED) (T (MKRN X Y))))
     (ROOTXF (CADR U) N) (ROOTXF (CDDR U) N))) 
(INITDMODE 'RATIONAL) 
(ENDMODULE) 